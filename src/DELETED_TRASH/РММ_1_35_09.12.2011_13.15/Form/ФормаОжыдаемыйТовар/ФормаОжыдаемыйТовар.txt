
&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	
	УстановитьПривилегированныйРежим(Истина);
	
	Запрос = Новый Запрос();
	ТекстЗапроса = "
	|ВЫБРАТЬ
	|	ТоварыКПоступлению.ДокументПоступления КАК ДокументПоступления
	|ИЗ
	|	РегистрНакопления.ТоварыКПоступлению.Остатки(, 
	|		Номенклатура = &Номенклатура
	|И		Характеристика = ЗНАЧЕНИЕ(Справочник.ХарактеристикиНоменклатуры.ПустаяСсылка)
	|И		Склад = &Склад) КАК ТоварыКПоступлению";
	
	Запрос.УстановитьПараметр("Номенклатура", Параметры.Номенклатура);
	Запрос.УстановитьПараметр("Склад", Справочники.Склады.НайтиПоНаименованию(Параметры.Склад));
	
	Запрос.Текст = ТекстЗапроса;
	
	РезультатЗапроса = Запрос.Выполнить();
	Выборка = РезультатЗапроса.Выбрать();
	
	ДокументСсылка 			= ?(Выборка.Следующий(), Выборка.ДокументПоступления, "Нет документа");
	ДокументНаименование 	= Строка(ДокументСсылка);
				
	
	Если ТипЗнч(ДокументСсылка) <> Тип("Строка") Тогда
		
		Если ДокументСсылка.Метаданные().ТабличныеЧасти.Найти("Товары") <> Неопределено Тогда
			
			Для Каждого СтрокаТЧ ИЗ ДокументСсылка.Товары Цикл
				
				Попытка
					
					НоваяСтрока = СписокНоменклатуры.Добавить();
					
					НоваяСтрока.Код 		 = СтрокаТЧ.Номенклатура.Код;
					НоваяСтрока.Номенклатура = СтрокаТЧ.Номенклатура;
					НоваяСтрока.Количество   = СтрокаТЧ.Количество;
					
				Исключение
				КонецПопытки;
				
			КонецЦикла;
			
		КонецЕсли;
		
	КонецЕсли;

	
КонецПроцедуры

&НаКлиенте
Процедура ДокументСсылкаНажатие(Элемент, СтандартнаяОбработка)
	
	СтандартнаяОбработка = Ложь;
	ОткрытьЗначение(ДокументСсылка);
	
КонецПроцедуры
