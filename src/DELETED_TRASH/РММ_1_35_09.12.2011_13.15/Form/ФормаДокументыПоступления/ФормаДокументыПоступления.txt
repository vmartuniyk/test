&НаСервере
Процедура ЗаполнитьСписокНоменклатуры(СсылкаНаДокумент)
	
	СписокНоменклатуры.Очистить();
	
	Запрос = Новый Запрос;
	ТекстЗапроса = "
	|ВЫБРАТЬ РАЗРЕШЕННЫЕ
	|	СпрНоменклатура.Код,
	|	СпрНоменклатура.Артикул,
	|	ДокументРеализацииТовары.Номенклатура,
	|	ДокументРеализацииТовары.Количество,
	|	ДокументРеализацииТовары.Цена
	|ИЗ
	|	Документ.ПоступлениеТоваровУслуг.Товары КАК ДокументРеализацииТовары
	|	
	|ЛЕВОЕ СОЕДИНЕНИЕ Справочник.Номенклатура КАК СпрНоменклатура
	|ПО
	|	СпрНоменклатура.Ссылка = ДокументРеализацииТовары.Номенклатура
	|
	|ГДЕ
	|	ДокументРеализацииТовары.Ссылка = &СсылкаНаДокумент";
	
	Запрос.УстановитьПараметр("СсылкаНаДокумент", СсылкаНаДокумент);
	Запрос.Текст = ТекстЗапроса;
	
	СписокНоменклатуры.Загрузить(Запрос.Выполнить().Выгрузить());
	
КонецПроцедуры

&НаКлиенте
Процедура СписокДокументовПриАктивизацииСтроки(Элемент)
	
	Если Элемент.ТекущиеДанные = Неопределено Тогда
		СписокНоменклатуры.Очистить();
		Возврат;
	КонецЕсли;
	ЗаполнитьСписокНоменклатуры(Элемент.ТекущиеДанные.Ссылка);
	
КонецПроцедуры

&НаКлиенте
Процедура МенеджерПриИзменении(Элемент)
	
	ОтборыСписковКлиентСервер.ИзменитьЭлементОтбораСписка(СписокДокументов, "Менеджер", Менеджер, ЗначениеЗаполнено(Менеджер));
	
КонецПроцедуры

&НаКлиенте
Процедура ПечатьВыбраннойНоменклатуры(Команда) 
	
	МассивНоменклатуры = Новый Массив;
	СоотвествиеЦен = Новый Соответствие;
	СоотвествиеКоличества = Новый Соответствие;
	
	ктсСформироватьДанныеПечатиИзСписка(МассивНоменклатуры, СоотвествиеЦен, СоотвествиеКоличества);
	
	СтруктураПередачи = Новый Структура;
	СтруктураПередачи.Вставить("ВидПечати", "ПечатьИЗКорзины");
	СтруктураПередачи.Вставить("МассивНоменклатуры", МассивНоменклатуры);
	СтруктураПередачи.Вставить("ВидЦены", ВидЦены);
	СтруктураПередачи.Вставить("СоотвествиеЦен", СоотвествиеЦен);
	СтруктураПередачи.Вставить("СоотвествиеКоличества", СоотвествиеКоличества);
	
	ФормаБыстраяПечатьЦенников = ПолучитьФорму("ВнешняяОбработка.РабочееМестоМенеджера.Форма.ФормаБыстраяПечатьЦенников", СтруктураПередачи);
	ФормаБыстраяПечатьЦенников.ОткрытьМодально();
	
КонецПроцедуры

&НаКлиенте
Процедура ктсСформироватьДанныеПечатиИзСписка(МассивНоменклатуры, СоотвествиеЦен, СоотвествиеКоличества)
	
	ЭлСписокНоменклатуры = Элементы.СписокНоменклатуры;
	ВыделенныеСтроки = ЭлСписокНоменклатуры.ВыделенныеСтроки;
	
	Для Каждого ИндексСтроки ИЗ ВыделенныеСтроки Цикл
		
		ВделеннаяСтрока = ЭлСписокНоменклатуры.ДанныеСтроки(ИндексСтроки);
		
		МассивНоменклатуры.Добавить(ВделеннаяСтрока.Номенклатура);
		СоотвествиеЦен.Вставить(ВделеннаяСтрока.Номенклатура, ВделеннаяСтрока.Цена);
		СоотвествиеКоличества.Вставить(ВделеннаяСтрока.Номенклатура, 1);
		
	КонецЦикла;
	
КонецПроцедуры


&НаКлиенте
Процедура ПечатьВыбранныхДокументов(Команда)
	
	МассивНоменклатуры = Новый Массив;
	СоотвествиеЦен = Новый Соответствие;
	СоотвествиеКоличества = Новый Соответствие;
	
	МассивДокументов = СформироватьМассивДокументов();
	
	СфорироватьСписокНоменлатурыИзДокументов(МассивДокументов, МассивНоменклатуры, СоотвествиеЦен, СоотвествиеКоличества);
	
	СтруктураПередачи = Новый Структура;
	СтруктураПередачи.Вставить("ВидПечати", "ПечатьИЗКорзины");
	СтруктураПередачи.Вставить("МассивНоменклатуры", МассивНоменклатуры);
	СтруктураПередачи.Вставить("ВидЦены", ВидЦены);
	СтруктураПередачи.Вставить("СоотвествиеЦен", СоотвествиеЦен);
	СтруктураПередачи.Вставить("СоотвествиеКоличества", СоотвествиеКоличества);
	
	ФормаБыстраяПечатьЦенников = ПолучитьФорму("ВнешняяОбработка.РабочееМестоМенеджера.Форма.ФормаБыстраяПечатьЦенников", СтруктураПередачи);
	ФормаБыстраяПечатьЦенников.ОткрытьМодально();
	
КонецПроцедуры

&НаКлиенте
Функция СформироватьМассивДокументов()
	
	ЭлСписокДокументов = Элементы.СписокДокументов;
	ВыделенныеСтроки = ЭлСписокДокументов.ВыделенныеСтроки;
	
	МассивДокументов = Новый Массив;
	
	Для Каждого ИндексСтроки ИЗ ВыделенныеСтроки Цикл
		
		ВыделеннаяСтрока = ЭлСписокДокументов.ДанныеСтроки(ИндексСтроки);
		
		МассивДокументов.Добавить(ВыделеннаяСтрока.Ссылка);
		
	КонецЦикла;
	
	Возврат МассивДокументов;
	
КонецФункции

&НаСервере
Процедура СфорироватьСписокНоменлатурыИзДокументов(СписокДокументов, МассивНоменклатуры, СоотвествиеЦен, СоотвествиеКоличества)
	
	Запрос = Новый Запрос;
	ТекстЗапроса = "
	|ВЫБРАТЬ РАЗРЕШЕННЫЕ
	|	ДокументРеализацииТовары.Номенклатура,
	|	ДокументРеализацииТовары.Цена
	|ИЗ
	|	Документ.ПоступлениеТоваровУслуг.Товары КАК ДокументРеализацииТовары
	|
	|ГДЕ
	|	ДокументРеализацииТовары.Ссылка В (&СписокДокументов)";
	
	Запрос.УстановитьПараметр("СписокДокументов", СписокДокументов);
	Запрос.Текст = ТекстЗапроса;
	
	РезультатЗапроса 	= Запрос.Выполнить();
	Выборка 			= РезультатЗапроса.Выбрать();
	
	Пока Выборка.Следующий() Цикл
		
		МассивНоменклатуры.Добавить(Выборка.Номенклатура);
		СоотвествиеЦен.Вставить(Выборка.Номенклатура, Выборка.Цена);
		СоотвествиеЦен.Вставить(Выборка.Номенклатура, 1);
		
	КонецЦикла;
	
КонецПроцедуры