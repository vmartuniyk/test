
////////////////////////////////////////////////////////////////////////////////
// ОБРАБОТЧИКИ СОБЫТИЙ ФОРМЫ

&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	
 	СслыкаНаДокумент 			= Параметры.СсылкаНаДокумент;
	ДеревоСписокНоменклатуры 	= РеквизитФормыВЗначение("СписокНоменклатуры", Тип("ДеревоЗначений"));
	Дерево						= ПолучитьИзВременногоХранилища(Параметры.АдресДерева);
	
	Для каждого СтрокаДерева Из Дерево.Строки Цикл
		Строка 				= ДеревоСписокНоменклатуры.Строки.Добавить();
		ЗаполнитьЗначенияСвойств(Строка, СтрокаДерева);
		Для каждого СтрокаПодстроки Из СтрокаДерева.Строки Цикл
		 	Подстрока 						= Строка.Строки.Добавить();
			Подстрока.ЗаказПоставщику 		= СтрокаПодстроки.ЗаказПоставщикуДоп;
			Подстрока.Поставщик 			= СтрокаПодстроки.Поставщик;
			Подстрока.НомерТТН 				= СтрокаПодстроки.НомерТТН;
			Подстрока.Назначение			= СтрокаПодстроки.Назначение;
			Подстрока.КоличествоДоп 		= СтрокаПодстроки.КоличествоДоп;
			Подстрока.КоличествоОстатокДоп	= СтрокаПодстроки.КоличествоОстатокДоп;
			Подстрока.ЕдиницаИзмеренияДоп 	= СтрокаПодстроки.ЕдиницаИзмеренияДоп;
			Подстрока.ЦенаДоп 				= СтрокаПодстроки.ЦенаДоп;
		КонецЦикла; 
	КонецЦикла; 
	
	ЗначениеВРеквизитФормы(ДеревоСписокНоменклатуры, "СписокНоменклатуры");
КонецПроцедуры


////////////////////////////////////////////////////////////////////////////////
// ОБРАБОТЧИКИ КОМАНД ФОРМЫ

&НаКлиенте
Процедура ПровестиДокумент(Команда)
	ПровестиДокументНаКлиенте();
КонецПроцедуры

&НаКлиенте
Процедура ПровестиИЗакрытьДокумент(Команда)
	ПровестиДокументНаКлиенте(Истина);
КонецПроцедуры

&НаКлиенте
Процедура ПровестиДокументНаКлиенте(ЗакрытьВладельца=Ложь)
	ТоварыЗаказа =ВладелецФормы.Объект.Товары;
	Для каждого Строка  Из ТоварыЗаказа Цикл
	    НоваяСтрока = Объект.ТоварыИзЗаказа.Добавить();	
		ЗаполнитьЗначенияСвойств(НоваяСтрока,Строка) 
	КонецЦикла; 
		
	
	Результат = ПровестиДокументНаСервере();

	Если Результат Тогда
		ДокументСсылка 	= СслыкаНаДокумент;
		ФормаДокумента	= ВладелецФормы;
		ОбъектФормы		= ФормаДокумента.Объект;
		ДокументТовары	= ОбъектФормы.Товары;
		ДокументТовары.Очистить();	
		СтруктураДействий = Новый Структура;
		ЗаполнитьСтруктуруДействия(СтруктураДействий, ОбъектФормы);
		Для Каждого ТекущаяСтрока Из Объект.Товары Цикл
			НоваяСтрока = ДокументТовары.Добавить();
			ЗаполнитьЗначенияСвойств(НоваяСтрока, ТекущаяСтрока);
			СтруктураДействий.Вставить("ПроверитьЗаполнитьУпаковкуПоВладельцу", НоваяСтрока.Упаковка);
			ОбработкаТабличнойЧастиКлиент.ОбработатьСтрокуТЧ(НоваяСтрока, СтруктураДействий, );
		КонецЦикла;
		
		Закрыть(Ложь)
	Иначе
		ПоказатьОповещениеПользователя("Документ проведен без изменений:", ПолучитьНавигационнуюСсылку(СслыкаНаДокумент), Строка(СслыкаНаДокумент), БиблиотекаКартинок.Информация32);
		Закрыть(Ложь);
	КонецЕсли; 
КонецПроцедуры // ПровестиДокументНаКлиенте()

&НаКлиенте
Процедура Отмена(Команда)
	Закрыть(Неопределено);
КонецПроцедуры





//Для Таблици товаров

&НаКлиентеНаСервереБезКонтекста
Процедура РассчитатьИтоговыеПоказателиЗаказа(Форма)
	
	// Заполнение итогов по таблице "Товары"
	
	КоллекцияТовары = Форма.Объект.Товары;

	Форма.СуммаЗаказано     = КоллекцияТовары.Итог("СуммаСНДСБезВозвратнойТары") - КоллекцияТовары.Итог("СуммаСНДСОтмененоБезВозвратнойТары");
	Форма.СуммаНДСЗаказано  = КоллекцияТовары.Итог("СуммаНДСБезВозвратнойТары") - КоллекцияТовары.Итог("СуммаНДСОтмененоБезВозвратнойТары");
	Форма.СуммаАвтоСкидки   = КоллекцияТовары.Итог("СуммаАвтоматическойСкидкиБезВозвратнойТары") - КоллекцияТовары.Итог("СуммаАвтоматическойСкидкиОтмененоБезВозвратнойТары");
	Форма.СуммаРучнойСкидки = КоллекцияТовары.Итог("СуммаРучнойСкидкиБезВозвратнойТары") - КоллекцияТовары.Итог("СуммаРучнойСкидкиОтмененоБезВозвратнойТары");
	Форма.СуммаСкидки       = Форма.СуммаАвтоСкидки + Форма.СуммаРучнойСкидки;
	Форма.СуммаОтменено     = КоллекцияТовары.Итог("СуммаСНДСОтмененоБезВозвратнойТары");
	
	Если КоллекцияТовары.Итог("СуммаСНДСОтмененоБезВозвратнойТары") = КоллекцияТовары.Итог("СуммаСНДСБезВозвратнойТары") Тогда
		Форма.ВсеСтрокиОтменены = Истина;
	Иначе
		Форма.ВсеСтрокиОтменены = Ложь;
	КонецЕсли;
	
	СуммаЗаказано = КоллекцияТовары.Итог("СуммаБезВозвратнойТары") - КоллекцияТовары.Итог("СуммаОтмененоБезВозвратнойТары");
	
	Если СуммаЗаказано > 0 Тогда
		Форма.ПроцентАвтоСкидки   = Форма.СуммаАвтоСкидки * 100 / (СуммаЗаказано + Форма.СуммаСкидки);
		Форма.ПроцентРучнойСкидки = Форма.СуммаРучнойСкидки * 100 / (СуммаЗаказано + Форма.СуммаСкидки);
		Форма.ПроцентСкидки       = Форма.ПроцентАвтоСкидки + Форма.ПроцентРучнойСкидки;
	ИначеЕсли Форма.СуммаСкидки > 0 Тогда
		Форма.ПроцентАвтоСкидки   = Форма.СуммаАвтоСкидки * 100 / Форма.СуммаСкидки;
		Форма.ПроцентРучнойСкидки = Форма.СуммаРучнойСкидки * 100 / Форма.СуммаСкидки;
		Форма.ПроцентСкидки       = 100;
	Иначе
		Форма.ПроцентАвтоСкидки   = 0;
		Форма.ПроцентРучнойСкидки = 0;
		Форма.ПроцентСкидки       = 0;
	КонецЕсли;
	
	// Заполнение итогов по этапам оплаты
	
	ПредыдущееЗначениеДаты = Дата(1,1,1);
	Форма.НомерСтрокиПолнойОплаты = 0;
	ПроцентПлатежейОбщий = 0;
	
	Форма.СуммаАвансаДоОбеспечения = 0;
	Форма.СуммаПредоплатыДоОтгрузки = 0;
	Форма.СуммаКредитаПослеОтгрузки = 0;
	Форма.ПроцентАвансаДоОбеспечения = 0;
	Форма.ПроцентПредоплатыДоОтгрузки = 0;
	Форма.ПроцентКредитаПослеОтгрузки = 0;
	
	СоответствиеВариантовОплаты = Новый Соответствие;
	СоответствиеВариантовОплаты.Вставить(ПредопределенноеЗначение("Перечисление.ВариантыОплатыКлиентом.АвансДоОбеспечения"),
		Новый Структура("Сумма, Проценты", "СуммаАвансаДоОбеспечения", "ПроцентАвансаДоОбеспечения"));
	СоответствиеВариантовОплаты.Вставить(ПредопределенноеЗначение("Перечисление.ВариантыОплатыКлиентом.ПредоплатаДоОтгрузки"),
		Новый Структура("Сумма, Проценты", "СуммаПредоплатыДоОтгрузки", "ПроцентПредоплатыДоОтгрузки"));
	СоответствиеВариантовОплаты.Вставить(ПредопределенноеЗначение("Перечисление.ВариантыОплатыКлиентом.КредитПослеОтгрузки"),
		Новый Структура("Сумма, Проценты", "СуммаКредитаПослеОтгрузки", "ПроцентКредитаПослеОтгрузки"));
	
	Для Каждого ТекСтрока Из Форма.Объект.ЭтапыГрафикаОплаты Цикл
		ПроцентПлатежейОбщий = ПроцентПлатежейОбщий + ТекСтрока.ПроцентПлатежа;
		ТекСтрока.ПроцентЗаполненНеВерно = (ПроцентПлатежейОбщий > 100);
		ТекСтрока.ДатаЗаполненаНеВерно = (ПредыдущееЗначениеДаты > ТекСтрока.ДатаПлатежа);
		ПредыдущееЗначениеДаты = ТекСтрока.ДатаПлатежа;
		Если ПроцентПлатежейОбщий = 100 Тогда
			Форма.НомерСтрокиПолнойОплаты = ТекСтрока.НомерСтроки;
		КонецЕсли;
		ИменаЭлементов = СоответствиеВариантовОплаты[ТекСтрока.ВариантОплаты];
		Если ИменаЭлементов <> Неопределено Тогда
			Форма[ИменаЭлементов.Сумма] = Форма[ИменаЭлементов.Сумма] + ТекСтрока.СуммаПлатежа;
			Форма[ИменаЭлементов.Проценты] = Форма[ИменаЭлементов.Проценты] + ТекСтрока.ПроцентПлатежа;
		КонецЕсли;
	КонецЦикла;
	
	// Выбор странцицы отображения НДС
	
	Если Форма.Объект.НалогообложениеНДС = ПредопределенноеЗначение("Перечисление.ТипыНалогообложенияНДС.ПродажаНеОблагаетсяНДС")
		ИЛИ Форма.Объект.НалогообложениеНДС = ПредопределенноеЗначение("Перечисление.ТипыНалогообложенияНДС.ПродажаОблагаетсяЕНВД") Тогда
		
		Форма.Элементы.ГруппаСтраницыНДС.ТекущаяСтраница   = Форма.Элементы.СтраницаБезНДС;
		Форма.Элементы.ГруппаСтраницыВсего.ТекущаяСтраница = Форма.Элементы.СтраницаВсегоБезНДС;
		
	Иначе
		
		Форма.Элементы.ГруппаСтраницыНДС.ТекущаяСтраница   = Форма.Элементы.СтраницаСНДС;
		Форма.Элементы.ГруппаСтраницыВсего.ТекущаяСтраница = Форма.Элементы.СтраницаВсегоСНДС;
		
	КонецЕсли;
	
КонецПроцедуры

&НаКлиентеНаСервереБезКонтекста
Процедура ЗаполнитьСтруктуруДействия(СтруктураДействий, ОбъектФормы)
	
	СтруктураПересчетаСуммы = ОбработкаТабличнойЧастиКлиентСервер.ПолучитьСтруктуруПересчетаСуммыНДСВСтрокеТЧ(ОбъектФормы);
	
	СтруктураДействий = Новый Структура;
	СтруктураДействий.Вставить("ПересчитатьКоличествоЕдиниц");
	
	СтруктураДействий.Вставить("ПересчитатьСуммуРучнойСкидки");
	СтруктураДействий.Вставить("ПересчитатьСумму");
	СтруктураДействий.Вставить("ПересчитатьСуммуСУчетомРучнойСкидки", Новый Структура("Очищать", Ложь));
	СтруктураДействий.Вставить("ПересчитатьСуммуСУчетомАвтоматическойСкидки", Новый Структура("Очищать", Ложь));
	СтруктураДействий.Вставить("ПересчитатьСуммуНДС", СтруктураПересчетаСуммы);
	СтруктураДействий.Вставить("ПересчитатьСуммуСНДС", СтруктураПересчетаСуммы);
	
	СтруктураДействий.Вставить("ЗаполнитьСодержание", 
								ОбработкаТабличнойЧастиКлиентСервер.ПолучитьСтруктуруЗаполненияСодержанияУслугиВСтрокеТЧ(ОбъектФормы, Ложь));
	СтруктураДействий.Вставить("ЗаполнитьДубликатыЗависимыхРеквизитов"		, ПолучитьСтруктуруЗависимыхРеквизитов());
	СтруктураДействий.Вставить("ЗаполнитьПризнакБезВозвратнойТары"			, ОбъектФормы.ВернутьМногооборотнуюТару);
	СтруктураДействий.Вставить("ЗаполнитьПризнакОтмененоБезВозвратнойТары"	, ОбъектФормы.ВернутьМногооборотнуюТару);
	
КонецПроцедуры

&НаКлиентеНаСервереБезКонтекста
Функция ПолучитьСтруктуруЗависимыхРеквизитов()
	
	Возврат Новый Структура(
		"БезВозвратнойТары,ОтмененоБезВозвратнойТары",
		"Сумма,СуммаНДС,СуммаСНДС,СуммаАвтоматическойСкидки,СуммаРучнойСкидки",
		"Сумма,СуммаНДС,СуммаСНДС,СуммаАвтоматическойСкидки,СуммаРучнойСкидки");
	
КонецФункции




////////////////////////////////////////////////////////////////////////////////
// ОБРАБОТЧИКИ СОБЫТИЙ   С ПРОВЕДЕНИЯМ ДОКУМЕНТА
&НаСервере
Функция ПровестиДокументНаСервере()
	ОтменаСтроки 		= 	ОтменитьСтрокуВЗаказеНаСервере();
	Возврат  ОтменаСтроки
КонецФункции // ПровестиДокументНаСервере()

&НаСервере
Процедура ОтменитьСтрокуВЗаказе(ЗаказСсылка,Назначение, Номенклатура)

	ПричиныОтмены 	= Справочники.ПричиныОтменыЗаказовПоставщикам.ПолучитьСсылку(Новый УникальныйИдентификатор("3b8e4dd8-221d-11e2-b1c4-14dae9dfbe72"));	
	ЗаказОбъект		= ЗаказСсылка.ПолучитьОбъект();
	Товары 			= ЗаказОбъект.Товары;
	СтруктураПоиска = Новый Структура("Номенклатура, Назначение", Номенклатура,Назначение);
	
	МассивСтрок = Товары.НайтиСтроки(СтруктураПоиска);
	
	Для каждого СтрокаТЧ Из МассивСтрок Цикл
		СтрокаТЧ.Отменено 		= Истина;    			
		СтрокаТЧ.ПричинаОтмены  = ПричиныОтмены;
	КонецЦикла; 
	
	Если МассивСтрок.Количество() > 0 Тогда
		ЗаказОбъект.ЗаполнитьЭтапыГрафикаОплаты();
		ЗаказОбъект.Записать(РежимЗаписиДокумента.Проведение);
	КонецЕсли;
	
КонецПроцедуры // ОтменитьСтрокуВЗаказе()

&НаСервере
Функция ОтменитьСтрокуВЗаказеНаСервере()
	
	Изменения	= 	НазначитьНазначенияНаСервере();
	ИтогДо		= 	Объект.ТоварыИзЗаказа.Итог("Количество");
	ИтогПосле	=	Объект.Товары.Итог("Количество");
	Если ИтогДо=ИтогПосле Тогда
		ДеревоСписокНоменклатуры 	= РеквизитФормыВЗначение("СписокНоменклатуры", Тип("ДеревоЗначений"));
		Для каждого СтрокаДерева Из ДеревоСписокНоменклатуры.Строки Цикл
			Номенклатура 				= СтрокаДерева.Номенклатура;
			Для каждого СтрокаПодстроки Из СтрокаДерева.Строки Цикл
				Если СтрокаПодстроки.Флаг Тогда
					ОтменитьСтрокуВЗаказе(СтрокаПодстроки.ЗаказПоставщику,СтрокаПодстроки.Назначение, Номенклатура);
				КонецЕсли;
			КонецЦикла;	
		КонецЦикла;
		ЗначениеВРеквизитФормы(ДеревоСписокНоменклатуры, "СписокНоменклатуры");
	Иначе  Изменения = Ложь;
	КонецЕсли;
	
	Возврат Изменения;
КонецФункции // ОтменитьСтрокуВЗаказеНаСервере()

&НаСервере
Функция НазначитьНазначенияНаСервере()
	СписокНоменклатурыИзменения = Новый СписокЗначений;

	ДеревоСписокНоменклатуры 	= РеквизитФормыВЗначение("СписокНоменклатуры", Тип("ДеревоЗначений"));  
	Для каждого СтрокаДерева Из ДеревоСписокНоменклатуры.Строки Цикл
		Номенклатура 				= СтрокаДерева.Номенклатура;
		ПараметрыОтбора = Новый Структура;
		ПараметрыОтбора.Вставить("Флаг", Истина);
		НайденныеСтроки = СтрокаДерева.Строки.НайтиСтроки(ПараметрыОтбора);
		
		Если НайденныеСтроки.Количество()>0 Тогда
			Изменения = ПеребратьТовар(НайденныеСтроки,Номенклатура);
			СписокНоменклатурыИзменения.Добавить(Номенклатура,"Номенклатура");
		КонецЕсли;
	КонецЦикла;
	БезИзменений = ЗаполнитьТаблицуТоваров(СписокНоменклатурыИзменения);

	
	Если Изменения = Неопределено Тогда
		Изменения = Ложь;
	Иначе
		Изменения = Истина;
	КонецЕсли;
	Возврат Изменения;
КонецФункции // 

&НаСервере
Функция ПеребратьТовар(Массив,Номенклатура)
Результат = ПроверитьнаЗаполненыйНазначенийВЗаказеИсточник(Номенклатура);
Если Результат  Тогда
	Заметка = НСтр("ru = 'Назначения для %Номенклатуры% не перенослось, так в заказе %ЗаказПостащику% оно уже заполенено '");
    ТекстСообщения = СтрЗаменить(Заметка,"%Номенклатуры%",Номенклатура);
	ТекстСообщения = СтрЗаменить(ТекстСообщения,"%ЗаказПостащику%", СслыкаНаДокумент);
	ОбщегоНазначенияКлиентСервер.СообщитьПользователю(ТекстСообщения);
	//Возврат Неопределено
КонецЕсли; 

СписокНазначний = Новый ТаблицаЗначений;
СписокНазначний.Колонки.Добавить("Номенклатура",Новый ОписаниеТипов("СправочникСсылка.Номенклатура"));
СписокНазначний.Колонки.Добавить("Назначение", Новый ОписаниеТипов("СправочникСсылка.Назначения"));
СписокНазначний.Колонки.Добавить("КоличествоДоп", Новый ОписаниеТипов("Число", Новый КвалификаторыЧисла(15, 2)));
Для Каждого Строка Из Массив Цикл
	Если  НЕ Строка.Назначение.Пустая() Тогда
	  	CтрокаТЗ = СписокНазначний.Добавить();
		ЗаполнитьЗначенияСвойств(CтрокаТЗ, Строка);
	КонецЕсли; 
КонецЦикла;

Если СписокНазначний.Количество()=0 Тогда
	 ЗаполнитьТаблицуТоваровБезНазначения(Номенклатура);
Иначе
	ПеребратьНазначенияДляТовара(СписокНазначний,Номенклатура);

КонецЕсли; 

Возврат Истина; 

КонецФункции // ПеребратьТовар()

&НаСервере
Функция ПроверитьнаЗаполненыйНазначенийВЗаказеИсточник(Номенклатура)
УстановитьПривилегированныйРежим(Истина);	
Запрос = Новый Запрос();                                                                             
Запрос.Текст = ПолучитьТекстЗапросаПроверкиЗаполненогоНазначения();
Запрос.УстановитьПараметр("Товары",Объект.ТоварыИзЗаказа.Выгрузить());
Запрос.УстановитьПараметр("Номенклатура",Номенклатура);
РезультатЗапроса = Запрос.Выполнить();
Если РезультатЗапроса.Пустой()  Тогда
 	Возврат Истина;
КонецЕсли; 
Возврат Ложь;
КонецФункции // ПроверитьнаЗаполненыйНазначенийВЗаказеИсточник()

&НаСервере
Функция ПеребратьНазначенияДляТовара(СписокНазначения,Номенклатура)
УстановитьПривилегированныйРежим(Истина);	
Запрос = Новый Запрос();
Запрос.Текст = ПолучитьТекстЗапросаВыбораНазначения();
Запрос.УстановитьПараметр("Товары", Объект.ТоварыИзЗаказа.Выгрузить());
Запрос.УстановитьПараметр("Номенклатура" , Номенклатура);
Запрос.УстановитьПараметр("СписокНазначения",СписокНазначения);
Результат = Запрос.Выполнить();
Если Результат.Пустой()  Тогда
	Возврат Неопределено
КонецЕсли;
Выборка = Результат.Выбрать();
Пока Выборка.Следующий() Цикл
	НоваяСтрока = Объект.Товары.Добавить();
	ЗаполнитьЗначенияСвойств(НоваяСтрока,Выборка);
КонецЦикла; 
//Объект.Товары.Добавить(Результат.Выгрузить());              
КонецФункции // СписокНазначний()

&НаСервере
Функция ЗаполнитьТаблицуТоваров(Номенклатура)
УстановитьПривилегированныйРежим(Истина);	
Запрос = Новый Запрос();
Запрос.Текст = ПолучитьТекстЗапросаТаблициТоваровНоменклатуры();
Запрос.УстановитьПараметр("Ссылка" , СслыкаНаДокумент);
Запрос.УстановитьПараметр("Товары", Объект.ТоварыИзЗаказа.Выгрузить());
Запрос.УстановитьПараметр("Номенклатура" , Номенклатура);
Результат = Запрос.Выполнить();
Если Результат.Пустой()  Тогда
	Возврат Неопределено
КонецЕсли;
Выборка = Результат.Выбрать();
Пока Выборка.Следующий() Цикл
	НоваяСтрока = Объект.Товары.Добавить();
	ЗаполнитьЗначенияСвойств(НоваяСтрока,Выборка);
КонецЦикла; 
Возврат Истина; 
КонецФункции // ЗаполнитьТаблицуТоваров(Номенклатура)()

&НаСервере
Функция ЗаполнитьТаблицуТоваровБезНазначения(Номенклатура)
УстановитьПривилегированныйРежим(Истина);	
Запрос = Новый Запрос();
Запрос.Текст = ПолучитьТекстЗапросаТаблициТоваровНоменклатурыБезНазначения();
Запрос.УстановитьПараметр("Ссылка" , СслыкаНаДокумент);
Запрос.УстановитьПараметр("Товары", Объект.ТоварыИзЗаказа.Выгрузить());
Запрос.УстановитьПараметр("Номенклатура" , Номенклатура);
Результат = Запрос.Выполнить();
Если Результат.Пустой()  Тогда
	Возврат Неопределено
КонецЕсли;
Выборка = Результат.Выбрать();
Пока Выборка.Следующий() Цикл
	НоваяСтрока = Объект.Товары.Добавить();
	ЗаполнитьЗначенияСвойств(НоваяСтрока,Выборка);
КонецЦикла; 
Возврат Истина; 
КонецФункции // ЗаполнитьТаблицуТоваров(Номенклатура)()




////////////////////////////////////////////////////////////////////////////////
// ТЕКСТИ ЗАПРОСОВ
&НаСервере
Функция ПолучитьТекстЗапросаПроверкиЗаполненогоНазначения()
ТекстЗапроса ="ВЫБРАТЬ
              |	ЗаказПоставщикуТовары.Номенклатура,
              |	ЗаказПоставщикуТовары.Количество,
              |	ЗаказПоставщикуТовары.Назначение
              |ПОМЕСТИТЬ Кеш
              |ИЗ
              |	&Товары КАК ЗаказПоставщикуТовары
              |ГДЕ
              |	ЗаказПоставщикуТовары.Номенклатура = &Номенклатура
              |	И ЗаказПоставщикуТовары.Назначение = ЗНАЧЕНИЕ(Справочник.Назначения.ПустаяСсылка)
              |;
              |
              |////////////////////////////////////////////////////////////////////////////////
              |ВЫБРАТЬ
              |	Кеш.Номенклатура,
              |	Кеш.Количество,
              |	Кеш.Назначение
              |ИЗ
              |	Кеш КАК Кеш";
	
 Возврат ТекстЗапроса;
КонецФункции //
&НаСервере
Функция ПолучитьТекстЗапросаВыбораНазначения()
ТекстЗапроса="ВЫБРАТЬ
             |	ЗаказПоставщикуТовары.НоменклатураПоставщика,
             |	ЗаказПоставщикуТовары.Номенклатура,
             |	ЗаказПоставщикуТовары.Характеристика,
             |	ЗаказПоставщикуТовары.Упаковка,
             |	ЗаказПоставщикуТовары.КоличествоУпаковок КАК КоличествоУпаковок,
             |	ЗаказПоставщикуТовары.Количество КАК Количество,
             |	ЗаказПоставщикуТовары.ДатаПоступления КАК ДатаПоступления,
             |	ЗаказПоставщикуТовары.УсловиеЦеныПоставщика,
             |	ЗаказПоставщикуТовары.Цена КАК Цена,
             |	ЗаказПоставщикуТовары.Сумма КАК Сумма,
             |	ЗаказПоставщикуТовары.ПроцентРучнойСкидки,
             |	ЗаказПоставщикуТовары.СуммаРучнойСкидки,
             |	ЗаказПоставщикуТовары.СтавкаНДС,
             |	ЗаказПоставщикуТовары.СуммаНДС КАК СуммаНДС,
             |	ЗаказПоставщикуТовары.СуммаСНДС КАК СуммаСНДС,
             |	ЗаказПоставщикуТовары.СтатьяРасходов,
             |	ЗаказПоставщикуТовары.АналитикаРасходов,
             |	ЗаказПоставщикуТовары.Склад,
             |	ЗаказПоставщикуТовары.Назначение,
             |	ЗаказПоставщикуТовары.Отменено,
             |	ЗаказПоставщикуТовары.ПричинаОтмены
             |ПОМЕСТИТЬ КешТовары
             |ИЗ
             |	&Товары КАК ЗаказПоставщикуТовары
             |ГДЕ
             |	ЗаказПоставщикуТовары.Номенклатура = &Номенклатура
             |	И ЗаказПоставщикуТовары.Назначение = ЗНАЧЕНИЕ(Справочник.Назначения.ПустаяСсылка)
             |	И НЕ ЗаказПоставщикуТовары.Отменено 
			 | ;
			 |ВЫБРАТЬ
			 |	ЗаказПоставщикуТовары.НоменклатураПоставщика,
			 |	ЗаказПоставщикуТовары.Номенклатура,
			 |	ЗаказПоставщикуТовары.Характеристика,
			 |	ЗаказПоставщикуТовары.Упаковка,
			 |	СУММА(ЗаказПоставщикуТовары.КоличествоУпаковок) КАК КоличествоУпаковок,
			 |	СУММА(ЗаказПоставщикуТовары.Количество) КАК Количество,
			 |	МАКСИМУМ(ЗаказПоставщикуТовары.ДатаПоступления) КАК ДатаПоступления,
			 |	ЗаказПоставщикуТовары.УсловиеЦеныПоставщика,
			 |	МАКСИМУМ(ЗаказПоставщикуТовары.Цена) КАК Цена,
			 |	МАКСИМУМ(ЗаказПоставщикуТовары.Сумма) КАК Сумма,
			 |	ЗаказПоставщикуТовары.ПроцентРучнойСкидки,
			 |	ЗаказПоставщикуТовары.СуммаРучнойСкидки,
			 |	ЗаказПоставщикуТовары.СтавкаНДС,
			 |	МАКСИМУМ(ЗаказПоставщикуТовары.СуммаНДС) КАК СуммаНДС,
			 |	МАКСИМУМ(ЗаказПоставщикуТовары.СуммаСНДС) КАК СуммаСНДС,
			 |	ЗаказПоставщикуТовары.СтатьяРасходов,
			 |	ЗаказПоставщикуТовары.АналитикаРасходов,
			 |	ЗаказПоставщикуТовары.Склад,
			 |	ЗаказПоставщикуТовары.Назначение,
			 |	ЗаказПоставщикуТовары.Отменено,
			 |	ЗаказПоставщикуТовары.ПричинаОтмены
			 |ПОМЕСТИТЬ КешЗаказПоставщику
			 |ИЗ
			 |	КешТовары КАК ЗаказПоставщикуТовары
			 |ГДЕ
			 |	ЗаказПоставщикуТовары.Номенклатура = &Номенклатура
			 |	И ЗаказПоставщикуТовары.Назначение = ЗНАЧЕНИЕ(Справочник.Назначения.ПустаяСсылка)
			 |	И НЕ ЗаказПоставщикуТовары.Отменено
			 |
			 |СГРУППИРОВАТЬ ПО
			 |	ЗаказПоставщикуТовары.Номенклатура,
			 |	ЗаказПоставщикуТовары.Характеристика,
			 |	ЗаказПоставщикуТовары.Упаковка,
			 |	ЗаказПоставщикуТовары.УсловиеЦеныПоставщика,
			 |	ЗаказПоставщикуТовары.СтавкаНДС,
			 |	ЗаказПоставщикуТовары.СтатьяРасходов,
			 |	ЗаказПоставщикуТовары.АналитикаРасходов,
			 |	ЗаказПоставщикуТовары.Склад,
			 |	ЗаказПоставщикуТовары.Назначение,
			 |	ЗаказПоставщикуТовары.НоменклатураПоставщика,
			 |	ЗаказПоставщикуТовары.ПроцентРучнойСкидки,
			 |	ЗаказПоставщикуТовары.СуммаРучнойСкидки,
			 |	ЗаказПоставщикуТовары.Отменено,
			 |	ЗаказПоставщикуТовары.ПричинаОтмены 
			 |;
			 |
			 |////////////////////////////////////////////////////////////////////////////////
			 |ВЫБРАТЬ
			 |	&Номенклатура КАК Номенклатура,
			 |	ОбеспечениеЗаказовОстатки.Назначение,
			 |	ОбеспечениеЗаказовОстатки.КоличествоДоп КАК ЗаказаноОстаток
			 |ПОМЕСТИТЬ КешОбеспечениеЗаказовОстатки
			 |ИЗ
			 |	&СписокНазначения КАК ОбеспечениеЗаказовОстатки                              
			 |;
			 |
			 |////////////////////////////////////////////////////////////////////////////////
			 |ВЫБРАТЬ
			 |	КешОбеспечениеЗаказовОстатки.Назначение.Заказ.Дата КАК Период,
			 |	КешОбеспечениеЗаказовОстатки.Номенклатура,
			 |	КешОбеспечениеЗаказовОстатки.Назначение,
			 |	КешОбеспечениеЗаказовОстатки.ЗаказаноОстаток КАК ЗаказаноОстаток,
			 |	КешЗаказПоставщику.Количество
			 |ПОМЕСТИТЬ КешНазначения
			 |ИЗ
			 |	КешОбеспечениеЗаказовОстатки КАК КешОбеспечениеЗаказовОстатки
			 |		ВНУТРЕННЕЕ СОЕДИНЕНИЕ КешЗаказПоставщику КАК КешЗаказПоставщику
			 |		ПО КешОбеспечениеЗаказовОстатки.Номенклатура = КешЗаказПоставщику.Номенклатура
			 |ГДЕ
			 |	КешОбеспечениеЗаказовОстатки.ЗаказаноОстаток <> 0
			 |;
			 |
			 |////////////////////////////////////////////////////////////////////////////////
			 |ВЫБРАТЬ
			 |	КешНазначения.Период,
			 |	КешНазначения.Номенклатура,
			 |	КешНазначения.Назначение,
			 |	СУММА(ЕСТЬNULL(КопияКешНазначения.ЗаказаноОстаток, 0)) КАК ЗаказаноОстатокПосле,
			 |	СУММА(ЕСТЬNULL(КопияКешНазначения.ЗаказаноОстаток, 0)) - КешНазначения.ЗаказаноОстаток КАК ЗаказаноОстатокДо,
			 |	КешНазначения.Количество
			 |ПОМЕСТИТЬ КешИтоги
			 |ИЗ
			 |	КешНазначения КАК КешНазначения
			 |		ЛЕВОЕ СОЕДИНЕНИЕ КешНазначения КАК КопияКешНазначения
			 |		ПО КешНазначения.Номенклатура = КопияКешНазначения.Номенклатура
			 |			И (ВЫБОР
			 |				КОГДА КешНазначения.Период = КопияКешНазначения.Период
			 |					ТОГДА ВЫРАЗИТЬ(КешНазначения.Назначение КАК Справочник.Назначения).Заказ >= ВЫРАЗИТЬ(КопияКешНазначения.Назначение КАК Справочник.Назначения).Заказ
			 |				ИНАЧЕ КешНазначения.Период >= КопияКешНазначения.Период
			 |			КОНЕЦ)
			 |
			 |СГРУППИРОВАТЬ ПО
			 |	КешНазначения.Период,
			 |	КешНазначения.Назначение,
			 |	КешНазначения.Номенклатура,
			 |	КешНазначения.Количество,
			 |	КешНазначения.ЗаказаноОстаток
			 |;
			 |
			 |////////////////////////////////////////////////////////////////////////////////
			 |ВЫБРАТЬ
			 |	КешИтоги.Период,
			 |	КешИтоги.Номенклатура,
			 |	КешИтоги.Назначение,
			 |	КешИтоги.Количество - КешИтоги.ЗаказаноОстатокДо КАК ЗаказаноОстатокДо,
			 |	КешИтоги.Количество - КешИтоги.ЗаказаноОстатокПосле КАК ЗаказаноОстатокПосле
			 |ПОМЕСТИТЬ КешРазбивкаСтрок
			 |ИЗ
			 |	КешИтоги КАК КешИтоги
			 |;
			 |   			 
			 |	ВЫБРАТЬ
			 |		КешРазбивкаСтрок.Номенклатура,
			 |		МИНИМУМ(КешРазбивкаСтрок.ЗаказаноОстатокДо) как ЗаказаноОстатокДо,
			 |		МИНИМУМ(КешРазбивкаСтрок.ЗаказаноОстатокПосле) как ЗаказаноОстатокПосле
			 |	ПОМЕСТИТЬ КешМинимумЗаказано
			 |	ИЗ
			 |		КешРазбивкаСтрок КАК КешРазбивкаСтрок
			 |	
			 |	СГРУППИРОВАТЬ ПО
			 |		КешРазбивкаСтрок.Номенклатура
			 |   ;
			 |	
			 |	////////////////////////////////////////////////////////////////////////////////
			 |	ВЫБРАТЬ
			 |		КешРазбивкаСтрок.Номенклатура,
			 |		КешРазбивкаСтрок.Назначение,
			 |		КешРазбивкаСтрок.ЗаказаноОстатокДо КАК ЗаказаноОстатокДо,
			 |		КешРазбивкаСтрок.ЗаказаноОстатокПосле КАК ЗаказаноОстатокПосле
			 |	ПОМЕСТИТЬ РазбивкаСтрокБезНазначения
			 |	ИЗ
			 |		КешРазбивкаСтрок КАК КешРазбивкаСтрок
			 |	ГДЕ
			 |		КешРазбивкаСтрок.ЗаказаноОстатокДо > 0
			 |		
			 |	
			 |	ОБЪЕДИНИТЬ ВСЕ
			 |	
			 |	ВЫБРАТЬ
			 |		КешРазбивкаСтрок.Номенклатура,
			 |		ЗНАЧЕНИЕ(Справочник.Назначения.ПустаяСсылка),
			 |		КешРазбивкаСтрок.ЗаказаноОстатокПосле,
			 |		0
			 |	ИЗ
			 |		КешМинимумЗаказано КАК КешРазбивкаСтрок
			 |	ГДЕ
			 |		КешРазбивкаСтрок.ЗаказаноОстатокДо > 0
			 |		И КешРазбивкаСтрок.ЗаказаноОстатокПосле > 0
			 |	
			 |	;
			 |
			 |////////////////////////////////////////////////////////////////////////////////
			 |ВЫБРАТЬ РАЗЛИЧНЫЕ
			 |	РазбивкаСтрокБезНазначения.Номенклатура,
			 |	РазбивкаСтрокБезНазначения.Назначение,
			 |	КешЗаказПоставщику.НоменклатураПоставщика,
			 |	КешЗаказПоставщику.Характеристика,
			 |	КешЗаказПоставщику.Упаковка,
			 |	ВЫБОР
			 |		КОГДА РазбивкаСтрокБезНазначения.Назначение = ЗНАЧЕНИЕ(Справочник.Назначения.ПустаяСсылка)
			 |			ТОГДА РазбивкаСтрокБезНазначения.ЗаказаноОстатокДо
			 |		Когда РазбивкаСтрокБезНазначения.ЗаказаноОстатокДо>0 И   РазбивкаСтрокБезНазначения.ЗаказаноОстатокПосле<=0
			 |   		Тогда  РазбивкаСтрокБезНазначения.ЗаказаноОстатокДо
			 |		ИНАЧЕ КешНазначения.ЗаказаноОстаток
			 |	КОНЕЦ КАК КоличествоУпаковок,
			 |	ВЫБОР
			 |		КОГДА РазбивкаСтрокБезНазначения.Назначение = ЗНАЧЕНИЕ(Справочник.Назначения.ПустаяСсылка)
			 |			ТОГДА РазбивкаСтрокБезНазначения.ЗаказаноОстатокДо
			 |		Когда РазбивкаСтрокБезНазначения.ЗаказаноОстатокДо>0 И   РазбивкаСтрокБезНазначения.ЗаказаноОстатокПосле<=0
			 |   		Тогда  РазбивкаСтрокБезНазначения.ЗаказаноОстатокДо
			 |		ИНАЧЕ КешНазначения.ЗаказаноОстаток
			 |	КОНЕЦ КАК Количество,
			 |	КешЗаказПоставщику.ДатаПоступления,
			 |	КешЗаказПоставщику.УсловиеЦеныПоставщика,
			 |	КешЗаказПоставщику.Цена,
			 |	КешЗаказПоставщику.Сумма,
			 |	КешЗаказПоставщику.ПроцентРучнойСкидки,
			 |	КешЗаказПоставщику.СуммаРучнойСкидки,
			 |	КешЗаказПоставщику.СтавкаНДС,
			 |	КешЗаказПоставщику.СуммаНДС,
			 |	КешЗаказПоставщику.СуммаСНДС,
			 |	КешЗаказПоставщику.СтатьяРасходов,
			 |	КешЗаказПоставщику.АналитикаРасходов,
			 |	КешЗаказПоставщику.Склад,
			 |	КешЗаказПоставщику.Отменено КАК Отменено,
			 |	КешЗаказПоставщику.ПричинаОтмены КАК ПричинаОтмены
			 |ПОМЕСТИТЬ КешНазначениТоваров
			 |ИЗ
			 |	РазбивкаСтрокБезНазначения КАК РазбивкаСтрокБезНазначения
			 |		ВНУТРЕННЕЕ СОЕДИНЕНИЕ КешЗаказПоставщику КАК КешЗаказПоставщику
			 |		ПО РазбивкаСтрокБезНазначения.Номенклатура = КешЗаказПоставщику.Номенклатура
			 |		ЛЕВОЕ СОЕДИНЕНИЕ КешНазначения КАК КешНазначения
			 |		ПО РазбивкаСтрокБезНазначения.Номенклатура = КешНазначения.Номенклатура
			 |			И РазбивкаСтрокБезНазначения.Назначение = КешНазначения.Назначение
			 |;
			 |ВЫБРАТЬ
			 |	ЗаказПоставщикуТовары.Номенклатура,
			 |	ЗаказПоставщикуТовары.Назначение,
			 |	ЗаказПоставщикуТовары.НоменклатураПоставщика,
			 |	ЗаказПоставщикуТовары.Характеристика,
			 |	ЗаказПоставщикуТовары.Упаковка,
			 |	ЗаказПоставщикуТовары.КоличествоУпаковок,
			 |	ЗаказПоставщикуТовары.Количество,
			 |	ЗаказПоставщикуТовары.ДатаПоступления,
			 |	ЗаказПоставщикуТовары.УсловиеЦеныПоставщика,
			 |	ЗаказПоставщикуТовары.Цена,
			 |	ЗаказПоставщикуТовары.Сумма,
			 |	ЗаказПоставщикуТовары.ПроцентРучнойСкидки,
			 |	ЗаказПоставщикуТовары.СуммаРучнойСкидки,
			 |	ЗаказПоставщикуТовары.СтавкаНДС,
			 |	ЗаказПоставщикуТовары.СуммаНДС,
			 |	ЗаказПоставщикуТовары.СуммаСНДС,
			 |	ЗаказПоставщикуТовары.СтатьяРасходов,
			 |	ЗаказПоставщикуТовары.АналитикаРасходов,
			 |	ЗаказПоставщикуТовары.Склад,
			 |	ЗаказПоставщикуТовары.Отменено,
			 |	ЗаказПоставщикуТовары.ПричинаОтмены
			 |  Поместить КешЗАказТовары
			 |ИЗ
			 |	&Товары КАК ЗаказПоставщикуТовары
			 |ГДЕ
			 |	ЗаказПоставщикуТовары.Номенклатура = &Номенклатура
			 |	И ЗаказПоставщикуТовары.Назначение <> ЗНАЧЕНИЕ(Справочник.Назначения.ПустаяСсылка)
			 | ;
			 |
			 |////////////////////////////////////////////////////////////////////////////////
			 |ВЫБРАТЬ РАЗЛИЧНЫЕ
			 |	КешЗаказПоставщику.Номенклатура,
			 |	КешЗаказПоставщику.Назначение,
			 |	КешЗаказПоставщику.НоменклатураПоставщика,
			 |	КешЗаказПоставщику.Характеристика,
			 |	КешЗаказПоставщику.Упаковка,
			 |	КешЗаказПоставщику.КоличествоУпаковок КАК КоличествоУпаковок,
			 |	КешЗаказПоставщику.Количество КАК Количество,
			 |	КешЗаказПоставщику.ДатаПоступления,
			 |	КешЗаказПоставщику.УсловиеЦеныПоставщика,
			 |	КешЗаказПоставщику.Цена,
			 |	КешЗаказПоставщику.Сумма,
			 |	КешЗаказПоставщику.ПроцентРучнойСкидки,
			 |	КешЗаказПоставщику.СуммаРучнойСкидки,
			 |	КешЗаказПоставщику.СтавкаНДС,
			 |	КешЗаказПоставщику.СуммаНДС,
			 |	КешЗаказПоставщику.СуммаСНДС,
			 |	КешЗаказПоставщику.СтатьяРасходов,
			 |	КешЗаказПоставщику.АналитикаРасходов,
			 |	КешЗаказПоставщику.Склад,
			 |	КешЗаказПоставщику.Отменено КАК Отменено,
			 |	КешЗаказПоставщику.ПричинаОтмены КАК ПричинаОтмены
			 |
			 |ИЗ
			 |	КешНазначениТоваров КАК КешЗаказПоставщику
			 |
			 |ОБЪЕДИНИТЬ ВСЕ
			 |
			 |ВЫБРАТЬ
			 |	ЗаказПоставщикуТовары.Номенклатура,
			 |	ЗаказПоставщикуТовары.Назначение,
			 |	ЗаказПоставщикуТовары.НоменклатураПоставщика,
			 |	ЗаказПоставщикуТовары.Характеристика,
			 |	ЗаказПоставщикуТовары.Упаковка,
			 |	ЗаказПоставщикуТовары.КоличествоУпаковок,
			 |	ЗаказПоставщикуТовары.Количество,
			 |	ЗаказПоставщикуТовары.ДатаПоступления,
			 |	ЗаказПоставщикуТовары.УсловиеЦеныПоставщика,
			 |	ЗаказПоставщикуТовары.Цена,
			 |	ЗаказПоставщикуТовары.Сумма,
			 |	ЗаказПоставщикуТовары.ПроцентРучнойСкидки,
			 |	ЗаказПоставщикуТовары.СуммаРучнойСкидки,
			 |	ЗаказПоставщикуТовары.СтавкаНДС,
			 |	ЗаказПоставщикуТовары.СуммаНДС,
			 |	ЗаказПоставщикуТовары.СуммаСНДС,
			 |	ЗаказПоставщикуТовары.СтатьяРасходов,
			 |	ЗаказПоставщикуТовары.АналитикаРасходов,
			 |	ЗаказПоставщикуТовары.Склад,
			 |	ЗаказПоставщикуТовары.Отменено,
			 |	ЗаказПоставщикуТовары.ПричинаОтмены
			 |ИЗ
			 |	КешЗАказТовары КАК ЗаказПоставщикуТовары";
Возврат ТекстЗапроса;
КонецФункции // ()
&НаСервере
Функция ПолучитьТекстЗапросаТаблициТоваровНоменклатуры()
ТекстЗапроса="ВЫБРАТЬ
             |	ЗаказПоставщикуТовары.Номенклатура,
             |	ЗаказПоставщикуТовары.Назначение,
             |	ЗаказПоставщикуТовары.НоменклатураПоставщика,
             |	ЗаказПоставщикуТовары.Характеристика,
             |	ЗаказПоставщикуТовары.Упаковка,
             |	ЗаказПоставщикуТовары.КоличествоУпаковок,
             |	ЗаказПоставщикуТовары.Количество,
             |	ЗаказПоставщикуТовары.ДатаПоступления,
             |	ЗаказПоставщикуТовары.УсловиеЦеныПоставщика,
             |	ЗаказПоставщикуТовары.Цена,
             |	ЗаказПоставщикуТовары.Сумма,
             |	ЗаказПоставщикуТовары.ПроцентРучнойСкидки,
             |	ЗаказПоставщикуТовары.СуммаРучнойСкидки,
             |	ЗаказПоставщикуТовары.СтавкаНДС,
             |	ЗаказПоставщикуТовары.СуммаНДС,
             |	ЗаказПоставщикуТовары.СуммаСНДС,
             |	ЗаказПоставщикуТовары.СтатьяРасходов,
             |	ЗаказПоставщикуТовары.АналитикаРасходов,
             |	ЗаказПоставщикуТовары.Склад,
             |	ЗаказПоставщикуТовары.Отменено,
             |	ЗаказПоставщикуТовары.ПричинаОтмены
             |ПОМЕСТИТЬ Кеш
             |ИЗ
             |	&Товары КАК ЗаказПоставщикуТовары
             |ГДЕ
             |	НЕ ЗаказПоставщикуТовары.Номенклатура В (&Номенклатура)
             |;
             |
             |////////////////////////////////////////////////////////////////////////////////
             |ВЫБРАТЬ
             |	Кеш.Номенклатура,
             |	Кеш.Назначение,
             |	Кеш.НоменклатураПоставщика,
             |	Кеш.Характеристика,
             |	Кеш.Упаковка,
             |	Кеш.КоличествоУпаковок,
             |	Кеш.Количество,
             |	Кеш.ДатаПоступления,
             |	Кеш.УсловиеЦеныПоставщика,
             |	Кеш.Цена,
             |	Кеш.Сумма,
             |	Кеш.ПроцентРучнойСкидки,
             |	Кеш.СуммаРучнойСкидки,
             |	Кеш.СтавкаНДС,
             |	Кеш.СуммаНДС,
             |	Кеш.СуммаСНДС,
             |	Кеш.СтатьяРасходов,
             |	Кеш.АналитикаРасходов,
             |	Кеш.Склад,
             |	Кеш.Отменено,
             |	Кеш.ПричинаОтмены
             |ИЗ
             |	Кеш КАК Кеш";

Возврат ТекстЗапроса;
КонецФункции // ПолучитьТекстЗапросаТаблициТоваровНоменклатуры()

&НаСервере
Функция ПолучитьТекстЗапросаТаблициТоваровНоменклатурыБезНазначения()
ТекстЗапроса="ВЫБРАТЬ
             |	ЗаказПоставщикуТовары.Номенклатура,
             |	ЗаказПоставщикуТовары.Назначение,
             |	ЗаказПоставщикуТовары.НоменклатураПоставщика,
             |	ЗаказПоставщикуТовары.Характеристика,
             |	ЗаказПоставщикуТовары.Упаковка,
             |	ЗаказПоставщикуТовары.КоличествоУпаковок,
             |	ЗаказПоставщикуТовары.Количество,
             |	ЗаказПоставщикуТовары.ДатаПоступления,
             |	ЗаказПоставщикуТовары.УсловиеЦеныПоставщика,
             |	ЗаказПоставщикуТовары.Цена,
             |	ЗаказПоставщикуТовары.Сумма,
             |	ЗаказПоставщикуТовары.ПроцентРучнойСкидки,
             |	ЗаказПоставщикуТовары.СуммаРучнойСкидки,
             |	ЗаказПоставщикуТовары.СтавкаНДС,
             |	ЗаказПоставщикуТовары.СуммаНДС,
             |	ЗаказПоставщикуТовары.СуммаСНДС,
             |	ЗаказПоставщикуТовары.СтатьяРасходов,
             |	ЗаказПоставщикуТовары.АналитикаРасходов,
             |	ЗаказПоставщикуТовары.Склад,
             |	ЗаказПоставщикуТовары.Отменено,
             |	ЗаказПоставщикуТовары.ПричинаОтмены
             |ПОМЕСТИТЬ Кеш
             |ИЗ
             |	&Товары КАК ЗаказПоставщикуТовары
             |ГДЕ
             |	ЗаказПоставщикуТовары.Номенклатура = &Номенклатура
             |;
             |
             |////////////////////////////////////////////////////////////////////////////////
             |ВЫБРАТЬ
             |	Кеш.Номенклатура,
             |	Кеш.Назначение,
             |	Кеш.НоменклатураПоставщика,
             |	Кеш.Характеристика,
             |	Кеш.Упаковка,
             |	Кеш.КоличествоУпаковок,
             |	Кеш.Количество,
             |	Кеш.ДатаПоступления,
             |	Кеш.УсловиеЦеныПоставщика,
             |	Кеш.Цена,
             |	Кеш.Сумма,
             |	Кеш.ПроцентРучнойСкидки,
             |	Кеш.СуммаРучнойСкидки,
             |	Кеш.СтавкаНДС,
             |	Кеш.СуммаНДС,
             |	Кеш.СуммаСНДС,
             |	Кеш.СтатьяРасходов,
             |	Кеш.АналитикаРасходов,
             |	Кеш.Склад,
             |	Кеш.Отменено,
             |	Кеш.ПричинаОтмены
             |ИЗ
             |	Кеш КАК Кеш";

Возврат ТекстЗапроса;
КонецФункции // ПолучитьТекстЗапросаТаблициТоваровНоменклатуры()














 

