#Область ИнтерфейсАвтоматическихТестов

&НаКлиенте
Перем ЮнитТест;

&НаКлиенте
Функция ПолучитьСписокТестов(ЮнитТестирование) Экспорт
	
	ЮнитТест = ЮнитТестирование;
	
	СписокТестов = Новый Массив;	
	Возврат СписокТестов;
	
КонецФункции

#КонецОбласти

#Область ОбработчикиСобытийЭлементовШапкиФормы

&НаКлиенте
Процедура НомерМестаОкончаниеВводаТекста(Элемент, Текст, ДанныеВыбора, СтандартнаяОбработка)
	Закрыть(ВывестиСписокДокументов(Текст));
КонецПроцедуры

&НаКлиенте
Процедура ШтрихкодОкончаниеВводаТекста(Элемент, Текст, ДанныеВыбора, СтандартнаяОбработка)
	Закрыть(ВывестиСписокДокументов(Текст, Истина));
КонецПроцедуры


&НаСервере
Функция ВывестиСписокДокументов(НомерМеста, Штрихкод=Ложь)

	УстановитьПривилегированныйРежим(Истина);
	
	Если Штрихкод Тогда
		МестоСсылка = ШтрихкодированиеПечатныхФорм.ПолучитьСсылкуПоШтрихкодуТабличногоДокумента(НомерМеста);
	Иначе
		ПолныйНомерМеста = "000000000000000" + НомерМеста;
		ПолныйНомерМеста = Прав(ПолныйНомерМеста, 15);
	КонецЕсли;
	
	Запрос 		 = Новый Запрос;
	Запрос.Текст = ПолучитьТекстЗапросаСписокДокументов(Штрихкод);
	
	Если Штрихкод Тогда
		Запрос.УстановитьПараметр("Ссылка", МестоСсылка);
	Иначе
		Запрос.УстановитьПараметр("Код", ПолныйНомерМеста);
	КонецЕсли;
		
	Выборка = Запрос.Выполнить().Выбрать();
		
	Возврат ?(Выборка.Следующий(), Выборка.Место, Неопределено);
	
КонецФункции // ВывестиСписокДокументовПоНомеруМеста()
 
&НаСервере
Функция ПолучитьТекстЗапросаСписокДокументов(Штрихкод)

	ТекстЗапроса = "
			|ВЫБРАТЬ
			|	Ссылка КАК Место
			|ИЗ
			|	Справочник.МестаДоставки			
			|ГДЕ
			|	%Отбор%";
			
	Если Штрихкод Тогда
		ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "%Отбор%", "Ссылка=&Ссылка");
	Иначе
		ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "%Отбор%", "Код=&Код");
	КонецЕсли;
	
	
	Возврат ТекстЗапроса;

КонецФункции // ПолучитьТекстЗапросаСписокДокументовПоНомеру()

#КонецОбласти

 