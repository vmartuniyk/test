
#Область ОбработчикиСобытийФормы

&НаКлиенте
Процедура ПриОткрытии(Отказ)
	СформироватьСписокПринтеров();
КонецПроцедуры

#КонецОбласти 


#Область ОбработчикиСобытийЭлементовШапкиФормы

&НаКлиенте
Процедура ИмяПринтераНачалоВыбора(Элемент, ДанныеВыбора, СтандартнаяОбработка)
	
	СтандартнаяОбработка = Ложь;
	
	ВыбранныйПринтер = СписокПринтеров.ВыбратьЭлемент(НСтр("ru='Выберите имя принтера'", ОбщегоНазначенияКлиентСервер.КодОсновногоЯзыка()));
	
	Если ВыбранныйПринтер = Неопределено Тогда
	    Возврат;	
	КонецЕсли; 
	
	ИмяПринтера = ВыбранныйПринтер.Значение;
	
КонецПроцедуры

#КонецОбласти 


#Область СлужебныеПроцедурыИФункции

&НаКлиенте
Процедура СформироватьСписокПринтеров()
	
	ИмяКомпьютера=".";
	ServiceSet=GetCOMObject("winmgmts:{impersonationLevel=impersonate}!\\"+ИмяКомпьютера+"\root\cimv2");
	PrinterSet=ServiceSet.Get("Win32_Printer");
	
	Попытка
		mItems=ServiceSet.ExecQuery("Select * from Win32_Printer");
	Исключение
		Сообщить(ОписаниеОшибки());
		Отказ=Истина;
		Возврат;
	КонецПопытки;
	
	Для каждого Принтер Из mItems Цикл
		НоваяСтрока 				= СписокПринтеров.Добавить();
		НоваяСтрока.Значение 		= Принтер.Name;
		НоваяСтрока.Представление	= Принтер.Name;
	КонецЦикла; 
	
КонецПроцедуры

#КонецОбласти 