#Область ИнтерфейсАвтоматическихТестов

&НаКлиенте
Перем ЮнитТест;

&НаКлиенте
Функция ПолучитьСписокТестов(ЮнитТестирование) Экспорт
	
	ЮнитТест = ЮнитТестирование;
	
	СписокТестов = Новый Массив;	
	Возврат СписокТестов;
	
КонецФункции

#КонецОбласти

#Область ОбработчикиСобытийФормы
&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	Если Параметры.Свойство("АвтоТест") Тогда
		Возврат;	
	КонецЕсли;

	//Если РольДоступна(Метаданные.Роли.ПолныеПрава) ИЛИ РольДоступна(Метаданные.Роли.КТС_РедактированиеQRКодаМеста) Тогда
	//	Элементы.ТабДок.ТолькоПросмотр = Ложь;
	//	Элементы.ТабДок.Редактирование = Истина;
	//КонецЕсли; 
	
	УстановитьПривилегированныйРежим(Истина);
	Запрос = Новый Запрос;
	Запрос.Текст = ПолучитьТекстЗапросаГруппыДоступа();
	Запрос.УстановитьПараметр("ГруппаДоступа", Справочники.ГруппыДоступа.ПолучитьСсылку(Новый УникальныйИдентификатор("a5aacfd7-d439-11e3-80cb-001e676b0175")));  //КТС_РедактированиеQRКодаМеста
	Запрос.УстановитьПараметр("Пользователь", ПараметрыСеанса.ТекущийПользователь);

	Если РольДоступна(Метаданные.Роли.ПолныеПрава) ИЛИ НЕ Запрос.Выполнить().Пустой() Тогда
		Элементы.ТабДок.ТолькоПросмотр = Ложь;
		Элементы.ТабДок.Редактирование = Истина;
	КонецЕсли; 
	
	ТабДок = Параметры.ТабДок;
	
КонецПроцедуры
#КонецОбласти


#Область СлужебныеПроцедурыИФункции
// Получаем текст запроса пользавателя,который входит в группу доступа редактирования QR-кода
//
// Параметры:
//  НЕТ
//
// Возвращаемое значение:
//   Строка   -текст запроса
//
&НаСервере
Функция ПолучитьТекстЗапросаГруппыДоступа()
ТекстЗапроса = "
			   |ВЫБРАТЬ
               |	ГруппыДоступаПользователи.Ссылка
               |ИЗ
               |	Справочник.ГруппыДоступа.Пользователи КАК ГруппыДоступаПользователи
               |ГДЕ
               |	ГруппыДоступаПользователи.Ссылка = &ГруппаДоступа
               |	И ГруппыДоступаПользователи.Пользователь = &Пользователь";
Возврат  ТекстЗапроса;
КонецФункции // ПолучитьТекстЗапросаГруппыДоступа()
#КонецОбласти
