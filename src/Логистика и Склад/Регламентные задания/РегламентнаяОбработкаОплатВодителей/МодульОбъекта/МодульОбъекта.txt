
////////////////////////////////////////////////////////////////////////////////
// ПРОГРАММНЫЙ ИНТЕРФЕЙС

Процедура СоздатьПКОПоОплатамВодителей() Экспорт

	Запрос 			= Новый Запрос;
	Запрос.Текст    = ПолучитьТекстЗапросаОплатыВодителей();
	
	Выборка = Запрос.Выполнить().Выбрать();
	
	Пока Выборка.Следующий() Цикл
		
	КонецЦикла;

КонецПроцедуры
 

////////////////////////////////////////////////////////////////////////////////
// СЛУЖЕБНЫЕ ПРОЦЕДУРЫ И ФУНКЦИИ

Функция ПолучитьТекстЗапросаОплатыВодителей()

	ТекстЗапроса = "ВЫБРАТЬ
	               |	Ссылка КАК Ссылка
	               |ПОМЕСТИТЬ ДокументыПоездки
	               |ИЗ
	               |	Документ.ПоездкаЗаМаршрутом
	               |ГДЕ
	               |	Проведен
	               |	И СтатусПоездки = ЗНАЧЕНИЕ(Перечисление.КТС_СтатусыПоездки.ВПроцессе)
	               |;
	               |
	               |////////////////////////////////////////////////////////////////////////////////
	               |ВЫБРАТЬ
	               |	ПринятыеОплаты.Период				КАК Период,
	               |	ПринятыеОплаты.ДокументПоездки		КАК ДокументПоездки,
	               |	ПринятыеОплаты.Партнер				КАК Партнер,
	               |	ПринятыеОплаты.Валюта				КАК Валюта,
	               |	ПринятыеОплаты.СуммаПринято			КАК СуммаПринято,
	               |	ПринятыеОплаты.СуммаОформлено		КАК СуммаОформлено,
	               |	СоответствиеКасс.Касса              КАК Касса
	               |ИЗ
	               |	РегистрСведений.КТС_ОплатыПринятыеВодителями.СрезПоследних(
	               |			,
	               |			ДокументПоездки В
	               |				(ВЫБРАТЬ
	               |					ДокументыПоездки.Ссылка
	               |				ИЗ
	               |					ДокументыПоездки КАК ДокументыПоездки)) КАК ПринятыеОплаты
	               |		ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрСведений.КТС_СоответствиеКассИВодителей КАК СоответствиеКасс
	               |		ПО ПринятыеОплаты.Партнер 	= СоответствиеКасс.Водитель
	               |			И ПринятыеОплаты.Валюта = СоответствиеКасс.Валюта
	               |ГДЕ
	               |	ПринятыеОплаты.СуммаПринято > ПринятыеОплаты.СуммаПринято";
	
	Возврат ТекстЗапроса;

КонецФункции // ПолучитьТекстЗапросаОплатыВодителей()
 

Функция СоздатьДокументПКО(ДанныеЗаполнения)

	ДокументОрдер 		= Документы.ПриходныйКассовыйОрдер.СоздатьДокумент();
	ДокументОрдер.Дата  = ТекущаяДата();

КонецФункции
 