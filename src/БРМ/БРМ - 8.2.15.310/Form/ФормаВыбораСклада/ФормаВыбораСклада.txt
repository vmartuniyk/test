
&НаКлиенте
Процедура Выбрать(Команда)
	Если НЕ СкладОтправитель.Пустая() И НЕ СкладПолучатель.Пустая() Тогда 
		Закрыть(Новый Структура("СкладОтправитель, СкладПолучатель, ВидЦены", СкладОтправитель, СкладПолучатель, ВидЦены));	
	КонецЕсли;
КонецПроцедуры




&НаКлиенте
Процедура СкладОтправительОбработкаВыбора(Элемент, ВыбранноеЗначение, СтандартнаяОбработка)
	СтандартнаяОбработка 	= Ложь;
	СкладОтправитель 		= ВыбранноеЗначение;
	СкладОтправительСтрока 	= Элементы.СкладОтправитель.СписокВыбора.НайтиПоЗначению(ВыбранноеЗначение).Представление;
КонецПроцедуры

&НаКлиенте
Процедура СкладПолучательОбработкаВыбора(Элемент, ВыбранноеЗначение, СтандартнаяОбработка)
	СтандартнаяОбработка 	= Ложь;
	СкладПолучатель 		= ВыбранноеЗначение;
	СкладПолучательСтрока 	= Элементы.СкладПолучатель.СписокВыбора.НайтиПоЗначению(ВыбранноеЗначение).Представление;	
КонецПроцедуры

&НаКлиенте
Процедура СкладОтправительНачалоВыбораИзСписка(Элемент, СтандартнаяОбработка)
	ВыбораИзСписка("СкладОтправитель");
КонецПроцедуры

&НаКлиенте
Процедура СкладНачалоВыбораИзСписка(Элемент, СтандартнаяОбработка)
	ВыбораИзСписка("СкладПолучатель");
КонецПроцедуры

&НаКлиенте
Процедура ВыбораИзСписка(ИмяЭлемента)
	СписокЭлементов = ПолучитьСписокСкладов(ИмяЭлемента);
	Элементы[ИмяЭлемента].СписокВыбора.Очистить();
	Для Каждого ЭлементСписка Из СписокЭлементов Цикл Элементы[ИмяЭлемента].СписокВыбора.Добавить(ЭлементСписка.Значение, ЭлементСписка.Представление); КонецЦикла;
КонецПроцедуры







&НаСервере
Функция ПолучитьСписокСкладов(ИмяЭлемента)
	УстановитьПривилегированныйРежим(Истина);
	Запрос = Новый Запрос(?(ИмяЭлемента = "СкладПолучатель","ВЫБРАТЬ Ссылка, Наименование ИЗ Справочник.Склады", "ВЫБРАТЬ Ссылка, Наименование ИЗ Справочник.Склады ГДЕ Ссылка = &Склад ИЛИ Ссылка.ИспользоватьОрдернуюСхемуПриОтгрузке"));
	Запрос.УстановитьПараметр("Склад", Склад);
	Выборка = Запрос.Выполнить().Выбрать();
	СписокЗначений = Новый СписокЗначений;
	Пока Выборка.Следующий() Цикл СписокЗначений.Добавить(Выборка.Ссылка, Выборка.Наименование) КонецЦикла;
	Если ПривилегированныйРежим() Тогда УстановитьПривилегированныйРежим(Ложь); КонецЕсли;
	Возврат СписокЗначений;
КонецФункции

&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	
	Склад 					= Параметры.Склад;
	СкладОтправитель		= Склад;
	СкладОтправительСтрока 	= Склад;
	
	УстановитьПривилегированныйРежим(Истина);
	Запрос = Новый Запрос("ВЫБРАТЬ ВидЦены ИЗ РегистрСведений.ALPS_ВидыЦен ГДЕ Входная");
	Выборка = Запрос.Выполнить().Выбрать();
	ВидЦены = ?(Выборка.Следующий(), Выборка.ВидЦены, ВидЦены);	
	Если ПривилегированныйРежим() Тогда УстановитьПривилегированныйРежим(Ложь); КонецЕсли;
КонецПроцедуры








