
&НаКлиенте
Процедура Принять(Команда)
	Закрыть(ПрочитатьНаСервере());
КонецПроцедуры

&НаСервере
Функция ПрочитатьНаСервере()
	
	БиблиотекаОбъект = РеквизитФормыВЗначение("Объект").ПолучитьБиблиотеку();
	Массив = Новый Массив;
	Для i=1 По input.КоличествоСтрок() Цикл
		Строка = СокрЛП(input.ПолучитьСтроку(i));
		Строка = СтрЗаменить(Строка, Символ(9), " ");
		Строка = УдалитьБуквы(Строка, БиблиотекаОбъект);
		Строка = УдалитьСимволы(Строка, БиблиотекаОбъект);

		Пробел = Найти(Строка, " ");
		Длинна = СтрДлина(Строка);
		Если Пробел=0 Тогда
			Количество = 1;
		Иначе
			Предварительно = Прав(Строка, Длинна - Пробел);
			НоваяСтрока = "";
			Для инд = 1 По СтрДлина(Предварительно) Цикл
		        ТекСимвол = Сред(Предварительно, инд, 1);
				Если БиблиотекаОбъект.ЭтоЦифра(ТекСимвол) Тогда
					НоваяСтрока = НоваяСтрока + ТекСимвол;
				ИначеЕсли КодСимвола(ТекСимвол) = 32 И НЕ ПустаяСтрока(НоваяСтрока) Тогда
					Прервать;
				КонецЕсли;
			КонецЦикла;
			Количество = Число(НоваяСтрока);
		КонецЕсли;
		
		Массив.Добавить(Новый Структура("Код, Количество", ?(Пробел=0, СтрЗаменить(Строка, " ", ""),  Лев(Строка, Пробел - 1)), Количество));
	
	КонецЦикла;
	Возврат Массив;						
КонецФункции

&НаСервере
Функция УдалитьБуквы(Строка, БиблиотекаОбъект)
	НоваяСтрока = "";
	Для инд = 1 По СтрДлина(Строка) Цикл
        ТекСимвол = Сред(Строка, инд, 1);
		Если НЕ БиблиотекаОбъект.ЭтоБуква(ТекСимвол) Тогда
			НоваяСтрока = НоваяСтрока + ТекСимвол;		
		КонецЕсли;
	КонецЦикла;
	Возврат НоваяСтрока;
КонецФункции

&НаСервере
Функция УдалитьСимволы(Строка, БиблиотекаОбъект)
	НоваяСтрока = "";
	Для инд = 1 По СтрДлина(Строка) Цикл
        ТекСимвол = Сред(Строка, инд, 1);
		Если БиблиотекаОбъект.ЭтоЦифра(ТекСимвол) ИЛИ КодСимвола(ТекСимвол) = 32 Тогда
			НоваяСтрока = НоваяСтрока + ТекСимвол;		
		КонецЕсли;
	КонецЦикла;
	Возврат НоваяСтрока;
КонецФункции


