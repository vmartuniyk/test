
&НаКлиенте
Процедура СписокЦенВидЦеныНачалоВыбора(Элемент, ДанныеВыбора, СтандартнаяОбработка)
	
	Элементы.СписокЦенВидЦены.СписокВыбора.ЗагрузитьЗначения(ПолучитьСписокВидовЦен());
	
КонецПроцедуры


&НаСервере
Функция ПолучитьСписокВидовЦен()
	
	УстановитьПривилегированныйРежим(Истина);
	
	МассивИсключений = СписокЦен.Выгрузить(, "ВидЦены").ВыгрузитьКолонку("ВидЦены");
	
	Запрос = Новый Запрос;
	Запрос.Текст = "ВЫБРАТЬ
	               |	ВидыЦен.Представление
	               |ИЗ
	               |	Справочник.ВидыЦен КАК ВидыЦен";
	Если МассивИсключений.Количество() > 0 Тогда
		Запрос.Текст = Запрос.Текст + "				   
				   |ГДЕ
				   |	НЕ ВидыЦен.Наименование В (&МассивИсключений)";
				   
		Запрос.УстановитьПараметр("МассивИсключений", МассивИсключений); 
	КонецЕсли;
				   
				   
	Возврат Запрос.Выполнить().Выгрузить().ВыгрузитьКолонку("Представление");
	
КонецФункции




&НаКлиенте
Процедура Перенести(Команда)
	
	ИндексСтроки = 0;
	Для Каждого СтрокаТаблицы ИЗ СписокЦен Цикл
		
		Если ПустаяСтрока(СтрокаТаблицы.ВидЦены) Тогда
			
			Сообщение = Новый СообщениеПользователю;
			Сообщение.Текст = "Поле обязательно к заполнению.";
			Сообщение.Поле = "СписокЦен[" + Строка(ИндексСтроки) + "].ВидЦены";
			
			Сообщение.Сообщить();
			
			Возврат;
			
		КонецЕсли;
		
		ИндексСтроки = ИндексСтроки + 1;
		
	КонецЦикла;
	
	Закрыть(ВыгрузитьСписокЦен());
	
КонецПроцедуры

&НаСервере
Функция ВыгрузитьСписокЦен()
	
	Возврат СписокЦен.Выгрузить(, "ВидЦены").ВыгрузитьКолонку("ВидЦены");
	
КонецФункции


&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	
	Для Каждого ВидЦены ИЗ Параметры.СписокВидовЦен Цикл
		
		НоваяСтрока = СписокЦен.Добавить();
		НоваяСтрока.ВидЦены = ВидЦены.Значение;
		
	КонецЦикла;
	
КонецПроцедуры
