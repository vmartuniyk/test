
&НаКлиенте
Процедура СписокСкладовСкладНачалоВыбора(Элемент, ДанныеВыбора, СтандартнаяОбработка)
	
	//СтандартнаяОбработка = Ложь;
	Элементы.СписокСкладовСклад.СписокВыбора.ЗагрузитьЗначения(ПолучитьСписокСкладов());
	
КонецПроцедуры

&НаСервере
Функция ПолучитьСписокСкладов()
	
	УстановитьПривилегированныйРежим(Истина);
	
	МассивИсключений = СписокСкладов.Выгрузить(, "Склад").ВыгрузитьКолонку("Склад");
	
	Запрос = Новый Запрос;
	Запрос.Текст = "ВЫБРАТЬ
	               |	Склады.Представление
	               |ИЗ
	               |	Справочник.Склады КАК Склады";
				   
	Если МассивИсключений.Количество() > 0 Тогда
		Запрос.Текст = Запрос.Текст + "				   
				   |ГДЕ
				   |	НЕ Склады.Наименование В (&МассивИсключений)";
				   
		Запрос.УстановитьПараметр("МассивИсключений", МассивИсключений); 
	КонецЕсли;
				   
	Возврат Запрос.Выполнить().Выгрузить().ВыгрузитьКолонку("Представление");
	
КонецФункции



&НаКлиенте
Процедура Перенести(Команда)
	
	ИндексСтроки = 0;
	Для Каждого СтрокаТаблицы ИЗ СписокСкладов Цикл
		
		Если ПустаяСтрока(СтрокаТаблицы.Склад) Тогда
			
			Сообщение = Новый СообщениеПользователю;
			Сообщение.Текст = "Поле обязательно к заполнению.";
			Сообщение.Поле = "СписокСкладов[" + Строка(ИндексСтроки) + "].Склад";
			
			Сообщение.Сообщить();
			
			Возврат;
			
		КонецЕсли;
		
		ИндексСтроки = ИндексСтроки + 1;
		
	КонецЦикла;
	
	Закрыть(ВыгрузитьСписокСкладов());
	
КонецПроцедуры

&НаСервере
Функция ВыгрузитьСписокСкладов()
		
	Возврат СписокСкладов.Выгрузить(, "Склад").ВыгрузитьКолонку("Склад");
	
КонецФункции



&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	
	Для Каждого Склад ИЗ Параметры.СписокСкладов Цикл
		
		НоваяСтрока = СписокСкладов.Добавить();
		НоваяСтрока.Склад = Склад.Значение;
		
	КонецЦикла;
	
КонецПроцедуры
