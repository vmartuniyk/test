
// Сервер: Заполнение структуры ПараметрыСеансаОбработки. Присвоение элементам формы начальных значений.
//
&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	
	Конфигурация 				= Параметры.ПараметрыСеансаОбработки.Конфигурация + ", версия " + Параметры.ПараметрыСеансаОбработки.Версия;
	КраткаяИнформация			= Параметры.ПараметрыСеансаОбработки.КраткаяИнформация;
	РежимСовместимости			= ""+Параметры.ПараметрыСеансаОбработки.РежимСовместимости;
	ОсновнойРежимЗапуска 		= Параметры.ПараметрыСеансаОбработки.ОсновнойРежимЗапуска;
	ТекущийРежимЗапуска 		= ""+Параметры.ПараметрыСеансаОбработки.ТекущийРежимЗапуска + ": " + Параметры.ПараметрыСеансаОбработки.ТонкийТолстый;
	БазаДанных					= Параметры.ПараметрыСеансаОбработки.СтрокаСоединенияИнформационнойБазы;
	ИмяФайлаОбработки			= Параметры.ПараметрыСеансаОбработки.ИмяФайлаОбработки;
	ТекущийПользовательИБ   	= Параметры.ПараметрыСеансаОбработки.ТекущийПользовательИБ;
	ПравоАдминистрирование		= Параметры.ПараметрыСеансаОбработки.ПравоАдминистрирование;
	ПолныеПрава					= Параметры.ПараметрыСеансаОбработки.ПолныеПрава;
	ПривилегированныйРежим		= Параметры.ПараметрыСеансаОбработки.ПривилегированныйРежим;
	
	Структура = Параметры.ДоступныеТипыСОМОбъектов;
	Массив = Новый Массив;
	Для Каждого Элемент ИЗ Структура Цикл
		Массив.Добавить(Элемент.Ключ);
	КонецЦикла;
	ЭтаФорма.Элементы.ТипСОМОбъекта.СписокВыбора.ЗагрузитьЗначения(Массив);
	
	ЭтаФорма.ТипСОМОбъекта		= Параметры.ТипСОМОбъекта;
	
	// ЛЕВО.
	ЭтаФорма.МонопольныйРежим	= Параметры.МонопольныйРежим;
	
	// ПРАВО.
	ЭтаФорма.ПоказыватьСообщения= Параметры.ПоказыватьСообщения;
	
	// НИЗ.
	ЭтаФорма.ПроверятьADODB 	= Параметры.ПроверятьADODB;
	ЭтаФорма.ПроверятьMSOffice 	= Параметры.ПроверятьMSOffice;
	ЭтаФорма.ПроверятьLibreOffice= Параметры.ПроверятьLibreOffice;
	
	// ПОДКЛЮЧЕНИЕ ADODB.
	ЭтаФорма.ПодключениеADODB	= Параметры.ПодключениеADODB;
	Если НЕ ЗначениеЗаполнено(ЭтаФорма.ПодключениеADODB) Тогда
		ЭтаФорма.ПодключениеADODB	= "MicrosoftJetOLEDB40";
	КонецЕсли;
	ПодключениеADODBПриИзмененииНаСервере();

	Обозначения	= "1. Значек * (звездочка)	- ""ВАЖНЫЙ"", например параметр ""Изменять реквизиты (*)"".
				  |2. Значек ~ (тильда)   	- ""ПОЧТИ"" , например ~ LibreOffice (варианты: LibreOffice/OpenOffice).";
	
КонецПроцедуры

// Клиент: Попытка установки монопольного режима работы с информационной базой. Оповещение Основной формы об изменившемся режиме.
//
&НаКлиенте
Процедура МонопольныйРежимПриИзменении(Элемент)
	
	МонопольныйРежимПриИзмененииНаСервере(ЭтаФорма.МонопольныйРежим);
	
	Попытка
		Оповестить("МонопольныйРежим", ЭтаФорма.МонопольныйРежим, ЭтаФорма.ВладелецФормы.УникальныйИдентификатор);
	Исключение
		Сообщить(ОписаниеОшибки(), СтатусСообщения.Информация);
	КонецПопытки;
	
	Если ЭтаФорма.МонопольныйРежим Тогда
		Предупреждение("УСТАНОВЛЕН МОНОПОЛЬНЫЙ РЕЖИМ.
		|
		|""Один пашет, а семеро руками машут."" (народная мудрость)");
	Иначе
		Предупреждение("УСТАНОВЛЕН МНОГОПОЛЬЗОВАТЕЛЬКИЙ ДОСТУП.
		|
		|""Один горюет, а артель воюет."" (народная мудрость)");
	КонецЕсли;
	
КонецПроцедуры

// Сервер: Фактическая попытка установки монопольного режима работы с информационной базой.
//
&НаСервере
Процедура МонопольныйРежимПриИзмененииНаСервере(Значение)
	
	Попытка
		УстановитьМонопольныйРежим(Значение);
		ЭтаФорма.МонопольныйРежим = МонопольныйРежим();
	Исключение
		Сообщить(ОписаниеОшибки(), СтатусСообщения.Информация);
		ЭтаФорма.МонопольныйРежим = МонопольныйРежим();
		Возврат;
	КонецПопытки;
	
КонецПроцедуры

// Клиент: Фактическая попытка установки монопольного режима работы с информационной базой. Оповещение Основной формы об изменившемся параметре ПоказыватьСообщения.
//
&НаКлиенте
Процедура ПоказыватьСообщенияПриИзменении(Элемент)
	
	Оповестить("ПоказыватьСообщения", ЭтаФорма.ПоказыватьСообщения, ЭтаФорма.ВладелецФормы.УникальныйИдентификатор);
	
	Если ЭтаФорма.ПоказыватьСообщения Тогда
		Предупреждение("УСТАНОВЛЕН РЕЖИМ ВЫВОДА СООБЩЕНИЙ.
		|
		|""Свой глаз - алмаз."" (народная мудрость)");
	Иначе	
		Предупреждение("ОТМЕНЕН РЕЖИМ ВЫВОДА СООБЩЕНИЙ.
		|
		|""Не видит око и зуб неймет."" (~ народная мудрость)");
	КонецЕсли;
	
КонецПроцедуры

// Клиент: Открыть интернет-страницу "Импорт из Excel в "Розница 2.0" тремя методами".
//
&НаКлиенте
Процедура АдресНаИнфоСтарт(Команда)
	
	ЗапуститьПриложение("http://infostart.ru/public/120961/");
	
КонецПроцедуры

// Клиент: Оповещение Основной формы об выбранном методе загрузки даннфх из файла: ТипСОМОбъекта.
//
&НаКлиенте
Процедура ПриЗакрытии()
	
	Оповестить("ТипСОМОбъекта", ЭтаФорма.ТипСОМОбъекта, ЭтаФорма.ВладелецФормы.УникальныйИдентификатор);

КонецПроцедуры

&НаКлиенте
Процедура ПроверятьMSOfficeПриИзменении(Элемент)
	
	Оповестить("ПроверятьMSOffice", ЭтаФорма.ПроверятьMSOffice, ЭтаФорма.ВладелецФормы.УникальныйИдентификатор);
	
	Если ЭтаФорма.ПроверятьMSOffice Тогда
		Предупреждение("При следующем запуске Обработки авось заработает MSOffice
		|
		|""Выйдем - зайдем - вдруг поедет ..."" (IT-мудрость)");
	Иначе	
		Предупреждение("MSOffice - на свалку истории.
		|
		|""Отречемся от старого мира! Отряхнем его прах с наших ног!"" (песня российского пролетариата)");
	КонецЕсли;
	
КонецПроцедуры

&НаКлиенте
Процедура ПроверятьLibreOfficeПриИзменении(Элемент)
	
	Оповестить("ПроверятьLibreOffice", ЭтаФорма.ПроверятьLibreOffice, ЭтаФорма.ВладелецФормы.УникальныйИдентификатор);
	
	Если ЭтаФорма.ПроверятьLibreOffice Тогда
		Предупреждение("При следующем запуске Обработки авось заработает LibreOffice
		|
		|""Чему быть - того не миновать ..."" (народная мудрость)");
	Иначе	
		Предупреждение("LibreOffice - на книжную полку.
		|
		|""Запас карман не тянет ..."" (народная мудрость)");
	КонецЕсли;
	
КонецПроцедуры

&НаКлиенте
Процедура ПодключениеADODBПриИзменении(Элемент)
	
	Оповестить("ПодключениеADODB", ЭтаФорма.ПодключениеADODB, ЭтаФорма.ВладелецФормы.УникальныйИдентификатор);
	
	ПодключениеADODBПриИзмененииНаСервере();
	
КонецПроцедуры

&НаСервере
Процедура ПодключениеADODBПриИзмененииНаСервере()
	
	Если ЭтаФорма.ПодключениеADODB = "MicrosoftJetOLEDB40" Тогда
		Элементы.ДополнительноеПО.Заголовок = "Microsoft Data Access Components (MDAC) 2.8 SP1";
		Элементы.КомментарийADODB.Заголовок = "Стандартное подключение. Как правило, не требуется дополнительных установок.
		|Актуальные версии входят в последний пакет обновления операционной системы или Microsoft MDAC:";
	Иначе
		Элементы.ДополнительноеПО.Заголовок = "Office Microsoft Access Database Engine 2010 Redistributable";
		Элементы.КомментарийADODB.Заголовок = "Необходим установленный Office Microsoft Access Database Engine 2010 Redistributable:
		|на странице загрузки имеются ссылки на 32- и 64- разрядные версии:";
	КонецЕсли;
	
КонецПроцедуры

&НаКлиенте
Процедура ДополнительноеПО()
		
	Если ЭтаФорма.ПодключениеADODB = "MicrosoftJetOLEDB40" Тогда
		ЗапуститьПриложение("http://www.microsoft.com/download/en/details.aspx?displaylang=en&id=5793");
	Иначе
		ЗапуститьПриложение("http://www.microsoft.com/en-us/download/details.aspx?id=13255");
	КонецЕсли;

КонецПроцедуры
