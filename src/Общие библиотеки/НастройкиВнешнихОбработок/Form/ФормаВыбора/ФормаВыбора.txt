
&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	
	УстановитьПривилегированныйРежим(Истина);
	
	Ссылка = Параметры.Ссылка;	
	СписокВыбора.ТипЗначения = Новый ОписаниеТипов(Параметры.ТипЗначения);	
	МассивВидов = ХранилищеНастроекДанныхФорм.Загрузить("БВО-" + Ссылка.УникальныйИдентификатор(), , , "БВО-" + Ссылка.УникальныйИдентификатор());
	Если ТипЗнч(МассивВидов) = Тип("Массив") Тогда
		СписокВыбора.ЗагрузитьЗначения(МассивВидов);
	КонецЕсли;
	
	Если ПривилегированныйРежим() Тогда УстановитьПривилегированныйРежим(Ложь); КонецЕсли;	
	
КонецПроцедуры

&НаКлиенте
Процедура ПередЗакрытием(Отказ, СтандартнаяОбработка)
	Если Модифицированность Тогда
		РезультатОтвета = Вопрос("Данные были изменены. Сохранить изменения?", РежимДиалогаВопрос.ДаНетОтмена);
		Если РезультатОтвета = КодВозвратаДиалога.Да Тогда
			ЗаписатьИЗакрыть(Неопределено);
		ИначеЕсли РезультатОтвета = КодВозвратаДиалога.Отмена Тогда
			Отказ = Истина;	
		КонецЕсли;
	КонецЕсли;
КонецПроцедуры

&НаКлиенте
Процедура ДеревоВыбораПриИзменении(Элемент)
	Модифицированность = Истина;
КонецПроцедуры

&НаКлиенте
Процедура ЗаписатьИЗакрыть(Команда)
    ЗаписатьИЗакрытьСервер();
	Модифицированность = Ложь;
	Закрыть(?(СписокВыбора.Количество() = 0, 0, 1));
КонецПроцедуры

&НаСервере
Процедура ЗаписатьИЗакрытьСервер()
	
	УстановитьПривилегированныйРежим(Истина);
	
	ХранилищеНастроекДанныхФорм.Сохранить("БВО-" + Ссылка.УникальныйИдентификатор(), , СписокВыбора.ВыгрузитьЗначения(), "Настройки: " + Ссылка, "БВО-" + Ссылка.УникальныйИдентификатор());
	
	Если ПривилегированныйРежим() Тогда УстановитьПривилегированныйРежим(Ложь); КонецЕсли;
	
КонецПроцедуры

