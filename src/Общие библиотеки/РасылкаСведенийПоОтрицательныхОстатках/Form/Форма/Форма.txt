
#Область ИнтерфейсАвтоматическихТестов

&НаКлиенте
Перем ЮнитТест;

&НаКлиенте
Функция ПолучитьСписокТестов(ЮнитТестирование) Экспорт
	
	ЮнитТест = ЮнитТестирование;
	
	СпиокТестов = Новый Массив;	
	Возврат СпиокТестов;
	
КонецФункции

#КонецОбласти


#Область ОбработчикиСобытийФормы

&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	Если Параметры.Свойство("АвтоТест") Тогда
		Возврат;	
	КонецЕсли;
	Настройки = ХранилищеНастроекДанныхФорм.Загрузить("РасылкаСведенийПоОтрицательныхОстатках", , , "РасылкаСведенийПоОтрицательныхОстатках");
	Если ТипЗнч(Настройки) = Тип("Структура") Тогда
		Если Настройки.Свойство("СписокАдресовРассылки") Тогда
			СписокАдресовРассылки.Загрузить(Настройки.СписокАдресовРассылки);
		КонецЕсли;
	КонецЕсли;
КонецПроцедуры

&НаКлиенте
Процедура ПередЗакрытием(Отказ, СтандартнаяОбработка)
	
	Если Модифицированность Тогда
		
		Ответ = Вопрос(НСтр("ru='Данные формы были измененые, сохранить изменения?'"), РежимДиалогаВопрос.ДаНетОтмена);
		
		Если Ответ = КодВозвратаДиалога.Да Тогда
			РезультатЗаписи = ЗаписатьНаСервере();
			Если РезультатЗаписи Тогда
				Модифицированность = Ложь;
			Иначе
				Отказ = Истина;
			КонецЕсли;    					
		КонецЕсли; 
		
		Если Ответ = КодВозвратаДиалога.Нет Тогда
			Модифицированность = Ложь;
		КонецЕсли;
		
		Если Ответ = КодВозвратаДиалога.Отмена Тогда
			Отказ = Истина;
		КонецЕсли;
		
	КонецЕсли;
	
КонецПроцедуры

#КонецОбласти


#Область ОбработчикиСобытийЭлементовТаблицыФормы_СписокАдресовРассылки

&НаКлиенте
Процедура СписокАдресовРассылкиПриИзменении(Элемент)
	Модифицированность = Истина;
КонецПроцедуры

#КонецОбласти


#Область ОбработчикиКомандФормы

&НаКлиенте
Процедура Записать(Команда)
	РезультатЗаписи = ЗаписатьНаСервере();
	Если РезультатЗаписи Тогда
		Модифицированность = Ложь;
	КонецЕсли;
КонецПроцедуры

&НаСервере
Функция ЗаписатьНаСервере()
	
	Настройки = Новый Структура;
	
	Настройки.Вставить("СписокАдресовРассылки", СписокАдресовРассылки.Выгрузить());
	
	ХранилищеНастроекДанныхФорм.Сохранить("РасылкаСведенийПоОтрицательныхОстатках", , Настройки, "Рег. расылка сведений по отрицательным остатках", "РасылкаСведенийПоОтрицательныхОстатках");
	
	Возврат Истина;
	
КонецФункции

&НаКлиенте
Процедура ВыполнитьРассылку(Команда)
	ВыполнитьРассылкуНаСервере();
КонецПроцедуры

&НаСервере
Процедура ВыполнитьРассылкуНаСервере()
	РеквизитФормыВЗначение("Объект").ВыполнитьРассылкаПоОстаткам();
КонецПроцедуры // ВыполнитьРассылкуНаСервере()
 

#КонецОбласти