

////////////////////////////////////////////////////////////////////////////////
// ОБРАБОТЧИКИ СОБЫТИЙ ФОРМЫ

&НаКлиенте
Процедура УдалитьДвиженияПриИзменении(Элемент)
	УдалитьДвиженияПриИзмененииНаСервере();
КонецПроцедуры





////////////////////////////////////////////////////////////////////////////////
// ОБРАБОТЧИКИ КОМАНД ФОРМЫ

&НаКлиенте
Процедура ЗаполнитьПартии(Команда)
	ЗаполнитьПартииНаСервере();
КонецПроцедуры

&НаКлиенте
Процедура УдалитьПартии(Команда)
	УдалитьПартииНаСервере(Документ);
КонецПроцедуры

&НаКлиенте
Процедура СохранитьПартии(Команда)
	СохранитьПартииНаСервере();
КонецПроцедуры





////////////////////////////////////////////////////////////////////////////////
// СЛУЖЕБНЫЕ ПРОЦЕДУРЫ И ФУНКЦИИ

&НаСервере
Процедура УдалитьДвиженияПриИзмененииНаСервере()
	
	Запрос = Новый Запрос;
	Запрос.Текст = "
		|ВЫБРАТЬ
		|	*
		|ИЗ
		|	РегистрНакопления.КТС_ДвижениеТоваровПоставщиков
		|ГДЕ
		|	Регистратор = &Регистратор
		|";
	Запрос.УстановитьПараметр("Регистратор", Документ);
	ДокументПоступления.Загрузить(Запрос.Выполнить().Выгрузить());
	
КонецПроцедуры



&НаСервере
Процедура ЗаполнитьПартииНаСервере()
	РеквизитФормыВЗначение("Объект").ВыполнитьДвиженияПоПартиям(Дата);
КонецПроцедуры

&НаСервереБезКонтекста
Процедура УдалитьПартииНаСервере(Документ)
	НаборЗаписей = РегистрыНакопления.КТС_ДвижениеТоваровПоставщиков.СоздатьНаборЗаписей();
	НаборЗаписей.Отбор.Регистратор.Установить(Документ);
	НаборЗаписей.Записать();
КонецПроцедуры

&НаСервере
Процедура СохранитьПартииНаСервере()
	
	НаборЗаписей = РегистрыНакопления.КТС_ДвижениеТоваровПоставщиков.СоздатьНаборЗаписей();
	НаборЗаписей.Отбор.Регистратор.Установить(Документ);
	НаборЗаписей.Загрузить(ДокументПоступления.Выгрузить());
	НаборЗаписей.Записать();
	
	
КонецПроцедуры


