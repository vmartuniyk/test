
#Область ИнтерфейсАвтоматическихТестов

&НаКлиенте
Перем ЮнитТест;

&НаКлиенте
Функция ПолучитьСписокТестов(ЮнитТестирование) Экспорт
	
	ЮнитТест = ЮнитТестирование;
	
	СписокТестов = Новый Массив;	
	
	ПараметрыТеста = Новый Структура("ИмяТеста", "Тест_РеквизитВидНоменклатурыНаФорме");
	СписокТестов.Добавить(ПараметрыТеста);
	
	ПараметрыТеста = Новый Структура("ИмяТеста", "Тест_ПроверкаНаличияКомандыИзменитьИзмененныеПозиции");
	СписокТестов.Добавить(ПараметрыТеста);
	
	ПараметрыТеста = Новый Структура("ИмяТеста", "Тест_ПроверкаНаличияСпискаНоменклатуры");
	СписокТестов.Добавить(ПараметрыТеста);
	
	ПараметрыТеста = Новый Структура("ИмяТеста", "Тест_ПроверкаНаличияСписокКолонок");
	СписокТестов.Добавить(ПараметрыТеста);
	
	Возврат СписокТестов;
	
КонецФункции

&НаКлиенте
Функция Тест_РеквизитВидНоменклатурыНаФорме() Экспорт
	
	Попытка
		РеквизитВидНоменклатуры = ЭтаФорма.ВидНоменклатуры;
	Исключение
		ЮнитТест.ПроверитьИстину(Ложь, НСтр("ru='#4796. На форме обработки должен быть реквизит «ВидНоменклатуры».'", ОбщегоНазначенияКлиентСервер.КодОсновногоЯзыка()));
	КонецПопытки;
	
	ЮнитТест.ПроверитьРавенство(ТипЗнч(РеквизитВидНоменклатуры), Тип("СправочникСсылка.ВидыНоменклатуры"), НСтр("ru='#4796. Реквизит «ВидНоменклатуры» должен иметь тип «СправочникСсылка.ВидыНоменклатуры».'", ОбщегоНазначенияКлиентСервер.КодОсновногоЯзыка()));
	
	ЭлементВидНоменклатуры = Элементы.Найти("ВидНоменклатуры");
	ЮнитТест.ПроверитьНеРавенство(ЭлементВидНоменклатуры, Неопределено, НСтр("ru='#4796. На форме должен быть элемент формы «ВидНоменклатуры».'", ОбщегоНазначенияКлиентСервер.КодОсновногоЯзыка()));
	
КонецФункции // Тест_РеквизитВидНоменклатурыНаФорме()

&НаКлиенте
Функция Тест_ПроверкаНаличияКомандыИзменитьИзмененныеПозиции() Экспорт
	
	КомандаИзменитьИзмененныеПозиции = Команды.Найти("ИзменитьИзмененныеПозиции");
	ЮнитТест.ПроверитьРавенство(ТипЗнч(КомандаИзменитьИзмененныеПозиции), Тип("КомандаФормы"), НСтр("ru='#4796. На форме обработки должна быть команда «Изменить измененные позиции».'", ОбщегоНазначенияКлиентСервер.КодОсновногоЯзыка()));
	
	ЭлементКнопка = Элементы.Найти("ИзменитьИзмененныеПозиции");
	ЮнитТест.ПроверитьНеРавенство(ЭлементКнопка, Неопределено, НСтр("ru='#4796. На форме обработки должен быть элемент формы «Изменить измененные позиции».'", ОбщегоНазначенияКлиентСервер.КодОсновногоЯзыка()));

КонецФункции // Тест_ПроверкаНаличияКомандыИзменитИзмененныеПозиции()

&НаКлиенте
Функция Тест_ПроверкаНаличияСпискаНоменклатуры() Экспорт
	
	Попытка
		РеквизитСписокНоменклатуры = ЭтаФорма.СписокНоменклатуры;
	Исключение
		ЮнитТест.ПроверитьИстину(Ложь, НСтр("ru='#4796. На форме обработки должен быть реквизит «СписокНоменклатуры».'", ОбщегоНазначенияКлиентСервер.КодОсновногоЯзыка()));	
	КонецПопытки;
	
	ЮнитТест.ПроверитьРавенство(ТипЗнч(РеквизитСписокНоменклатуры), Тип("ДанныеФормыКоллекция"), НСтр("ru='#4796. Реквизит «СписокНоменклатуры» должен иметь тип «ТаблицаЗначений».'", ОбщегоНазначенияКлиентСервер.КодОсновногоЯзыка()));
	
	ЭлементТаблица = Элементы.Найти("СписокНоменклатуры");
	ЮнитТест.ПроверитьНеРавенство(ЭлементТаблица, Неопределено, НСтр("ru='#4796. На форме должен быть элемент «СписокНоменклатуры»'", ОбщегоНазначенияКлиентСервер.КодОсновногоЯзыка()));	

КонецФункции // Тест_ПроверкаНаличияСпискаНоменклатуры()
 
&НаКлиенте
Функция Тест_ПроверкаНаличияСписокКолонок() Экспорт

	Попытка
		РеквизитСписокКолонок = ЭтаФорма.СписокКолонок;
	Исключение
		ЮнитТест.ПроверитьИстину(Ложь, НСтр("ru='#4796. На форме обработки должен быть реквизит «СписокКолонок».'", ОбщегоНазначенияКлиентСервер.КодОсновногоЯзыка()));	
	КонецПопытки;
	
	ЮнитТест.ПроверитьРавенство(ТипЗнч(РеквизитСписокКолонок), Тип("ДанныеФормыКоллекция"), НСтр("ru='#4796. Реквизит «СписокКолонок» должен иметь тип «ТаблицаЗначений».'", ОбщегоНазначенияКлиентСервер.КодОсновногоЯзыка()));
	
	ЭлементТаблица = Элементы.Найти("СписокКолонок");
	ЮнитТест.ПроверитьНеРавенство(ЭлементТаблица, Неопределено, НСтр("ru='#4796. На форме должен быть элемент «СписокКолонок»'", ОбщегоНазначенияКлиентСервер.КодОсновногоЯзыка()));	

КонецФункции // Тест_ПроверкаНаличияСпискаНастроек()

&НаКлиенте
Функция Тест_ПроверкаНаЗагрузкуДанныхЧерезПараметрВидНоменклатуры() Экспорт
	
	СтруктураДокументов	=	Тест_ЗагрузитьСписокНоменклатуры();
	//СтруктураОтбора		=
	
	
	
	СообщениеОбОшибке	= НСтр("ru = 'Не удалось загрузить таблицу номенклатуры!",ОбщегоНазначенияКлиентСервер.КодОсновногоЯзыка());
	ЮнитТест.ПроверитьНеРавенство(СписокНоменклатуры.Количество(),0 ,СообщениеОбОшибке);
	 //УдалитиСправочники
	
КонецФункции

&НаСервере
Функция Тест_ЗагрузитьСписокНоменклатуры()
	
	ВидНоменклатурыТест	= Справочники.ВидыНоменклатуры.СоздатьЭлемент();
	ВидНоменклатурыТест.Наименование	= "Вид номенлатуры_Тест";
	ВидНоменклатурыТест.Записать();
	
	НоменклатураТест					=	Справочники.Номенклатура.СоздатьЭлемент();
	НоменклатураТест.Наименование		= 	"Тестовая номенклатура для тестов";
	НоменклатураТест.ВидНоменклатуры	=	ВидНоменклатурыТест;
	НоменклатураТест.Записать();

	ВидНоменклатуры						=	ВидНоменклатурыТест;
	
	ОбъектОбработка = РеквизитФормыВЗначение("Объект");
	НастройкиФормы	= ОбъектОбработка.ПолучитьНастройки();
	ОбъектОбработка.ЗагрузитьТаблицуНоменклатуры(ЭтаФорма,НастройкиФормы);
	ЗначениеВРеквизитФормы(ОбъектОбработка,"Объект");
	
	Возврат Новый Структура("ВидНоменклатуры,Номенклатура",ВидНоменклатурыТест, НоменклатураТест)

КонецФункции
 


#КонецОбласти

#Область ОбработчикиСобытийФормы

&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	
	УстановитьПривилегированныйРежим(Истина);
	
	Если Параметры.Свойство("СсылкаНаЗаказПоставщику") Тогда
		ЗаказПоставщику = Параметры.СсылкаНаЗаказПоставщику;	
	КонецЕсли;
	
	Если Параметры.Свойство("МассивНоменклатуры") Тогда
		МассивНоменклатуры	= Параметры.МассивНоменклатуры;	
	КонецЕсли;

	
	СоздатьРеквизитыИЭлементыФормы();
	УстановитьУсловноеОформление();
	
КонецПроцедуры

&НаСервере
Процедура ПриЗагрузкеДанныхИзНастроекНаСервере(Настройки)
	
	ЗагрузитьСписокНоменклатурыНаСервере();
	
КонецПроцедуры

#КонецОбласти

#Область ОбработчикиСобытийЭлементовШапкиФормы

&НаКлиенте
Процедура ВидНоменклатурыПриИзменении(Элемент)
	ТекущиеДанные = Элементы.СписокНоменклатуры.ТекущиеДанные;
	Номенклатура  = ?(ТекущиеДанные=Неопределено, Неопределено, ТекущиеДанные.Ссылка);
	ЗагрузитьСписокНоменклатурыНаСервере(Номенклатура);
КонецПроцедуры

#КонецОбласти

#Область  ОбработчикиСобытийЭлементовТаблициСписокНоменклатуры

&НаКлиенте
Процедура Подключаемый_ЭлементПроцентПриИзменении(Элемент)
	
	ТекущиеДанные =	Элементы.СписокНоменклатуры.ТекущиеДанные;
	
	Если ТекущиеДанные = Неопределено Тогда
		Возврат;
	КонецЕсли;
	
	ИмяКолонки					= Элемент.Имя;
	ИмяКолонкиУпрУч				= СтрЗаменить(ИмяКолонки,"Процент_","ВидЦены_УпрУч_");
	ИмяКолонкиРеглУч			= СтрЗаменить(ИмяКолонки,"Процент_","ВидЦены_РеглУч_");
	ИмяКолонкиПроцентИзменен    = СтрЗаменить(ИмяКолонки,"Процент_","ПроцентИзменен_");
		
	ТекущиеДанные[ИмяКолонкиУпрУч]			= ТекущиеДанные[ИмяКолонкиУпрУч] * (1 + ТекущиеДанные[ИмяКолонки] / 100);	
	ТекущиеДанные[ИмяКолонкиРеглУч]			= ТекущиеДанные[ИмяКолонкиРеглУч] * (1 + ТекущиеДанные[ИмяКолонки] / 100);
	ТекущиеДанные[ИмяКолонкиПроцентИзменен] = ?(ТекущиеДанные[ИмяКолонки] = 0, Ложь, Истина);
	ТекущиеДанные.ЭлементИзменен            = ?(ТекущиеДанные[ИмяКолонки] = 0, Ложь, Истина);
 
КонецПроцедуры

&НаКлиенте
Процедура Подключаемый_ЭлементФормыПриИзменении(Элемент)
	
	ТекущиеДанные =	Элементы.СписокНоменклатуры.ТекущиеДанные;
	
	Если ТекущиеДанные = Неопределено Тогда
		Возврат;
	КонецЕсли;
	
	ИмяКолонки						= "ЭлементИзменен_" + Элемент.Имя;	
	ТекущиеДанные[ИмяКолонки] 		= Истина;
	ТекущиеДанные.ЭлементИзменен    = Истина;
 
КонецПроцедуры

&НаКлиенте
Процедура Подключаемый_ТоварнаяКатегорияНачалоВыбора(Элемент, ДанныеВыбора, СтандартнаяОбработка)
	СтандартнаяОбработка = Ложь;
	ТекущиеДанные = Элементы.СписокНоменклатуры.ТекущиеДанные;
	Если ТекущиеДанные = Неопределено Тогда
		Возврат;
	КонецЕсли;
	ОткрытьФорму("Справочник.ТоварныеКатегории.ФормаВыбора", Новый Структура("Владелец", ТекущиеДанные.Ссылка.ВидНоменклатуры), Элемент);
КонецПроцедуры

&НаКлиенте
Процедура Подключаемый_ДедлайнНачалоВыбора(Элемент, ДанныеВыбора, СтандартнаяОбработка)
	СтандартнаяОбработка = Ложь;
	ОбщегоНазначенияКлиентСервер.СообщитьПользователю(НСтр("ru='Пока не работает.'"));
КонецПроцедуры

&НаКлиенте
Процедура СписокНоменклатурыВыбор(Элемент, ВыбраннаяСтрока, Поле, СтандартнаяОбработка)
	
	Если Поле.Имя = "СписокНоменклатурыСсылка" Тогда
		ОткрытьЗначение(Элемент.ТекущиеДанные.Ссылка);	
	КонецЕсли;	
КонецПроцедуры


#КонецОбласти

#Область ОбработчикиКомандФормы

&НаКлиенте
Процедура Настройки(Команда)
	
	КнопкаНастройки = Элементы.Настройки;
	ПометкаКнопки   = КнопкаНастройки.Пометка;
	
	Если ПометкаКнопки Тогда
		Элементы.ГруппаСтраницы.ТекущаяСтраница = Элементы.СтраницаСписокНоменклатуры;
	Иначе
		Элементы.ГруппаСтраницы.ТекущаяСтраница = Элементы.СтраницаНастройки;
	КонецЕсли;
	
	КнопкаНастройки.Пометка = Не ПометкаКнопки;
	
КонецПроцедуры

&НаКлиенте
Процедура ИзменитьИзмененныеПозиции(Команда)
	ИзменитьИзмененныеПозицииНаСервере();	
КонецПроцедуры

#КонецОбласти

#Область СлужебныеПроцедурыИФункции

#Область РеквизитыИЭлементыФормы

&НаСервере
Процедура СоздатьРеквизитыИЭлементыФормы()
	СтруктураКолонок = РеквизитФормыВЗначение("Объект").ПолучитьСтруктуруКолонок();
 	СоздатьРеквизитыФормы(СтруктураКолонок);
	СоздатьЭлементыФормы(СтруктураКолонок);
КонецПроцедуры // СоздатьРеквизитыИЭлементыФормы()
 
&НаСервере
Процедура СоздатьРеквизитыФормы(СтруктураКолонок)

	МассивРеквизитов = Новый Массив; 
	МассивРеквизитов.Добавить(Новый РеквизитФормы("ЭлементИзменен", 										Новый ОписаниеТипов("Булево"), "СписокНоменклатуры"));
	МассивРеквизитов.Добавить(Новый РеквизитФормы("КПП_Опт", 												Новый ОписаниеТипов("СправочникСсылка.КоефициентПриоритетностиНоменклатуры"), "СписокНоменклатуры", "Значение"));
	МассивРеквизитов.Добавить(Новый РеквизитФормы("ЭлементИзменен_КПП_Опт", 								Новый ОписаниеТипов("Булево"), "СписокНоменклатуры"));
	МассивРеквизитов.Добавить(Новый РеквизитФормы("КПП_Опт_НеПересчитыватьАвтоматически",					Новый ОписаниеТипов("Булево"), "СписокНоменклатуры"));
	МассивРеквизитов.Добавить(Новый РеквизитФормы("ЭлементИзменен_КПП_Опт_НеПересчитыватьАвтоматически",	Новый ОписаниеТипов("Булево"), "СписокНоменклатуры"));
	МассивРеквизитов.Добавить(Новый РеквизитФормы("КПП_Розница", 											Новый ОписаниеТипов("СправочникСсылка.КоефициентПриоритетностиНоменклатуры"), "СписокНоменклатуры", "Значение"));
	МассивРеквизитов.Добавить(Новый РеквизитФормы("ЭлементИзменен_КПП_Розница", 							Новый ОписаниеТипов("Булево"), "СписокНоменклатуры"));
	МассивРеквизитов.Добавить(Новый РеквизитФормы("КПП_Розница_НеПересчитыватьАвтоматически",				Новый ОписаниеТипов("Булево"), "СписокНоменклатуры"));
	МассивРеквизитов.Добавить(Новый РеквизитФормы("ЭлементИзменен_КПП_Розница_НеПересчитыватьАвтоматически",Новый ОписаниеТипов("Булево"), "СписокНоменклатуры"));
	МассивРеквизитов.Добавить(Новый РеквизитФормы("ТоварнаяКатегория", 										Новый ОписаниеТипов("СправочникСсылка.ТоварныеКатегории"), "СписокНоменклатуры", "Товарная категория"));
	МассивРеквизитов.Добавить(Новый РеквизитФормы("ЭлементИзменен_ТоварнаяКатегория", 						Новый ОписаниеТипов("Булево"), "СписокНоменклатуры"));
	МассивРеквизитов.Добавить(Новый РеквизитФормы("ЦеноваяГруппа",	 										Новый ОписаниеТипов("СправочникСсылка.ЦеновыеГруппы"), "СписокНоменклатуры", "Ценовая группа"));
	МассивРеквизитов.Добавить(Новый РеквизитФормы("ЭлементИзменен_ЦеноваяГруппа", 							Новый ОписаниеТипов("Булево"), "СписокНоменклатуры"));
	МассивРеквизитов.Добавить(Новый РеквизитФормы("Дедлайн", 												Новый ОписаниеТипов("Дата",,, Новый КвалификаторыДаты(ЧастиДаты.Дата)), "СписокНоменклатуры", "Дедлайн")); 
	МассивРеквизитов.Добавить(Новый РеквизитФормы("ЭлементИзменен_Дедлайн", 								Новый ОписаниеТипов("Булево"), "СписокНоменклатуры"));
	
	Если НЕ ЗаказПоставщику.Пустая() Тогда
		МассивРеквизитов.Добавить(Новый РеквизитФормы("КоличествоИзЗаказа", 								Новый ОписаниеТипов("Число",,,Новый КвалификаторыЧисла(15,3)), "СписокНоменклатуры", "Кол."));
		МассивРеквизитов.Добавить(Новый РеквизитФормы("ЦенаПоставщикаУпрУч", 								Новый ОписаниеТипов("Число",,,Новый КвалификаторыЧисла(15,2)), "СписокНоменклатуры", "Цена,USD"));
		МассивРеквизитов.Добавить(Новый РеквизитФормы("ЦенаПоставщикаРеглУч", 								Новый ОписаниеТипов("Число",,,Новый КвалификаторыЧисла(15,2)), "СписокНоменклатуры", "Цена, ГРН"));
	КонецЕсли;
	
	Для каждого Колонка Из СтруктураКолонок.СписокВидовЦен Цикл
		Если Колонка.ЭтоГруппа Тогда
			Продолжить;		
		КонецЕсли;
		МассивРеквизитов.Добавить(Новый РеквизитФормы(Колонка.Имя, Колонка.Тип, "СписокНоменклатуры", Колонка.Заголовок));    			
	КонецЦикла; 
	
	Для каждого Колонка Из СтруктураКолонок.СписокВидовЦенПоставщика Цикл
		МассивРеквизитов.Добавить(Новый РеквизитФормы(Колонка.Имя, Колонка.Тип, "СписокНоменклатуры", Колонка.Заголовок));    			
	КонецЦикла; 
	
	Для каждого Колонка Из СтруктураКолонок.СписокДопСвойства Цикл
		МассивРеквизитов.Добавить(Новый РеквизитФормы(Колонка.Имя,Новый ОписаниеТипов("Строка"), "СписокНоменклатуры", Колонка.Заголовок));    			
	КонецЦикла; 
	ИзменитьРеквизиты(МассивРеквизитов);

КонецПроцедуры // СоздатьРеквизитыФормы()

&НаСервере
Процедура СоздатьЭлементыФормы(СтруктураКолонок)
	
	ГСЧ 					  = Новый ГенераторСлучайныхЧисел;
	ЭлементСписокНоменклатуры = Элементы.СписокНоменклатуры;
	
	ПараметрыЭлементаКПП = СтруктураПараметровГруппыКолонок("ГруппаКПП_Опт", "КПП Опт", ФиксацияВТаблице.Нет);
	ГруппаКолонок 	  	 = git_ПереопределениеОбработчиковСервер.ДобавитьЭлементВКоллекциюЭлементовФормы(Элементы, ПараметрыЭлементаКПП, ЭлементСписокНоменклатуры);
	
	ПараметрыЭлемента = СтруктураПараметровКолонки("КПП_Опт", Новый Цвет(255, 235, 205), Ложь, ,200,,Истина);
	ЭлементФормы	  = git_ПереопределениеОбработчиковСервер.ДобавитьЭлементВКоллекциюЭлементовФормы(Элементы, ПараметрыЭлемента, ГруппаКолонок);
	ЭлементФормы.УстановитьДействие("ПриИзменении", "Подключаемый_ЭлементФормыПриИзменении");
	
	ПараметрыЭлемента = СтруктураПараметровКолонки("КПП_Опт_НеПересчитыватьАвтоматически", Новый Цвет(255, 235, 205), Ложь, ,200,,Истина,ВидПоляФормы.ПолеФлажка);
	ЭлементФормы	  = git_ПереопределениеОбработчиковСервер.ДобавитьЭлементВКоллекциюЭлементовФормы(Элементы, ПараметрыЭлемента, ГруппаКолонок);
	ЭлементФормы.ПоложениеЗаголовка = ПоложениеЗаголовкаЭлементаФормы.Нет;
	ЭлементФормы.УстановитьДействие("ПриИзменении", "Подключаемый_ЭлементФормыПриИзменении");

	ПараметрыЭлементаКПП = СтруктураПараметровГруппыКолонок("ГруппаКПП_Розница", "КПП Розница", ФиксацияВТаблице.Нет);
	ГруппаКолонок 	  	 = git_ПереопределениеОбработчиковСервер.ДобавитьЭлементВКоллекциюЭлементовФормы(Элементы, ПараметрыЭлементаКПП, ЭлементСписокНоменклатуры);
	
	ПараметрыЭлемента = СтруктураПараметровКолонки("КПП_Розница", Новый Цвет(255, 235, 205), Ложь, ,200,,Истина);
	ЭлементФормы	  = git_ПереопределениеОбработчиковСервер.ДобавитьЭлементВКоллекциюЭлементовФормы(Элементы, ПараметрыЭлемента, ГруппаКолонок);
	ЭлементФормы.УстановитьДействие("ПриИзменении", "Подключаемый_ЭлементФормыПриИзменении");
	
	ПараметрыЭлемента = СтруктураПараметровКолонки("КПП_Розница_НеПересчитыватьАвтоматически", Новый Цвет(255, 235, 205), Ложь, ,200,,Истина,ВидПоляФормы.ПолеФлажка);
	ЭлементФормы	  = git_ПереопределениеОбработчиковСервер.ДобавитьЭлементВКоллекциюЭлементовФормы(Элементы, ПараметрыЭлемента, ГруппаКолонок);
	ЭлементФормы.ПоложениеЗаголовка = ПоложениеЗаголовкаЭлементаФормы.Нет;
	ЭлементФормы.УстановитьДействие("ПриИзменении", "Подключаемый_ЭлементФормыПриИзменении");

	ПараметрыЭлемента = СтруктураПараметровКолонки("ТоварнаяКатегория", Новый Цвет(255, 235, 205), Ложь, , 200,,Истина);
	ЭлементФормы	  = git_ПереопределениеОбработчиковСервер.ДобавитьЭлементВКоллекциюЭлементовФормы(Элементы, ПараметрыЭлемента, ЭлементСписокНоменклатуры);
	ЭлементФормы.УстановитьДействие("ПриИзменении", "Подключаемый_ЭлементФормыПриИзменении");
	ЭлементФормы.УстановитьДействие("НачалоВыбора", "Подключаемый_ТоварнаяКатегорияНачалоВыбора");

	
	ПараметрыЭлемента = СтруктураПараметровКолонки("ЦеноваяГруппа", Новый Цвет(255, 235, 205), Ложь, , 200,,Истина);
	ЭлементФормы	  = git_ПереопределениеОбработчиковСервер.ДобавитьЭлементВКоллекциюЭлементовФормы(Элементы, ПараметрыЭлемента, ЭлементСписокНоменклатуры);
	ЭлементФормы.УстановитьДействие("ПриИзменении", "Подключаемый_ЭлементФормыПриИзменении");
	
	ПараметрыЭлемента = СтруктураПараметровКолонки("Дедлайн", Новый Цвет(255, 235, 205), Ложь, , 200,,Истина);
	ЭлементФормы	  = git_ПереопределениеОбработчиковСервер.ДобавитьЭлементВКоллекциюЭлементовФормы(Элементы, ПараметрыЭлемента, ЭлементСписокНоменклатуры);
	//ЭлементФормы.УстановитьДействие("ПриИзменении", "Подключаемый_ЭлементФормыПриИзменении");
	ЭлементФормы.УстановитьДействие("НачалоВыбора", "Подключаемый_ДедлайнНачалоВыбора");
	
	Если НЕ ЗаказПоставщику.Пустая() Тогда
		ПараметрыЭлементаЗП = СтруктураПараметровГруппыКолонок("ГруппаЗП", "Заказ поставщику", ФиксацияВТаблице.Нет);
		ГруппаКолонок 	  	 = git_ПереопределениеОбработчиковСервер.ДобавитьЭлементВКоллекциюЭлементовФормы(Элементы, ПараметрыЭлементаЗП, ЭлементСписокНоменклатуры);

		ПараметрыЭлемента = СтруктураПараметровКолонки("КоличествоИзЗаказа", Новый Цвет(255, 235, 205), Истина, ,200,,Истина);
		ЭлементФормы	  = git_ПереопределениеОбработчиковСервер.ДобавитьЭлементВКоллекциюЭлементовФормы(Элементы, ПараметрыЭлемента, ГруппаКолонок);
		
		ПараметрыЭлемента = СтруктураПараметровКолонки("ЦенаПоставщикаУпрУч", Новый Цвет(255, 235, 205), Истина, ,200,,Истина);
		ЭлементФормы	  = git_ПереопределениеОбработчиковСервер.ДобавитьЭлементВКоллекциюЭлементовФормы(Элементы, ПараметрыЭлемента, ГруппаКолонок);
		
		ПараметрыЭлемента = СтруктураПараметровКолонки("ЦенаПоставщикаРеглУч", Новый Цвет(255, 235, 205), Истина, ,200,,Истина);
		ЭлементФормы	  = git_ПереопределениеОбработчиковСервер.ДобавитьЭлементВКоллекциюЭлементовФормы(Элементы, ПараметрыЭлемента, ГруппаКолонок);
	КонецЕсли;

	
	Для каждого ЭлементМассива Из СтруктураКолонок.СписокВидовЦен Цикл
		ЦветФонаЗаголовка = ГСЧ.СлучайноеЧисло(1, 255);
		Если ЭлементМассива.СлужебнаяКолонка Тогда
			Продолжить;
		КонецЕсли;
		Если ЭлементМассива.ЭтоГруппа Тогда
			ПараметрыЭлемента = СтруктураПараметровГруппыКолонок(ЭлементМассива.Имя, ЭлементМассива.Заголовок, ФиксацияВТаблице.Нет);
			ГруппаКолонок 	  = git_ПереопределениеОбработчиковСервер.ДобавитьЭлементВКоллекциюЭлементовФормы(Элементы, ПараметрыЭлемента, ЭлементСписокНоменклатуры);
		Иначе
			ПараметрыЭлемента = СтруктураПараметровКолонки(ЭлементМассива.Имя, Новый Цвет(255, 235, 205), ?(ЭлементМассива.Заголовок="%",Ложь,Истина), , ЦветФонаЗаголовка,,Ложь);
			ЭлементПроцент	  = git_ПереопределениеОбработчиковСервер.ДобавитьЭлементВКоллекциюЭлементовФормы(Элементы, ПараметрыЭлемента, ГруппаКолонок);
			ЭлементПроцент.УстановитьДействие("ПриИзменении", "Подключаемый_ЭлементПроцентПриИзменении");
		КонецЕсли;
	КонецЦикла;
	
	ПараметрыЭлементаДопСвойства = СтруктураПараметровГруппыКолонок("ГруппаДопСвойста", "Дополнительные свойства", ФиксацияВТаблице.Нет);
	ГруппаКолонокДопСвойста 	  = git_ПереопределениеОбработчиковСервер.ДобавитьЭлементВКоллекциюЭлементовФормы(Элементы, ПараметрыЭлементаДопСвойства, ЭлементСписокНоменклатуры);
	
	Для каждого ЭлементМассива Из СтруктураКолонок.СписокДопСвойства Цикл
		ЦветФонаЗаголовка = ГСЧ.СлучайноеЧисло(1, 255);
		ПараметрыЭлемента = СтруктураПараметровКолонки(ЭлементМассива.Имя, Новый Цвет(255, 235, 205), Истина, , ЦветФонаЗаголовка,,Ложь);
		git_ПереопределениеОбработчиковСервер.ДобавитьЭлементВКоллекциюЭлементовФормы(Элементы, ПараметрыЭлемента, ГруппаКолонокДопСвойста);
	КонецЦикла;
	
	
	ПараметрыЭлементаЦенаПоставщика = СтруктураПараметровГруппыКолонок("ГруппаЦенаПоставщика", "Цены поставщиков", ФиксацияВТаблице.Нет);
	ГруппаКолонокЦеныПоставщиков 	  = git_ПереопределениеОбработчиковСервер.ДобавитьЭлементВКоллекциюЭлементовФормы(Элементы, ПараметрыЭлементаЦенаПоставщика, ЭлементСписокНоменклатуры);

	Для каждого ЭлементМассива Из СтруктураКолонок.СписокВидовЦенПоставщика Цикл
		ЦветФонаЗаголовка = ГСЧ.СлучайноеЧисло(1, 255);
		ПараметрыЭлемента = СтруктураПараметровКолонки(ЭлементМассива.Имя, Новый Цвет(255, 235, 205), Истина, , ЦветФонаЗаголовка,,Ложь);
		git_ПереопределениеОбработчиковСервер.ДобавитьЭлементВКоллекциюЭлементовФормы(Элементы, ПараметрыЭлемента, ГруппаКолонокЦеныПоставщиков);
	КонецЦикла;

КонецПроцедуры // СоздатьЭлементыФормы()

&НаСервере
Функция СтруктураПараметровГруппыКолонок(ИмяЭлемента, ЗаголовокЭлемента, ФиксацияВТаблице, ЦветФонаЗаголовка=Неопределено)

	ПараметрыЭлемента = Новый Структура;
	ПараметрыЭлемента.Вставить("Имя", ИмяЭлемента);
	ПараметрыЭлемента.Вставить("Вид", ВидГруппыФормы.ГруппаКолонок);
	ПараметрыЭлемента.Вставить("ТипЭлемента", Тип("ГруппаФормы"));
	ПараметрыЭлемента.Вставить("РастягиватьПоГоризонтали", Ложь);
	ПараметрыЭлемента.Вставить("Группировка", ГруппировкаКолонок.Горизонтальная);
	ПараметрыЭлемента.Вставить("ОтображатьВШапке", Истина);
	ПараметрыЭлемента.Вставить("Заголовок", ЗаголовокЭлемента);
	ПараметрыЭлемента.Вставить("ФиксацияВТаблице", ФиксацияВТаблице);
	ПараметрыЭлемента.Вставить("ГоризонтальноеПоложениеВШапке", ГоризонтальноеПоложениеЭлемента.Центр);
	ПараметрыЭлемента.Вставить("КартинкаШапки", БиблиотекаКартинок.ЗначокПлюс);
	
	Если ЦветФонаЗаголовка <> Неопределено Тогда
		ПараметрыЭлемента.Вставить("ЦветФонаЗаголовка", Новый Цвет(253, 255-Цел(255/ЦветФонаЗаголовка), ЦветФонаЗаголовка));
	КонецЕсли;
	
	Возврат ПараметрыЭлемента;

КонецФункции // ПолучитьСтруктуруПараметровГруппыКолонок()

&НаСервере
Функция СтруктураПараметровКолонки(ИмяЭлемента, ЦветЭлемента, ТолькоПросмотр, Подсказка, ЦветФонаЗаголовка=Неопределено, Шрифт=Неопределено,КнопкаВыбора=Ложь,ВидПоля=Неопределено)

	ПараметрыЭлемента = Новый Структура;
	ПараметрыЭлемента.Вставить("Имя", ИмяЭлемента);  
	ПараметрыЭлемента.Вставить("Вид", ?(ВидПоля=Неопределено,ВидПоляФормы.ПолеВвода,ВидПоля));
	ПараметрыЭлемента.Вставить("ПутьКДанным", "СписокНоменклатуры." + ИмяЭлемента);
	ПараметрыЭлемента.Вставить("ТипЭлемента",Тип("ПолеФормы"));
	ПараметрыЭлемента.Вставить("РастягиватьПоГоризонтали", Ложь);
	ПараметрыЭлемента.Вставить("ЦветФона", ЦветЭлемента);
	ПараметрыЭлемента.Вставить("Ширина", 3);
	ПараметрыЭлемента.Вставить("ТолькоПросмотр", ТолькоПросмотр);
	ПараметрыЭлемента.Вставить("КнопкаОткрытия", Ложь);
	ПараметрыЭлемента.Вставить("КнопкаВыбора", КнопкаВыбора);
	ПараметрыЭлемента.Вставить("ГоризонтальноеПоложениеВШапке", ГоризонтальноеПоложениеЭлемента.Центр);
	ПараметрыЭлемента.Вставить("ГоризонтальноеПоложение", ГоризонтальноеПоложениеЭлемента.Центр);
	ПараметрыЭлемента.Вставить("Подсказка", Подсказка);
	Если Шрифт <> Неопределено Тогда
		ПараметрыЭлемента.Вставить("Шрифт", Шрифт);
	КонецЕсли;
	
	Если ЦветФонаЗаголовка <> Неопределено Тогда
		ПараметрыЭлемента.Вставить("ЦветФонаЗаголовка", Новый Цвет(253, 255-Цел(255/ЦветФонаЗаголовка), ЦветФонаЗаголовка));
		ПараметрыЭлемента.Вставить("ЦветРамки", Новый Цвет(253, 255-Цел(255/ЦветФонаЗаголовка), ЦветФонаЗаголовка));
	КонецЕсли;
	Возврат ПараметрыЭлемента;
КонецФункции // СтруктураПараметровКолонки()

#КонецОбласти 


#Область УсловноеОформлениеФормы

&НаСервере
Процедура УстановитьУсловноеОформление()
	
	ОбработкаОбъект 			= РеквизитФормыВЗначение("Объект");
	ТаблицаСписокНоменклатуры	= РеквизитФормыВЗначение("СписокНоменклатуры", Тип("ТаблицаЗначений"));
	
	Для каждого КолонкаТаблицы Из ТаблицаСписокНоменклатуры.Колонки Цикл
		ИмяКолонки = КолонкаТаблицы.Имя;
		Если Найти(ИмяКолонки, "ПроцентИзменен_") > 0 Тогда
			ДобавитьЭлементУсловногоОформленияТолькоПросмотр(ИмяКолонки);
			ДобавитьЭлементУсловногоОформленияЦветФонаСтроки(ИмяКолонки);
			ДобавитьЭлементУсловногоОформленияФонаЯчейки(ИмяКолонки, "Тип_Колонки_Цена");
		КонецЕсли;
		Если Найти(ИмяКолонки, "ЭлементИзменен_") > 0 Тогда
			ДобавитьЭлементУсловногоОформленияЦветФонаСтроки(ИмяКолонки);
			ДобавитьЭлементУсловногоОформленияФонаЯчейки(ИмяКолонки, "Тип_Колонки_Реквизит");
		КонецЕсли;
	КонецЦикла; 
			
	ЗначениеВРеквизитФормы(ТаблицаСписокНоменклатуры, "СписокНоменклатуры");
	ЗначениеВРеквизитФормы(ОбработкаОбъект, "Объект");
	
КонецПроцедуры

&НаСервере
Процедура ДобавитьЭлементУсловногоОформленияТолькоПросмотр(ИмяКолонки)

	ИмяЭлементаПроцентЦены 	= СтрЗаменить(ИмяКолонки, "ПроцентИзменен_", "Процент_");
	ИмяЭлементаВидЦены 		= СтрЗаменить(ИмяКолонки, "ПроцентИзменен_", "ВидЦены_УпрУч_");
	
	ЭлементУсловногоОформления 		= ЭтаФорма.УсловноеОформление.Элементы.Добавить();       	
	ОформляемоеПоле 				= ЭлементУсловногоОформления.Поля.Элементы.Добавить();
	ОформляемоеПоле.Поле 			= Новый ПолеКомпоновкиДанных(ИмяЭлементаПроцентЦены);
	ЭлементОтбора 					= ЭлементУсловногоОформления.Отбор.Элементы.Добавить(Тип("ЭлементОтбораКомпоновкиДанных"));
	ЭлементОтбора.ЛевоеЗначение 	= Новый ПолеКомпоновкиДанных("СписокНоменклатуры."+ИмяЭлементаВидЦены);
	ЭлементОтбора.ВидСравнения 		= ВидСравненияКомпоновкиДанных.Равно;
	ЭлементОтбора.ПравоеЗначение	= 0;
	ЭлементУсловногоОформления.Оформление.УстановитьЗначениеПараметра("ТолькоПросмотр", Истина);

КонецПроцедуры // ДобавитьЭлементУсловногоОформления()

&НаСервере
Процедура ДобавитьЭлементУсловногоОформленияЦветФонаСтроки(ИмяКолонки)
	
	ЭлементУсловногоОформления 		= ЭтаФорма.УсловноеОформление.Элементы.Добавить();       	
	ОформляемоеПоле 				= ЭлементУсловногоОформления.Поля.Элементы.Добавить();
	ОформляемоеПоле.Поле 			= Новый ПолеКомпоновкиДанных("СписокНоменклатуры");
	ЭлементОтбора 					= ЭлементУсловногоОформления.Отбор.Элементы.Добавить(Тип("ЭлементОтбораКомпоновкиДанных"));
	ЭлементОтбора.ЛевоеЗначение 	= Новый ПолеКомпоновкиДанных("СписокНоменклатуры." + ИмяКолонки);
	ЭлементОтбора.ВидСравнения 		= ВидСравненияКомпоновкиДанных.Равно;
	ЭлементОтбора.ПравоеЗначение	= Истина;
	ЭлементУсловногоОформления.Оформление.УстановитьЗначениеПараметра("ЦветФона", Новый Цвет(147, 196, 0));
	
КонецПроцедуры // ДобавитьЭлементУсловногоОформленияЦветФонаСтроки()

&НаСервере
Процедура ДобавитьЭлементУсловногоОформленияФонаЯчейки(ИмяКолонки, ТипКолонки)

	Если ТипКолонки = "Тип_Колонки_Цена" Тогда
		ИмяКолонкиПоля = СтрЗаменить(ИмяКолонки, "ПроцентИзменен_", "ВидЦены_УпрУч_");
		УстановитьУсловноеОформлениеЯчейки(ИмяКолонкиПоля, ИмяКолонки);
		ИмяКолонкиПоля = СтрЗаменить(ИмяКолонки, "ПроцентИзменен_", "ВидЦены_РеглУч_");
		УстановитьУсловноеОформлениеЯчейки(ИмяКолонкиПоля, ИмяКолонки);
		ИмяКолонкиПоля = СтрЗаменить(ИмяКолонки, "ПроцентИзменен_", "Процент_");
		УстановитьУсловноеОформлениеЯчейки(ИмяКолонкиПоля, ИмяКолонки);
	КонецЕсли;
	
	Если ТипКолонки = "Тип_Колонки_Реквизит" Тогда
		ИмяКолонкиПоля = СтрЗаменить(ИмяКолонки, "ЭлементИзменен_", "");
		УстановитьУсловноеОформлениеЯчейки(ИмяКолонкиПоля, ИмяКолонки);
	КонецЕсли;

КонецПроцедуры // ДобавитьЭлементУсловногоОформленияФонаЯчейки()

&НаСервере
Процедура УстановитьУсловноеОформлениеЯчейки(ИмяКолонкиПоля, ИмяКолонкиОтбора)

	ЭлементУсловногоОформления 		= ЭтаФорма.УсловноеОформление.Элементы.Добавить();       	
	ОформляемоеПоле					= ЭлементУсловногоОформления.Поля.Элементы.Добавить();
	ОформляемоеПоле.Поле 			= Новый ПолеКомпоновкиДанных(ИмяКолонкиПоля);
	
	ЭлементОтбора 					= ЭлементУсловногоОформления.Отбор.Элементы.Добавить(Тип("ЭлементОтбораКомпоновкиДанных"));
	ЭлементОтбора.ЛевоеЗначение 	= Новый ПолеКомпоновкиДанных("СписокНоменклатуры." + ИмяКолонкиОтбора);
	ЭлементОтбора.ВидСравнения 		= ВидСравненияКомпоновкиДанных.Равно;
	ЭлементОтбора.ПравоеЗначение	= Истина;
	
	ЭлементУсловногоОформления.Оформление.УстановитьЗначениеПараметра("ЦветФона", Новый Цвет(9, 144, 74));
	
КонецПроцедуры // УстановитьУсловноеОформлениеЯчейки()
 
#КонецОбласти 



&НаСервере
Процедура ЗагрузитьСписокНоменклатурыНаСервере(Номенклатура = Неопределено)
	
	УстановитьПривилегированныйРежим(Истина);	
	
	РеквизитФормыВЗначение("Объект").ЗагрузитьТаблицуНоменклатуры(ЭтаФорма);
	
	Если Номенклатура <> Неопределено Тогда
		СтруктураПоиска = Новый Структура("Ссылка", Номенклатура);
		РезультатПоиска = СписокНоменклатуры.НайтиСтроки(СтруктураПоиска);
		Если РезультатПоиска.Количество() > 0 Тогда
			Элементы.СписокНоменклатуры.ТекущаяСтрока = РезультатПоиска[0].ПолучитьИдентификатор();
		КонецЕсли;
	КонецЕсли;
	
КонецПроцедуры // ЗагрузитьСписокНоменклатурыНаСервере()

 

&НаСервере
Процедура ИзменитьИзмененныеПозицииНаСервере()
	УстановитьПривилегированныйРежим(Истина);
	РеквизитФормыВЗначение("Объект").ИзменитьПозиции(ЭтаФорма);
КонецПроцедуры // ИзменитьИзмененныеПозицииНаСервере()






#КонецОбласти