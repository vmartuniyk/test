

#Область ИнтерфейсАвтоматическихТестов
	
&НаКлиенте
Перем ЮнитТест;

&НаКлиенте
Функция ПолучитьСписокТестов(ЮнитТестирование) Экспорт
	
	ЮнитТест = ЮнитТестирование;
	
	СписокТестов = Новый Массив;
	
	Возврат СписокТестов;
	
КонецФункции

#КонецОбласти


#Область ОбработчикиСобытийФормы

&НаКлиенте
Процедура ВыполнитьКоманду(ИдентификаторКоманды, ОбъектыНазначенияМассив) Экспорт	
	
	МассивНоменклатуры = ПолучитьМассивНоменклатуры(ОбъектыНазначенияМассив);
	
	//Сообщить(МассивНоменклатуры[0]);
	
	Если МассивНоменклатуры.Количество() = 0 Тогда
		Ответ = Вопрос(НСтр("ru='В заказе нету номенклатуры для распределения'"), РежимДиалогаВопрос.ОК);
		Возврат;
	КонецЕсли; 
	
	СписокНоменклатуры = Новый СписокЗначений;
	СписокНоменклатуры.ЗагрузитьЗначения(МассивНоменклатуры);
	
	ПараметрыФормы = Новый Структура;
	ПараметрыФормы.Вставить("СписокНоменклатуры", СписокНоменклатуры);
	ОткрытьФорму("ВнешняяОбработка."+ПолучитьБиблиотекуФорм()+".Форма.Форма", ПараметрыФормы, , Новый УникальныйИдентификатор);
КонецПроцедуры

&НаСервере
Функция ПолучитьМассивНоменклатуры(знач МассивДокументов)

	УстановитьПривилегированныйРежим(Истина);
	
	Запрос 		 = Новый Запрос;
	Запрос.Текст = ТекстЗапросаМассивНоменклатуры();
	
	Запрос.УстановитьПараметр("МассивДокументов", МассивДокументов);
	
	Возврат Запрос.Выполнить().Выгрузить().ВыгрузитьКолонку("Номенклатура");

КонецФункции // ПолучитьМассивНоменклатуры()
 
&НаСервере
Функция ТекстЗапросаМассивНоменклатуры()

	ТекстЗапроса = "ВЫБРАТЬ РАЗЛИЧНЫЕ
	               |	Номенклатура КАК Номенклатура
	               |ИЗ
	               |	Документ.ЗаказПоставщику.Товары
	               |ГДЕ
	               |	Ссылка В(&МассивДокументов) И НЕ Отменено И Назначение = ЗНАЧЕНИЕ(Справочник.Назначения.ПустаяСсылка)";
	
	Возврат ТекстЗапроса;

КонецФункции // ТекстЗапросаМассивНоменклатуры()

&НаСервере
Функция ПолучитьБиблиотекуФорм()
       СсылкаНаБиблиотеку = Справочники.ДополнительныеОтчетыИОбработки.НайтиПоНаименованию("Распределение товаров по магазинам");        
       ДвоичныеДанные = СсылкаНаБиблиотеку.ХранилищеОбработки.Получить();
       АдресХранилища = ПоместитьВоВременноеХранилище(ДвоичныеДанные);
       Возврат ВнешниеОбработки.Подключить(АдресХранилища, , Ложь);
КонецФункции
 

#КонецОбласти
