
#Область ПрограммныйИнтерфейс

Процедура ВыполнитьКоманду(ИдентификаторКоманды, ПараметрыКоманды) Экспорт
	
	Перем РезультатВыполнения, ОповещениеФорм, МассивДанных;
	
	Если ИдентификаторКоманды = "ОбновитьПродажиПоФорматамВФоне" Тогда
		
		ТекстЗапроса = ПолучитьТекстЗапросаАналитическихДанных();
		ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "%1", "Склады.Ссылка КАК ФорматМагазина, ");
		ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "%2", "Склады.Ссылка");
		
	ИначеЕсли ИдентификаторКоманды = "ОбновитьПродажиПоМагазинамВФоне" Тогда
		
		ТекстЗапроса = ПолучитьТекстЗапросаАналитическихДанных();
		ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "%1", "Склады.Склад КАК Склад, ");
		ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "%2", "Склады.Склад");
		
	ИначеЕсли ИдентификаторКоманды = "ОбновитьТоварыКОтъездуВФоне" Тогда

		ТекстЗапроса = ПолучитьТекстЗапросаАналитикаТоварыКОтъезду();
		
	ИначеЕсли ИдентификаторКоманды = "ОбновитьТоварыВРезервахВФоне" Тогда

		ТекстЗапроса = ПолучитьТекстЗапросаАналитикаТоварыВРезервах();

	КонецЕсли;
	
	Запрос = Новый Запрос;
	Запрос.Текст = ТекстЗапроса;
	Запрос.УстановитьПараметр("Склад", 				ПараметрыКоманды.Склад);
	Запрос.УстановитьПараметр("ВидНоменклатуры", 	ПараметрыКоманды.ВидНоменклатуры);
	Запрос.УстановитьПараметр("ТоварнаяКатегория", 	ПараметрыКоманды.ТоварнаяКатегория);
	Запрос.УстановитьПараметр("Производитель", 		ПараметрыКоманды.Производитель);
	Запрос.УстановитьПараметр("Номенклатура", 		ПараметрыКоманды.Номенклатура);
	Запрос.УстановитьПараметр("КонецПериода", ТекущаяДатаСеанса());
	Запрос.УстановитьПараметр("НачалоПериодаНеделя", НачалоДня(ТекущаяДатаСеанса()) - 7 * 86400);
	Запрос.УстановитьПараметр("НачалоПериода2Недели", НачалоДня(ТекущаяДатаСеанса()) - 14 * 86400);
	Запрос.УстановитьПараметр("НачалоПериодаМесяц", НачалоДня(ТекущаяДатаСеанса()) - 31 * 86400);
	Запрос.УстановитьПараметр("НачалоПериодаКвартал", НачалоДня(ТекущаяДатаСеанса()) - 91 * 86400);
	Выгрузка = Запрос.Выполнить().Выгрузить();
	
	Если ПараметрыКоманды.Свойство("РезультатВыполнения", РезультатВыполнения) Тогда
		
		Если РезультатВыполнения.Свойство("ОповещениеФорм", ОповещениеФорм) Тогда

			ОповещениеФорм.ИмяСобытия = ИдентификаторКоманды;
			ОповещениеФорм.Использование = Истина;
			Если ПараметрыКоманды.Свойство("ДополнительнаяОбработкаСсылка") Тогда
				ОповещениеФорм.Свойство("Источник", ПараметрыКоманды.ДополнительнаяОбработкаСсылка);
			КонецЕсли;
			
			МассивДанных = Новый Массив;
			Для каждого СтрокаВыгрузки Из Выгрузка Цикл
				
				СтруктураЗаписи = Новый Структура;
				Для Каждого Колонка Из Выгрузка.Колонки Цикл
					СтруктураЗаписи.Вставить(Колонка.Имя);			
				КонецЦикла;
				
				ЗаполнитьЗначенияСвойств(СтруктураЗаписи, СтрокаВыгрузки);
				МассивДанных.Добавить(СтруктураЗаписи);
				
			КонецЦикла;
			
			ОповещениеФорм.Параметр = МассивДанных;
			
		КонецЕсли;
		
	КонецЕсли;
	
КонецПроцедуры // ВыполнитьКоманду()

#КонецОбласти

#Область СлужебныеПроцедурыИФункции

Функция ПолучитьТекстЗапросаАналитическихДанных()

	ТекстЗапроса = "
		////////////////////////////////////////////////////////////////////////////////////////////
		// 0.
		|ВЫБРАТЬ
		|	АналитикаУчетаНоменклатуры.Ссылка КАК АналитикаУчетаНоменклатуры,
		|	АналитикаУчетаНоменклатуры.Номенклатура КАК Номенклатура,
		|	АналитикаУчетаНоменклатуры.Характеристика КАК Характеристика,
		|	АналитикаУчетаНоменклатуры.Склад КАК Склад
		|ПОМЕСТИТЬ КешАналитикаУчетаНоменклатуры
		|ИЗ
		|	Справочник.КлючиАналитикиУчетаНоменклатуры КАК АналитикаУчетаНоменклатуры
		|ГДЕ
		|	АналитикаУчетаНоменклатуры.Номенклатура.ВидНоменклатуры = &ВидНоменклатуры
		|И	ВЫБОР
		|		КОГДА &ТоварнаяКатегория = ЗНАЧЕНИЕ(Справочник.ТоварныеКатегории.ПустаяСсылка)
		|			ТОГДА Истина
		|		ИНАЧЕ АналитикаУчетаНоменклатуры.Номенклатура.ТоварнаяКатегория = &ТоварнаяКатегория
		|	КОНЕЦ
		|И	ВЫБОР
		|		КОГДА &Производитель = ЗНАЧЕНИЕ(Справочник.Производители.ПустаяСсылка)
		|			ТОГДА Истина
		|		ИНАЧЕ АналитикаУчетаНоменклатуры.Номенклатура.Производитель = &Производитель
		|	КОНЕЦ
		|И	ВЫБОР
		|		КОГДА &Номенклатура = ЗНАЧЕНИЕ(Справочник.Номенклатура.ПустаяСсылка)
		|			ТОГДА Истина
		|		ИНАЧЕ АналитикаУчетаНоменклатуры.Номенклатура = &Номенклатура
		|	КОНЕЦ			
		|
		|ИНДЕКСИРОВАТЬ ПО
		|	АналитикаУчетаНоменклатуры	
		|;
		////////////////////////////////////////////////////////////////////////////////////////////
		// 1. Продажи по неделям
		|ВЫБРАТЬ РАЗРЕШЕННЫЕ
		|	АналитикаУчетаНоменклатуры.Склад 						КАК Склад,
		|	СУММА(КоличествоОборот) 								КАК ПродажиНеделя,
		|	КОЛИЧЕСТВО(АналитикаУчетаНоменклатуры.Номенклатура) 	КАК ПродажиНеделяПоАртикулам
		|ПОМЕСТИТЬ ПродажиПоНеделям
		|ИЗ
		|	РегистрНакопления.ВыручкаИСебестоимостьПродаж.Обороты(&НачалоПериодаНеделя, &КонецПериода, , АналитикаУчетаНоменклатуры В (ВЫБРАТЬ АналитикаУчетаНоменклатуры ИЗ КешАналитикаУчетаНоменклатуры)
		|														И  АналитикаУчетаПоПартнерам.Партнер <> ЗНАЧЕНИЕ(Справочник.Партнеры.НашеПредприятие))
		|
		|СГРУППИРОВАТЬ ПО
		|	АналитикаУчетаНоменклатуры.Склад
		|
		|ИНДЕКСИРОВАТЬ ПО
		|	Склад
		|;
		////////////////////////////////////////////////////////////////////////////////////////////
		// 2. Продажи по неделям "Под заказ"
		|ВЫБРАТЬ РАЗРЕШЕННЫЕ
		|	Склад							КАК Склад,
		|	Сумма(НаличиеПодЗаказРасход)   	КАК ПродажиНеделяПодЗаказ
		|ПОМЕСТИТЬ ПродажиПоНеделямПодЗаказ
		|ИЗ
		|	РегистрНакопления.ОбеспечениеЗаказов.Обороты(&НачалоПериодаНеделя, 
		|												&КонецПериода, 
		|												Регистратор, 
		|												(Номенклатура, Характеристика, Склад) В (ВЫБРАТЬ 
		|																							Номенклатура, 
		|																							Характеристика, 
		|																							Склад 
		|																						ИЗ 
		|																							КешАналитикаУчетаНоменклатуры))
		|ГДЕ
		|	Регистратор Ссылка Документ.РеализацияТоваровУслуг
		|
		|СГРУППИРОВАТЬ ПО
		| 	Склад
		|
		|ИНДЕКСИРОВАТЬ ПО
		| 	Склад
		|;
		////////////////////////////////////////////////////////////////////////////////////////////
		// 3. Продажи по 2-х неделям
		|ВЫБРАТЬ РАЗРЕШЕННЫЕ
		|	АналитикаУчетаНоменклатуры.Склад 						КАК Склад,
		|	СУММА(КоличествоОборот) 								КАК Продажи2Недели,
		|	КОЛИЧЕСТВО(АналитикаУчетаНоменклатуры.Номенклатура) 	КАК Продажи2НеделиПоАртикулам
		|ПОМЕСТИТЬ Продажи2ПоНеделям
		|ИЗ
		|	РегистрНакопления.ВыручкаИСебестоимостьПродаж.Обороты(&НачалоПериода2Недели, &КонецПериода, , АналитикаУчетаНоменклатуры В (ВЫБРАТЬ АналитикаУчетаНоменклатуры ИЗ КешАналитикаУчетаНоменклатуры)
		|														И  АналитикаУчетаПоПартнерам.Партнер <> ЗНАЧЕНИЕ(Справочник.Партнеры.НашеПредприятие))
		|
		|СГРУППИРОВАТЬ ПО
		|	АналитикаУчетаНоменклатуры.Склад
		|
		|ИНДЕКСИРОВАТЬ ПО
		|	Склад
		|;
		////////////////////////////////////////////////////////////////////////////////////////////
		// 4. Продажи по 2-х неделям "Под заказ"
		|ВЫБРАТЬ РАЗРЕШЕННЫЕ
		|	Склад							КАК Склад,
		|	Сумма(НаличиеПодЗаказРасход)   	КАК Продажи2НеделиПодЗаказ
		|ПОМЕСТИТЬ ПродажиПо2НеделямПодЗаказ
		|ИЗ
		|	РегистрНакопления.ОбеспечениеЗаказов.Обороты(&НачалоПериода2Недели, 
		|												&КонецПериода, 
		|												Регистратор, 
		|												(Номенклатура, Характеристика, Склад) В (ВЫБРАТЬ 
		|																							Номенклатура, 
		|																							Характеристика, 
		|																							Склад 
		|																						ИЗ 
		|																							КешАналитикаУчетаНоменклатуры))
		|ГДЕ
		|	Регистратор Ссылка Документ.РеализацияТоваровУслуг
		|
		|СГРУППИРОВАТЬ ПО
		| 	Склад
		|
		|ИНДЕКСИРОВАТЬ ПО
		| 	Склад
		|;
		////////////////////////////////////////////////////////////////////////////////////////////
		// 5. Продажи за месяц
		|ВЫБРАТЬ РАЗРЕШЕННЫЕ
		|	АналитикаУчетаНоменклатуры.Склад 						КАК Склад,
		|	СУММА(КоличествоОборот) 							КАК ПродажиМесяц,
		|	КОЛИЧЕСТВО(АналитикаУчетаНоменклатуры.Номенклатура) КАК ПродажиМесяцПоАртикулам
		|ПОМЕСТИТЬ ПродажиЗаМесяц
		|ИЗ
		|	РегистрНакопления.ВыручкаИСебестоимостьПродаж.Обороты(&НачалоПериодаМесяц, &КонецПериода, ,  АналитикаУчетаНоменклатуры В (ВЫБРАТЬ АналитикаУчетаНоменклатуры ИЗ КешАналитикаУчетаНоменклатуры)
		|														И  АналитикаУчетаПоПартнерам.Партнер <> ЗНАЧЕНИЕ(Справочник.Партнеры.НашеПредприятие))
		|
		|СГРУППИРОВАТЬ ПО
		|	АналитикаУчетаНоменклатуры.Склад	
		|
		|ИНДЕКСИРОВАТЬ ПО
		|	Склад
		|;
		////////////////////////////////////////////////////////////////////////////////////////////
		// 6. Продажи за месяц "Под заказ"
		|ВЫБРАТЬ РАЗРЕШЕННЫЕ
		|	Склад							КАК Склад,
		|	Сумма(НаличиеПодЗаказРасход)   	КАК ПродажиМесяцПодЗаказ
		|ПОМЕСТИТЬ ПродажиЗаМесяцПодЗаказ
		|ИЗ
		|	РегистрНакопления.ОбеспечениеЗаказов.Обороты(&НачалоПериодаМесяц, 
		|												&КонецПериода, 
		|												Регистратор, 
		|												(Номенклатура, Характеристика, Склад) В (ВЫБРАТЬ 
		|																							Номенклатура, 
		|																							Характеристика, 
		|																							Склад 
		|																						ИЗ 
		|																							КешАналитикаУчетаНоменклатуры))
		|ГДЕ
		|	Регистратор Ссылка Документ.РеализацияТоваровУслуг
		|
		|СГРУППИРОВАТЬ ПО
		| 	Склад
		|
		|ИНДЕКСИРОВАТЬ ПО
		| 	Склад
		|;
		////////////////////////////////////////////////////////////////////////////////////////////
		// 7. Продажи за квартал
		|ВЫБРАТЬ РАЗРЕШЕННЫЕ
		|	АналитикаУчетаНоменклатуры.Склад 					КАК Склад,
		|	СУММА(КоличествоОборот) 							КАК ПродажиКвартал,
		|	КОЛИЧЕСТВО(АналитикаУчетаНоменклатуры.Номенклатура) КАК ПродажиКварталПоАртикулам
		|ПОМЕСТИТЬ ПродажиЗаКвартал
		|ИЗ
		|	РегистрНакопления.ВыручкаИСебестоимостьПродаж.Обороты(&НачалоПериодаКвартал, &КонецПериода, ,  АналитикаУчетаНоменклатуры В (ВЫБРАТЬ АналитикаУчетаНоменклатуры ИЗ КешАналитикаУчетаНоменклатуры)
		|														И  АналитикаУчетаПоПартнерам.Партнер <> ЗНАЧЕНИЕ(Справочник.Партнеры.НашеПредприятие))
		|
		|СГРУППИРОВАТЬ ПО
		|	АналитикаУчетаНоменклатуры.Склад	
		|
		|ИНДЕКСИРОВАТЬ ПО
		|	Склад
		|;
		////////////////////////////////////////////////////////////////////////////////////////////
		// 8. Продажи за квартал "Под заказ"
		|ВЫБРАТЬ РАЗРЕШЕННЫЕ
		|	Склад							КАК Склад,
		|	Сумма(НаличиеПодЗаказРасход)   	КАК ПродажиКварталПодЗаказ
		|ПОМЕСТИТЬ ПродажиЗаКварталПодЗаказ
		|ИЗ
		|	РегистрНакопления.ОбеспечениеЗаказов.Обороты(&НачалоПериодаКвартал, 
		|												&КонецПериода, 
		|												Регистратор, 
		|												(Номенклатура, Характеристика, Склад) В (ВЫБРАТЬ 
		|																							Номенклатура, 
		|																							Характеристика, 
		|																							Склад 
		|																						ИЗ 
		|																							КешАналитикаУчетаНоменклатуры))
		|ГДЕ
		|	Регистратор Ссылка Документ.РеализацияТоваровУслуг
		|
		|СГРУППИРОВАТЬ ПО
		| 	Склад
		|
		|ИНДЕКСИРОВАТЬ ПО
		| 	Склад
		|;
		////////////////////////////////////////////////////////////////////////////////////////////
		// 9.
		|ВЫБРАТЬ РАЗРЕШЕННЫЕ
		|	%1
		|	СУММА(ОстаткиНаСкладе.ВНаличииОстаток) КАК НаСкладе,
		|
		|	СУММА(ПродажиПоНеделям.ПродажиНеделя) КАК ПродажиНеделя,
		|	СУММА(ПродажиПоНеделям.ПродажиНеделяПоАртикулам) КАК ПродажиНеделяПоАртикулам,
		|	СУММА(ПродажиПоНеделямПодЗаказ.ПродажиНеделяПодЗаказ) КАК ПродажиНеделяПодЗаказ,
		|
		|	СУММА(Продажи2ПоНеделям.Продажи2Недели) КАК Продажи2Недели,
		|	СУММА(Продажи2ПоНеделям.Продажи2НеделиПоАртикулам) КАК Продажи2НеделиПоАртикулам,
		|	СУММА(ПродажиПо2НеделямПодЗаказ.Продажи2НеделиПодЗаказ) КАК Продажи2НеделиПодЗаказ,
		|
		|	СУММА(ПродажиЗаМесяц.ПродажиМесяц) КАК ПродажиМесяц,
		|	СУММА(ПродажиЗаМесяц.ПродажиМесяцПоАртикулам) КАК ПродажиМесяцПоАртикулам,
		|	СУММА(ПродажиЗаМесяцПодЗаказ.ПродажиМесяцПодЗаказ) КАК ПродажиМесяцПодЗаказ,
		|
		|	СУММА(ПродажиЗаКвартал.ПродажиКвартал) КАК ПродажиКвартал,
		|	СУММА(ПродажиЗаКвартал.ПродажиКварталПоАртикулам) КАК ПродажиКварталПоАртикулам,
		|	СУММА(ПродажиЗаКварталПодЗаказ.ПродажиКварталПодЗаказ) КАК ПродажиКварталПодЗаказ
		|
		|ИЗ
		|	Справочник.АМ_ФорматыМагазинов.Склады КАК Склады
		|
		|ЛЕВОЕ СОЕДИНЕНИЕ РегистрНакопления.СвободныеОстатки.Остатки(, (Номенклатура, Характеристика, Склад) В (ВЫБРАТЬ 
		|																							Номенклатура, 
		|																							Характеристика, 
		|																							Склад 
		|																						ИЗ 
		|																							КешАналитикаУчетаНоменклатуры)) КАК ОстаткиНаСкладе
		|ПО ОстаткиНаСкладе.Склад = Склады.Склад
		|
		|ЛЕВОЕ СОЕДИНЕНИЕ ПродажиПоНеделям КАК ПродажиПоНеделям
		|ПО ПродажиПоНеделям.Склад = Склады.Склад
		|
		|ЛЕВОЕ СОЕДИНЕНИЕ ПродажиПоНеделямПодЗаказ КАК ПродажиПоНеделямПодЗаказ
		|ПО ПродажиПоНеделямПодЗаказ.Склад = Склады.Склад
		|
		|
		|ЛЕВОЕ СОЕДИНЕНИЕ Продажи2ПоНеделям КАК Продажи2ПоНеделям
		|ПО Продажи2ПоНеделям.Склад = Склады.Склад
		|
		|ЛЕВОЕ СОЕДИНЕНИЕ ПродажиПо2НеделямПодЗаказ КАК ПродажиПо2НеделямПодЗаказ
		|ПО ПродажиПо2НеделямПодЗаказ.Склад = Склады.Склад
		|
		|
		|ЛЕВОЕ СОЕДИНЕНИЕ ПродажиЗаМесяц КАК ПродажиЗаМесяц
		|ПО ПродажиЗаМесяц.Склад = Склады.Склад
		|
		|ЛЕВОЕ СОЕДИНЕНИЕ ПродажиЗаМесяцПодЗаказ КАК ПродажиЗаМесяцПодЗаказ
		|ПО ПродажиЗаМесяцПодЗаказ.Склад = Склады.Склад
		|
		|
		|ЛЕВОЕ СОЕДИНЕНИЕ ПродажиЗаКвартал КАК ПродажиЗаКвартал
		|ПО ПродажиЗаКвартал.Склад = Склады.Склад
		|
		|ЛЕВОЕ СОЕДИНЕНИЕ ПродажиЗаКварталПодЗаказ КАК ПродажиЗаКварталПодЗаказ
		|ПО ПродажиЗаКварталПодЗаказ.Склад = Склады.Склад
		|
		|СГРУППИРОВАТЬ ПО
		|	%2	
		|
		|УПОРЯДОЧИТЬ ПО
		|	ПродажиКвартал Убыв
		|;
		////////////////////////////////////////////////////////////////////////////////////////////
		|УНИЧТОЖИТЬ КешАналитикаУчетаНоменклатуры;
		////////////////////////////////////////////////////////////////////////////////////////////
		|УНИЧТОЖИТЬ ПродажиПоНеделям;
		////////////////////////////////////////////////////////////////////////////////////////////
		|УНИЧТОЖИТЬ ПродажиПоНеделямПодЗаказ;
		////////////////////////////////////////////////////////////////////////////////////////////
		|УНИЧТОЖИТЬ Продажи2ПоНеделям;
		////////////////////////////////////////////////////////////////////////////////////////////
		|УНИЧТОЖИТЬ ПродажиПо2НеделямПодЗаказ;
		////////////////////////////////////////////////////////////////////////////////////////////
		|УНИЧТОЖИТЬ ПродажиЗаМесяц;
		////////////////////////////////////////////////////////////////////////////////////////////
		|УНИЧТОЖИТЬ ПродажиЗаМесяцПодЗаказ;
		////////////////////////////////////////////////////////////////////////////////////////////
		|УНИЧТОЖИТЬ ПродажиЗаКвартал;
		////////////////////////////////////////////////////////////////////////////////////////////
		|УНИЧТОЖИТЬ ПродажиЗаКварталПодЗаказ;
		|";
	Возврат ТекстЗапроса;
	
КонецФункции // ПолучитьТекстЗапросаАналитическихДанных()

Функция ПолучитьТекстЗапросаАналитикаТоварыКОтъезду()

	ТекстЗапроса = "
		////////////////////////////////////////////////////////////////////////////////////////////
		// 0.
		|ВЫБРАТЬ
		|	СвободныеОстатки.Номенклатура КАК Номенклатура,
		|	СвободныеОстатки.Номенклатура.ВидНоменклатуры КАК ВидНоменклатуры,
		|	СвободныеОстатки.Номенклатура.ТоварнаяКатегория КАК ТоварнаяКатегория,
		|	СвободныеОстатки.Номенклатура.Производитель КАК Производитель,
		|	СвободныеОстатки.Характеристика КАК Характеристика,
		|	СвободныеОстатки.Склад			КАК Склад,
		|	СвободныеОстатки.ВНаличииОстаток 
		|  - СвободныеОстатки.ВРезервеОстаток КАК СвободныйОстаток
		|ПОМЕСТИТЬ КешСвободныхОстатков
		|ИЗ
		|	РегистрНакопления.СвободныеОстатки.Остатки(, Склад = &Склад И Номенклатура.ВидНоменклатуры = &ВидНоменклатуры) КАК СвободныеОстатки
		|;
		////////////////////////////////////////////////////////////////////////////////////////////
		// 1.
		|ВЫБРАТЬ
		|	КешСвободныхОстатков.Склад				КАК Склад,
		|	КешСвободныхОстатков.ВидНоменклатуры	КАК ВидНоменклатуры,
		|	КешСвободныхОстатков.ТоварнаяКатегория 	КАК ТоварнаяКатегория,
		|	КешСвободныхОстатков.Производитель		КАК Производитель,
		|	КешСвободныхОстатков.Номенклатура		КАК Номенклатура,
		|	КешСвободныхОстатков.Характеристика		КАК Характеристика,
		|	КешСвободныхОстатков.СвободныйОстаток	КАК СвободныйОстаток,
		|	""Товарная категория не заполнена!""	КАК	ПричинаОтъезда
		|ПОМЕСТИТЬ КешТкПустая
		|ИЗ
		|	КешСвободныхОстатков КАК КешСвободныхОстатков
		|ГДЕ
		|	КешСвободныхОстатков.ТоварнаяКатегория = ЗНАЧЕНИЕ(Справочник.ТоварныеКатегории.ПустаяСсылка)
		|И	КешСвободныхОстатков.Производитель	  <> ЗНАЧЕНИЕ(Справочник.Производители.ПустаяСсылка)
		|;
		////////////////////////////////////////////////////////////////////////////////////////////
		// 2.
		|ВЫБРАТЬ
		|	КешСвободныхОстатков.Склад				КАК Склад,
		|	КешСвободныхОстатков.ВидНоменклатуры	КАК ВидНоменклатуры,
		|	КешСвободныхОстатков.ТоварнаяКатегория 	КАК ТоварнаяКатегория,
		|	КешСвободныхОстатков.Производитель		КАК Производитель,
		|	КешСвободныхОстатков.Номенклатура		КАК Номенклатура,
		|	КешСвободныхОстатков.Характеристика		КАК Характеристика,
		|	КешСвободныхОстатков.СвободныйОстаток	КАК СвободныйОстаток,
		|	""Производитель не заполнен!""			КАК	ПричинаОтъезда
		|ПОМЕСТИТЬ КешПрПустая
		|ИЗ
		|	КешСвободныхОстатков КАК КешСвободныхОстатков
		|ГДЕ
		|	КешСвободныхОстатков.ТоварнаяКатегория <> ЗНАЧЕНИЕ(Справочник.ТоварныеКатегории.ПустаяСсылка)
		|И	КешСвободныхОстатков.Производитель	    = ЗНАЧЕНИЕ(Справочник.Производители.ПустаяСсылка)
		|
		|;
		////////////////////////////////////////////////////////////////////////////////////////////
		// 3.
		|ВЫБРАТЬ
		|	КешСвободныхОстатков.Склад				КАК Склад,
		|	КешСвободныхОстатков.ВидНоменклатуры	КАК ВидНоменклатуры,
		|	КешСвободныхОстатков.ТоварнаяКатегория 	КАК ТоварнаяКатегория,
		|	КешСвободныхОстатков.Производитель		КАК Производитель,
		|	КешСвободныхОстатков.Номенклатура		КАК Номенклатура,
		|	КешСвободныхОстатков.Характеристика		КАК Характеристика,
		|	КешСвободныхОстатков.СвободныйОстаток	КАК СвободныйОстаток,
		|	""Производитель и товарная категория не заполнены!"" КАК ПричинаОтъезда
		|ПОМЕСТИТЬ КешТкПрПустая
		|ИЗ
		|	КешСвободныхОстатков КАК КешСвободныхОстатков
		|ГДЕ
		|	КешСвободныхОстатков.ТоварнаяКатегория  = ЗНАЧЕНИЕ(Справочник.ТоварныеКатегории.ПустаяСсылка)
		|И	КешСвободныхОстатков.Производитель	    = ЗНАЧЕНИЕ(Справочник.Производители.ПустаяСсылка)
		|
		|;
		////////////////////////////////////////////////////////////////////////////////////////////
		// 4.
		|ВЫБРАТЬ
		|	УАМ.Склад,
		|	УАМ.ВидНоменклатуры,
		|	УАМ.ТоварнаяКатегория,
		|	УАМ.Производитель,
		|	УАМ.Номенклатура	
		|ПОМЕСТИТЬ НастройкиИсключеноИзАссортимента
		|ИЗ
		|	РегистрСведений.АМ_УправлениеАссортиментнойМатрицей.СрезПоследних(, Склад = &Склад И ВидНоменклатуры = &ВидНоменклатуры) КАК УАМ
		|ГДЕ
		|	УАМ.Исключено = Истина	
		|;
		////////////////////////////////////////////////////////////////////////////////////////////
		// 5.
		|ВЫБРАТЬ
		|	КешСвободныхОстатков.Склад				КАК Склад,
		|	КешСвободныхОстатков.ВидНоменклатуры	КАК ВидНоменклатуры,
		|	КешСвободныхОстатков.ТоварнаяКатегория 	КАК ТоварнаяКатегория,
		|	КешСвободныхОстатков.Производитель		КАК Производитель,
		|	КешСвободныхОстатков.Номенклатура		КАК Номенклатура,
		|	КешСвободныхОстатков.Характеристика		КАК Характеристика,
		|	КешСвободныхОстатков.СвободныйОстаток	КАК СвободныйОстаток,
		|	""Товар исключен из матрицы магазина!"" КАК ПричинаОтъезда
		|ПОМЕСТИТЬ КешИсключеноИзАссортимента	
		|ИЗ
		|	КешСвободныхОстатков КАК КешСвободныхОстатков
		|	
		|ВНУТРЕННЕЕ СОЕДИНЕНИЕ НастройкиИсключеноИзАссортимента КАК КешИсключеноИзАссортимента
		|ПО	КешИсключеноИзАссортимента.Склад = КешСвободныхОстатков.Склад 
		|И	КешИсключеноИзАссортимента.ВидНоменклатуры = КешСвободныхОстатков.ВидНоменклатуры 
		|И	ВЫБОР
		|		КОГДА КешИсключеноИзАссортимента.ТоварнаяКатегория <> ЗНАЧЕНИЕ(Справочник.ТоварныеКатегории.ПустаяСсылка)
		|			ТОГДА КешИсключеноИзАссортимента.ТоварнаяКатегория = КешСвободныхОстатков.ТоварнаяКатегория 
		|        ИНАЧЕ Истина
		|    КОНЕЦ
		|И	ВЫБОР
		|		КОГДА КешИсключеноИзАссортимента.Производитель <> ЗНАЧЕНИЕ(Справочник.Производители.ПустаяСсылка)
		|			ТОГДА КешИсключеноИзАссортимента.Производитель = КешСвободныхОстатков.Производитель 
		|        ИНАЧЕ Истина
		|    КОНЕЦ
		|И	ВЫБОР
		|		КОГДА КешИсключеноИзАссортимента.Номенклатура <> ЗНАЧЕНИЕ(Справочник.Номенклатура.ПустаяСсылка)
		|			ТОГДА КешИсключеноИзАссортимента.Номенклатура = КешСвободныхОстатков.Номенклатура 
		|        ИНАЧЕ Истина
		|    КОНЕЦ
		|    
		|ГДЕ
		|	КешСвободныхОстатков.ТоварнаяКатегория  <> ЗНАЧЕНИЕ(Справочник.ТоварныеКатегории.ПустаяСсылка)
		|И	КешСвободныхОстатков.Производитель	    <> ЗНАЧЕНИЕ(Справочник.Производители.ПустаяСсылка)	
		|	
		|;
		////////////////////////////////////////////////////////////////////////////////////////////
		|УНИЧТОЖИТЬ НастройкиИсключеноИзАссортимента;
		////////////////////////////////////////////////////////////////////////////////////////////
		// 7.
		|ВЫБРАТЬ
		|	Склад,
		|	ВидНоменклатуры,
		|	ТоварнаяКатегория,
		|	Производитель,
		|	Номенклатура,
		|	МинимальныйЗапас,
		|	МаксимальныйЗапас,	
		|	Исключено
		|ПОМЕСТИТЬ НастройкиПерегрузАссортимента
		|ИЗ                                                                           
		|	РегистрСведений.АМ_УправлениеАссортиментнойМатрицей.СрезПоследних(, Склад = &Склад  И ВидНоменклатуры = &ВидНоменклатуры)	
		|;
		////////////////////////////////////////////////////////////////////////////////////////////
		// 8.
		|ВЫБРАТЬ
		|	КешСвободныхОстатков.Склад				КАК Склад,
		|	КешСвободныхОстатков.ВидНоменклатуры	КАК ВидНоменклатуры,
		|	КешСвободныхОстатков.ТоварнаяКатегория 	КАК ТоварнаяКатегория,
		|	КешСвободныхОстатков.Производитель		КАК Производитель,
		|	КешСвободныхОстатков.Номенклатура		КАК Номенклатура,
		|	КешСвободныхОстатков.Характеристика		КАК Характеристика,
		|	КешСвободныхОстатков.СвободныйОстаток	КАК СвободныйОстаток,
		|	ВЫБОР
		|		КОГДА IsNull(НеВАссортиментеПоНоменклатуре.МинимальныйЗапас, 0) <> 0
		|			ТОГДА НеВАссортиментеПоНоменклатуре.МинимальныйЗапас
		|		КОГДА IsNull(НеВАссортиментеПоПроизводителю.МинимальныйЗапас, 0) <> 0
		|			ТОГДА НеВАссортиментеПоПроизводителю.МинимальныйЗапас
		|		КОГДА IsNull(НеВАссортиментеПоТоварнойКатегории.МинимальныйЗапас, 0) <> 0
		|			ТОГДА НеВАссортиментеПоТоварнойКатегории.МинимальныйЗапас
		|		КОГДА IsNull(НеВАссортиментеПоВидуНоменклатуры.МинимальныйЗапас, 0) <> 0
		|			ТОГДА НеВАссортиментеПоВидуНоменклатуры.МинимальныйЗапас
		|		ИНАЧЕ
		|			0
		|	КОНЕЦ КАК МинимальныйЗапас,
		|	ВЫБОР
		|		КОГДА IsNull(НеВАссортиментеПоНоменклатуре.МаксимальныйЗапас, 0) <> 0
		|			ТОГДА НеВАссортиментеПоНоменклатуре.МаксимальныйЗапас
		|		КОГДА IsNull(НеВАссортиментеПоПроизводителю.МаксимальныйЗапас, 0) <> 0
		|			ТОГДА НеВАссортиментеПоПроизводителю.МаксимальныйЗапас
		|		КОГДА IsNull(НеВАссортиментеПоТоварнойКатегории.МаксимальныйЗапас, 0) <> 0
		|			ТОГДА НеВАссортиментеПоТоварнойКатегории.МаксимальныйЗапас
		|		КОГДА IsNull(НеВАссортиментеПоВидуНоменклатуры.МаксимальныйЗапас, 0) <> 0
		|			ТОГДА НеВАссортиментеПоВидуНоменклатуры.МаксимальныйЗапас
		|		ИНАЧЕ
		|			0
		|	КОНЕЦ КАК МаксимальныйЗапас,
		|	""Товара больше чем мин.\макс. запас в матрице магазина!"" КАК ПричинаОтъезда	
		| 		 
		|ПОМЕСТИТЬ КешПерегрузАссортимента	
		|ИЗ
		|	КешСвободныхОстатков КАК КешСвободныхОстатков
		|	
		|ЛЕВОЕ СОЕДИНЕНИЕ НастройкиПерегрузАссортимента КАК НеВАссортиментеПоВидуНоменклатуры
		|ПО	НеВАссортиментеПоВидуНоменклатуры.Склад = КешСвободныхОстатков.Склад 
		|И	НеВАссортиментеПоВидуНоменклатуры.ВидНоменклатуры = КешСвободныхОстатков.ВидНоменклатуры
		|И	НеВАссортиментеПоВидуНоменклатуры.ТоварнаяКатегория = ЗНАЧЕНИЕ(Справочник.ТоварныеКатегории.ПустаяСсылка)
		|И	НеВАссортиментеПоВидуНоменклатуры.Производитель = ЗНАЧЕНИЕ(Справочник.Производители.ПустаяСсылка)
		|И	НеВАссортиментеПоВидуНоменклатуры.Номенклатура = ЗНАЧЕНИЕ(Справочник.Номенклатура.ПустаяСсылка) 
		|
		|ЛЕВОЕ СОЕДИНЕНИЕ НастройкиПерегрузАссортимента КАК НеВАссортиментеПоТоварнойКатегории
		|ПО	НеВАссортиментеПоТоварнойКатегории.Склад = КешСвободныхОстатков.Склад 
		|И	НеВАссортиментеПоТоварнойКатегории.ВидНоменклатуры = КешСвободныхОстатков.ВидНоменклатуры 
		|И	НеВАссортиментеПоТоварнойКатегории.ТоварнаяКатегория = КешСвободныхОстатков.ТоварнаяКатегория
		|И	НеВАссортиментеПоТоварнойКатегории.Производитель = ЗНАЧЕНИЕ(Справочник.Производители.ПустаяСсылка)
		|И	НеВАссортиментеПоТоварнойКатегории.Номенклатура = ЗНАЧЕНИЕ(Справочник.Номенклатура.ПустаяСсылка) 
		|
		|ЛЕВОЕ СОЕДИНЕНИЕ НастройкиПерегрузАссортимента КАК НеВАссортиментеПоПроизводителю
		|ПО	НеВАссортиментеПоПроизводителю.Склад = КешСвободныхОстатков.Склад 
		|И	НеВАссортиментеПоПроизводителю.ВидНоменклатуры = КешСвободныхОстатков.ВидНоменклатуры 
		|И	НеВАссортиментеПоПроизводителю.ТоварнаяКатегория = КешСвободныхОстатков.ТоварнаяКатегория
		|И	НеВАссортиментеПоПроизводителю.Производитель = КешСвободныхОстатков.Производитель
		|И	НеВАссортиментеПоПроизводителю.Номенклатура = ЗНАЧЕНИЕ(Справочник.Номенклатура.ПустаяСсылка)
		|
		|ЛЕВОЕ СОЕДИНЕНИЕ НастройкиПерегрузАссортимента КАК НеВАссортиментеПоНоменклатуре
		|ПО	НеВАссортиментеПоНоменклатуре.Склад = КешСвободныхОстатков.Склад 
		|И	НеВАссортиментеПоНоменклатуре.ВидНоменклатуры = КешСвободныхОстатков.ВидНоменклатуры 
		|И	НеВАссортиментеПоНоменклатуре.ТоварнаяКатегория = КешСвободныхОстатков.ТоварнаяКатегория
		|И	НеВАссортиментеПоНоменклатуре.Производитель = КешСвободныхОстатков.Производитель
		|И	НеВАссортиментеПоНоменклатуре.Номенклатура = КешСвободныхОстатков.Номенклатура
		|    
		|ГДЕ
		|	КешСвободныхОстатков.ТоварнаяКатегория  <> ЗНАЧЕНИЕ(Справочник.ТоварныеКатегории.ПустаяСсылка)
		|И	КешСвободныхОстатков.Производитель	    <> ЗНАЧЕНИЕ(Справочник.Производители.ПустаяСсылка)
		|И	ВЫБОР
		|		КОГДА IsNull(НеВАссортиментеПоНоменклатуре.Исключено, ЛОЖЬ) <> ЛОЖЬ
		|			ТОГДА НеВАссортиментеПоНоменклатуре.Исключено
		|		КОГДА IsNull(НеВАссортиментеПоПроизводителю.Исключено, ЛОЖЬ) <> ЛОЖЬ
		|			ТОГДА НеВАссортиментеПоПроизводителю.Исключено
		|		КОГДА IsNull(НеВАссортиментеПоТоварнойКатегории.Исключено, ЛОЖЬ) <> ЛОЖЬ
		|			ТОГДА НеВАссортиментеПоТоварнойКатегории.Исключено
		|		КОГДА IsNull(НеВАссортиментеПоВидуНоменклатуры.Исключено, ЛОЖЬ) <> ЛОЖЬ
		|			ТОГДА НеВАссортиментеПоВидуНоменклатуры.Исключено
		|		ИНАЧЕ ЛОЖЬ
		|	КОНЕЦ = ЛОЖЬ
		|	
		|;
		////////////////////////////////////////////////////////////////////////////////////////////
		|УНИЧТОЖИТЬ НастройкиПерегрузАссортимента; 
		////////////////////////////////////////////////////////////////////////////////////////////
		// 10.
		|ВЫБРАТЬ
		|	КешПерегрузАссортимента.Склад				КАК Склад,
		|	КешПерегрузАссортимента.ВидНоменклатуры		КАК ВидНоменклатуры,
		|	КешПерегрузАссортимента.ТоварнаяКатегория 	КАК ТоварнаяКатегория,
		|	КешПерегрузАссортимента.Производитель		КАК Производитель,
		|	КешПерегрузАссортимента.Номенклатура		КАК Номенклатура,
		|	КешПерегрузАссортимента.Характеристика		КАК Характеристика,
		|	ВЫБОР
		|		КОГДА КешПерегрузАссортимента.МаксимальныйЗапас = 0
		|			ТОГДА КешПерегрузАссортимента.СвободныйОстаток - КешПерегрузАссортимента.МинимальныйЗапас
		|		ИНАЧЕ КешПерегрузАссортимента.СвободныйОстаток - КешПерегрузАссортимента.МаксимальныйЗапас
		|	КОНЕЦ КАК Количество,
		|	КешПерегрузАссортимента.ПричинаОтъезда		КАК ПричинаОтъезда
		|ИЗ
		|	КешПерегрузАссортимента КАК КешПерегрузАссортимента
		|ГДЕ
		|	(КешПерегрузАссортимента.МаксимальныйЗапас <> 0
		|  И КешПерегрузАссортимента.СвободныйОстаток > КешПерегрузАссортимента.МаксимальныйЗапас)
		|ИЛИ		
		|  	(КешПерегрузАссортимента.МаксимальныйЗапас = 0
		|  И КешПерегрузАссортимента.СвободныйОстаток > КешПерегрузАссортимента.МинимальныйЗапас)
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	ИсключеноИзАссортимента.Склад,
		|	ИсключеноИзАссортимента.ВидНоменклатуры,
		|	ИсключеноИзАссортимента.ТоварнаяКатегория,
		|	ИсключеноИзАссортимента.Производитель,
		|	ИсключеноИзАссортимента.Номенклатура,
		|	ИсключеноИзАссортимента.Характеристика,
		|	ИсключеноИзАссортимента.СвободныйОстаток,
		|	ИсключеноИзАссортимента.ПричинаОтъезда
		|ИЗ
		|	КешИсключеноИзАссортимента КАК ИсключеноИзАссортимента	
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	КешТкПустая.Склад,
		|	КешТкПустая.ВидНоменклатуры,
		|	КешТкПустая.ТоварнаяКатегория,
		|	КешТкПустая.Производитель,
		|	КешТкПустая.Номенклатура,
		|	КешТкПустая.Характеристика,
		|	КешТкПустая.СвободныйОстаток,
		|	КешТкПустая.ПричинаОтъезда
		|ИЗ
		|	КешТкПустая КАК КешТкПустая	
		|
		|ОБЪЕДИНИТЬ ВСЕ 
		|
		|ВЫБРАТЬ
		|	КешПрПустая.Склад,
		|	КешПрПустая.ВидНоменклатуры,
		|	КешПрПустая.ТоварнаяКатегория,
		|	КешПрПустая.Производитель,
		|	КешПрПустая.Номенклатура,
		|	КешПрПустая.Характеристика,
		|	КешПрПустая.СвободныйОстаток,
		|	КешПрПустая.ПричинаОтъезда
		|ИЗ
		|	КешПрПустая КАК КешПрПустая	
		|	
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	КешТкПрПустая.Склад,
		|	КешТкПрПустая.ВидНоменклатуры,
		|	КешТкПрПустая.ТоварнаяКатегория,
		|	КешТкПрПустая.Производитель,
		|	КешТкПрПустая.Номенклатура,
		|	КешТкПрПустая.Характеристика,
		|	КешТкПрПустая.СвободныйОстаток,
		|	КешТкПрПустая.ПричинаОтъезда
		|ИЗ
		|	КешТкПрПустая КАК КешТкПрПустая
		|	
		|УПОРЯДОЧИТЬ ПО
		|	ВидНоменклатуры Возр		
		|;
		////////////////////////////////////////////////////////////////////////////////////////////
		|УНИЧТОЖИТЬ КешТкПустая; 
		////////////////////////////////////////////////////////////////////////////////////////////
		|УНИЧТОЖИТЬ КешПрПустая;
		////////////////////////////////////////////////////////////////////////////////////////////
		|УНИЧТОЖИТЬ КешТкПрПустая;
		////////////////////////////////////////////////////////////////////////////////////////////
		|УНИЧТОЖИТЬ КешСвободныхОстатков;
		////////////////////////////////////////////////////////////////////////////////////////////
		|УНИЧТОЖИТЬ КешПерегрузАссортимента;
		////////////////////////////////////////////////////////////////////////////////////////////
		|УНИЧТОЖИТЬ КешИсключеноИзАссортимента;
		|";
	Возврат ТекстЗапроса

КонецФункции // ПолучитьТекстЗапросаАналитикаТоварыКОтъезду()

Функция ПолучитьТекстЗапросаАналитикаТоварыВРезервах()
	
	ТекстЗапроса = "
		|ВЫБРАТЬ
		|	ЗаказКлиента КАК Заказ,
		|	ЗаказКлиента.Дата КАК Дата,
		|	Номенклатура КАК Номенклатура,
		|	Номенклатура.ВидНоменклатуры КАК ВидНоменклатуры,
		|	Номенклатура.ТоварнаяКатегория КАК ТоварнаяКатегория,	
		|	Номенклатура.Производитель КАК Производитель,
		|	СуммаОстаток КАК Сумма,
		|	ЗаказаноОстаток КАК Заказано,
		|	КОформлениюОстаток КАК ВРезерве
		|ИЗ                                             
		|	РегистрНакопления.ЗаказыКлиентов.Остатки(, Склад = &Склад)
		|
		|ОБЪЕДИНИТЬ
		|
		|ВЫБРАТЬ
		|	ЗаказНаВнутреннееПотребление,
		|	ЗаказНаВнутреннееПотребление.Дата,
		|	Номенклатура,
		|	Номенклатура.ВидНоменклатуры,
		|	Номенклатура.ТоварнаяКатегория,	
		|	Номенклатура.Производитель,
		|	0,
		|	ЗаказаноОстаток,
		|	КОформлениюОстаток
		|ИЗ                                             
		|	РегистрНакопления.ЗаказыНаВнутреннееПотребление.Остатки(, Склад = &Склад)
		|
		|ОБЪЕДИНИТЬ
		|
		|ВЫБРАТЬ
		|	ЗаказНаПеремещение,
		|	ЗаказНаПеремещение.Дата,
		|	Номенклатура,
		|	Номенклатура.ВидНоменклатуры,
		|	Номенклатура.ТоварнаяКатегория,	
		|	Номенклатура.Производитель,
		|	0,
		|	ЗаказаноОстаток,
		|	КОформлениюОстаток
		|ИЗ                                             
		|	РегистрНакопления.ЗаказыНаПеремещение.Остатки(, ЗаказНаПеремещение.СкладОтправитель = &Склад)
		|
		|ОБЪЕДИНИТЬ
		|
		|ВЫБРАТЬ
		|	ЗаказНаСборку,
		|	ЗаказНаСборку.Дата,
		|	Номенклатура,
		|	Номенклатура.ВидНоменклатуры,
		|	Номенклатура.ТоварнаяКатегория,	
		|	Номенклатура.Производитель,
		|	0,
		|	ЗаказаноОстаток,
		|	КОформлениюОстаток
		|ИЗ                                             
		|	РегистрНакопления.ЗаказыНаСборку.Остатки(, ЗаказНаСборку.Склад = &Склад)
		|
		|УПОРЯДОЧИТЬ ПО 
		|	Дата Возр	
		|";
	Возврат ТекстЗапроса;
	
КонецФункции // ПолучитьТекстЗапросаАналитикаТоварыВРезервах()

#КонецОбласти

#Область  СведенияОВнешнейОбработке

Функция СведенияОВнешнейОбработке() Экспорт
	
	Версия = "0.0.7";
	
	// Объявим переменную, в которой мы сохраним и вернем "наружу" необходимые данные
    ПараметрыРегистрации = Новый Структура;

    // Объявим еще одну переменную, которая нам потребуется ниже
    МассивНазначений = Новый Массив;
    
    // Первый параметр, который мы должны указать - это какой вид обработки системе должна зарегистрировать. 
    // Допустимые типы: ДополнительнаяОбработка, ДополнительныйОтчет, ЗаполнениеОбъекта, Отчет, ПечатнаяФорма, СозданиеСвязанныхОбъектов
    ПараметрыРегистрации.Вставить("Вид", "ДополнительнаяОбработка");

    // Теперь нам необходимо передать в виде массива имен, к чему будет подключена наша ВПФ
    // Имейте ввиду, что можно задать имя в таком виде: Документ.* - в этом случае обработка будет подключена ко всем документам в системе, 
    // которые поддерживают механизм ВПФ
	//СчитатьДокументыНазначений(МассивНазначений);
	
	ПараметрыРегистрации.Вставить("Назначение", Новый Массив);
    
    // Теперь зададим имя, под которым ВПФ будет зарегистрирована в справочнике внешних обработок
    ПараметрыРегистрации.Вставить("Наименование", "УправлениеАссортиментнымиМатрицами");
    
    // Зададим право обработке на использование безопасного режима. Более подробно можно узнать в справке к платформе (метод УстановитьБезопасныйРежим)
    ПараметрыРегистрации.Вставить("БезопасныйРежим", Ложь);

    // Следующие два параметра играют больше информационную роль, т.е. это то, что будет видеть пользователь в информации к обработке
    ПараметрыРегистрации.Вставить("Версия", Версия);
	ПараметрыРегистрации.Вставить("ВерсияБСП", "2.1.3.50");
    ПараметрыРегистрации.Вставить("Информация", "Управление ассортиментными матрицами [" + Версия + "]");
    
    // Создадим таблицу команд (подробнее смотрим ниже)
    ТаблицаКоманд = ПолучитьТаблицуКоманд();
    
    // Добавим команду в таблицу
    ДобавитьКоманду(ТаблицаКоманд, "УправлениеАссортиментнымиМатрицами [" + Версия + "]", "УАМ", "ОткрытиеФормы", Ложь, "УАМ");
	ДобавитьКоманду(ТаблицаКоманд, "ОбновитьПродажиПоФорматамВФоне", "ОбновитьПродажиПоФорматамВФоне", "ВызовСерверногоМетода");
	ДобавитьКоманду(ТаблицаКоманд, "ОбновитьПродажиПоМагазинамВФоне", "ОбновитьПродажиПоМагазинамВФоне", "ВызовСерверногоМетода");
	ДобавитьКоманду(ТаблицаКоманд, "ОбновитьТоварыКОтъездуВФоне", "ОбновитьТоварыКОтъездуВФоне", "ВызовСерверногоМетода");
	ДобавитьКоманду(ТаблицаКоманд, "ОбновитьТоварыВРезервахВФоне", "ОбновитьТоварыВРезервахВФоне", "ВызовСерверногоМетода");
    
    // Сохраним таблицу команд в параметры регистрации обработки
    ПараметрыРегистрации.Вставить("Команды", ТаблицаКоманд);
    
    // Теперь вернем системе наши параметры
    Возврат ПараметрыРегистрации;
КонецФункции

Функция ПолучитьТаблицуКоманд()

   // Создадим пустую таблицу команд и колонки в ней
   Команды = Новый ТаблицаЗначений;

   // Как будет выглядеть описание печатной формы для пользователя
   Команды.Колонки.Добавить("Представление", Новый ОписаниеТипов("Строка")); 

   // Имя нашего макета, что бы могли отличить вызванную команду в обработке печати
   Команды.Колонки.Добавить("Идентификатор", Новый ОписаниеТипов("Строка"));

   // Тут задается, как должна вызваться команда обработки
   // Возможные варианты:
   // - ОткрытиеФормы - в этом случае в колонке идентификатор должно быть указано имя формы, которое должна будет открыть система
   // - ВызовКлиентскогоМетода - вызвать клиентскую экспортную процедуру из модуля формы обработки
   // - ВызовСерверногоМетода - вызвать серверную экспортную процедуру из модуля объекта обработки
   Команды.Колонки.Добавить("Использование", Новый ОписаниеТипов("Строка"));

   // Следующий параметр указывает, необходимо ли показывать оповещение при начале и завершению работы обработки. Не имеет смысла при открытии формы
   Команды.Колонки.Добавить("ПоказыватьОповещение", Новый ОписаниеТипов("Булево"));

   // Для печатной формы должен содержать строку ПечатьMXL 
   Команды.Колонки.Добавить("Модификатор", Новый ОписаниеТипов("Строка"));
   
   Возврат Команды;
   
КонецФункции

Процедура ДобавитьКоманду(ТаблицаКоманд, Представление, Идентификатор, Использование, ПоказыватьОповещение = Ложь, Модификатор = "")
  // Добавляем команду в таблицу команд по переданному описанию.
  // Параметры и их значения можно посмотреть в функции ПолучитьТаблицуКоманд
  НоваяКоманда = ТаблицаКоманд.Добавить();
  НоваяКоманда.Представление = Представление;
  НоваяКоманда.Идентификатор = Идентификатор;
  НоваяКоманда.Использование = Использование;
  НоваяКоманда.ПоказыватьОповещение = ПоказыватьОповещение;
  НоваяКоманда.Модификатор = Модификатор;

КонецПроцедуры

#КонецОбласти
