
////////////////////////////////////////////////////////////////////////////////
// ОБРАБОТЧИКИ СОБЫТИЙ ФОРМЫ

&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	
	Если НЕ ЗначениеЗаполнено(Запись.Автор)
	 ИЛИ ЗначениеЗаполнено(Параметры.ЗначениеКопирования) Тогда
		Запись.Автор = Пользователи.ТекущийПользователь();
	КонецЕсли;
	
	Если НЕ Параметры.ПервыйПартнер.Пустая() Тогда
		Запись.ПервыйПартнер = Параметры.ПервыйПартнер;
	КонецЕсли;
	
	Если НЕ Параметры.ВидСвязи.Пустая() Тогда
		Запись.ВидСвязи = Параметры.ВидСвязи;
	КонецЕсли;

	Если НЕ Параметры.ВторойПартнер.Пустая() Тогда
		Запись.ВторойПартнер = Параметры.ВторойПартнер;
	КонецЕсли;

	
КонецПроцедуры

&НаСервере
Процедура ПередЗаписьюНаСервере(Отказ, ТекущийОбъект)
	Если Запись.ПервыйПартнер = Запись.ВторойПартнер Тогда
		ОбщегоНазначенияКлиентСервер.СообщитьПользователю(
		НСтр("ru='Партнеры, указанные в связи не должны совпадать.'"),
		,
		"ПервыйПартнер",, Отказ);
		Отказ = Истина;
	КонецЕсли; 
КонецПроцедуры

&НаСервере
Функция ПолучитьВладельцаФормы()
 	КоллекцияПолейОтбора=ЭтаФорма.Список.Отбор.Элементы;
	ТекущийВладелецФормы=Неопределено;
	Для каждого ПолеОтбора Из КоллекцияПолейОтбора Цикл

		Если Строка(ПолеОтбора.ЛевоеЗначение)="Владелец" Тогда
		ТекущийВладелецФормы=ПолеОтбора.ПравоеЗначение;
		Прервать;
		КонецЕсли; 
	КонецЦикла; 
 Возврат ТекущийВладелецФормы;

КонецФункции


&НаКлиенте
Процедура ПослеЗаписи(ПараметрыЗаписи)
	Оповестить("ОбновитьСписокСвязейЧерезОповестить");
КонецПроцедуры

