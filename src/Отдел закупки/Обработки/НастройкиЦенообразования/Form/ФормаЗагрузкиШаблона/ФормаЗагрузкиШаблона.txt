

&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	
	ВидЦены 			= Параметры.ВидЦены;
	ВидНоменклатуры     = ?(Параметры.ВидНоменклатуры=Неопределено, Справочники.ВидыНоменклатуры.ПустаяСсылка(), Параметры.ВидНоменклатуры);
	
КонецПроцедуры


&НаКлиенте
Функция ПолучитьТекущиеДанныеКоллекцииЗначений(ИмяКоллекцииЗначений)
	ТДанные  = Элементы[ИмяКоллекцииЗначений].ТекущиеДанные;
	ТСтрока = Элементы[ИмяКоллекцииЗначений].ТекущаяСтрока;
	Возврат ?(ТДанные <> Неопределено И ТСтрока <> Неопределено, ТДанные, Неопределено);		
КонецФункции


&НаКлиенте
Процедура СписокВидыНоменклатурыПриАктивизацииСтроки(Элемент)
	ЗагрузитьНаценкиНаКлиенте();
КонецПроцедуры

&НаКлиенте
Процедура Заголовок_ВидЦеныПриИзменении(Элемент)
	ЗагрузитьНаценкиНаКлиенте();
КонецПроцедуры


&НаКлиенте
Процедура ТЗ_НаценкиПередНачаломДобавления(Элемент, Отказ, Копирование, Родитель, Группа)
	Отказ=Истина;
КонецПроцедуры

&НаКлиенте
Процедура ТЗ_НаценкиПередУдалением(Элемент, Отказ)
	Отказ=Истина;
КонецПроцедуры





&НаКлиенте
Процедура ЗагрузитьНаценкиНаКлиенте()
	ТекущиеДанные = ПолучитьТекущиеДанныеКоллекцииЗначений("СписокВидыНоменклатуры");
	Если ТекущиеДанные <> Неопределено Тогда
		ТекущийВидНоменклатуры = ТекущиеДанные.Ссылка;
		ЗагрзитьНаценкиНаСервере(ТекущиеДанные.Ссылка);
	КонецЕсли;
КонецПроцедуры // ЗагрузитьНаценкиНаКлиенте()
 


&НаСервере
Процедура ЗагрзитьНаценкиНаСервере(ВидНоменклатуры)
	ОбработкаОбъект = РеквизитФормыВЗначение("Объект");
	ОбработкаОбъект.ЗагрузитьНаценки(ЭтаФорма, "ТЗ_Наценки", Заголовок_ВидЦены, ВидНоменклатуры);
	ЗначениеВРеквизитФормы(ОбработкаОбъект, "Объект");
КонецПроцедуры // ЗагрзитьНаценки()





&НаКлиенте
Процедура ЗагрузитьШаблон(Команда)
	ЗаписатьШаблонНаСервере();
	Закрыть(Истина);
КонецПроцедуры

&НаСервере
Процедура ЗаписатьШаблонНаСервере()

	Для каждого СтрокаТаблицы Из ТЗ_Наценки Цикл
	    СтрокаТаблицы.ВидЦены 			= ВидЦены;
		СтрокаТаблицы.ВидНоменклатуры   = ВидНоменклатуры;
	КонецЦикла; 
	
	ОбработкаОбъект = РеквизитФормыВЗначение("Объект");
	ОбработкаОбъект.ЗаписатьНаценки(ЭтаФорма, "ТЗ_Наценки", ВидЦены, ВидНоменклатуры);
	ЗначениеВРеквизитФормы(ОбработкаОбъект, "Объект");

КонецПроцедуры // ЗаписатьШаблонНаСервере()





&НаКлиенте
Процедура ПриОткрытии(Отказ)
	Элементы.СписокВидыНоменклатуры.ТекущаяСтрока = ТекущийВидНоменклатуры;
	ЗагрузитьНаценкиНаКлиенте();
КонецПроцедуры
 


 