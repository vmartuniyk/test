////////////////////////////////////////////////////////////////////////////////
// ОБРАБОТЧИКИ КОМАНД ФОРМЫ



&НаКлиенте
Процедура ВыполнитьКоманду(ИдентификаторКоманды, ОбъектыНазначенияМассив) Экспорт
	
	ДокументСсылка = ОбъектыНазначенияМассив[0];
	ЗагрузитьТаблицу();
	
	ФормаДокумента	= ЭтаФорма.ВладелецФормы;
	ОбъектФормы		= ФормаДокумента.Объект; 	
	ДокументТовары	= ОбъектФормы.Товары;
	ДокументТовары.Очистить();	

	СтруктураДействий = Новый Структура;
	ЗаполнитьСтруктуруДействия(СтруктураДействий, ОбъектФормы);
	
	Для Каждого ТекущаяСтрока Из Объект.Товары Цикл
		НоваяСтрока = ДокументТовары.Добавить();
		ЗаполнитьЗначенияСвойств(НоваяСтрока, ТекущаяСтрока);
		СтруктураДействий.Вставить("ПроверитьЗаполнитьУпаковкуПоВладельцу", НоваяСтрока.Упаковка);
		ОбработкаТабличнойЧастиКлиент.ОбработатьСтрокуТЧ(НоваяСтрока, СтруктураДействий, );
		Если  НЕ ТекущаяСтрока.Отгружен 
			И НЕ ТекущаяСтрока.Отменено 
			И НЕ ТекущаяСтрока.Услуга
			Тогда 
			НоваяСтрока.КодСтроки = Новый УникальныйИдентификатор();
		КонецЕсли;
	 КонецЦикла;

	
	РассчитатьИтоговыеПоказателиЗаказа(ФормаДокумента);
	
	ПродажиСервер.ЗаполнитьЭтапыГрафикаОплаты(ОбъектФормы, ФормаДокумента.СуммаЗаказано, Истина);
	
	СкидкиНаценкиКлиент.СброситьФлагСкидкиРассчитаны(ФормаДокумента);
	
	ФормаДокумента.Модифицированность = Истина;
КонецПроцедуры 

////////////////////////////////////////////////////////////////////////////////
// СЛУЖЕБНЫЕ ПРОЦЕДУРЫ И ФУНКЦИИ	
	
&НаСервере
Функция ПолучитьПараметрыОтбора()

	ПараметрыОтбора = Новый Структура;
	ПараметрыОтбора.Вставить("Заказ", ДокументСсылка);
	ПараметрыОтбора.Вставить("Склад", ДокументСсылка.Склад);
	ПараметрыОтбора.Вставить("ЖелаемаяДатаОтгрузки", ДокументСсылка.ЖелаемаяДатаОтгрузки);
	ПараметрыОтбора.Вставить("АдресТовары", ПоместитьТоварыВоВременноеХранилище(ДокументСсылка));
	ПараметрыОтбора.Вставить("РассчитатьБезЗаказа", Ложь);
	ПараметрыОтбора.Вставить("НеОтгружатьЧастями", ДокументСсылка.НеОтгружатьЧастями);
	
	Возврат ПараметрыОтбора;

КонецФункции // ПолучитьПараметрыОтбора()

&НаСервере
Функция ПоместитьТоварыВоВременноеХранилище(ЗаказКлиента)
	
	Возврат ПоместитьВоВременноеХранилище(ЗаказКлиента.Товары.Выгрузить(), УникальныйИдентификатор);
	
КонецФункции 


&НаСервере
Функция ОбновитьСостояниеОбеспечения(ЗаказКлиента, Параметры)
	
	ПараметрыСостоянияОбеспечения = ПолучитьПараметрыСостоянияОбеспечения(Параметры);
	ПараметрыВидимости = Новый Структура("ЕстьТовары, ЕстьРаботы, ЕстьНазначение, ЕстьВариантОбеспечения", Ложь, Ложь, Ложь, Ложь);
	ОбработкаСостояниеОбеспечения = Обработки.СостояниеОбеспечения.Создать(); 
	ОбработкаСостояниеОбеспечения.ПолучитьСостояниеОбеспечения(ПараметрыСостоянияОбеспечения, ПараметрыВидимости);
	
	Для Каждого СтрокаТовары Из ОбработкаСостояниеОбеспечения.Товары Цикл
		СтрокаТовары.Выбран = Истина;
	КонецЦикла;
	
	ОбработкаСостояниеОбеспечения.РассчитатьДляПолнойОтгрузки(ПараметрыСостоянияОбеспечения); 
	
	РезультатПоиска = ОбработкаСостояниеОбеспечения.Товары.Найти(Истина, "СтрокаИзменена");
	Если РезультатПоиска <> Неопределено Тогда
		
		РезультатРасчета = ОбработкаСостояниеОбеспечения.ПолучитьРезультатРасчета(ПараметрыСостоянияОбеспечения);
		//Если РезультатРасчета <> Неопределено Тогда
		//	
		//	ДокументОбъект = ЗаказКлиента.ПолучитьОбъект();
		//	ДокументОбъект.Товары.Загрузить(РезультатРасчета);
		//	
		//	Попытка
		//		ДокументОбъект.Записать(РежимЗаписиДокумента.Проведение);
		//		ЗаписьЖурналаРегистрации(НСтр("ru = 'Автоматическая выписка реализаций по заказам клиентов'"),
		//			УровеньЖурналаРегистрации.Информация, 
		//			,
		//			ЗаказКлиента,
		//			НСтр("ru = 'Удачно расчитано дату отгрузки номенклатуры по заказу клиента'"));
		//	Исключение
		//		ЗаписьЖурналаРегистрации(НСтр("ru = 'Автоматическая выписка реализаций по заказам клиентов'"),
		//			УровеньЖурналаРегистрации.Ошибка, 
		//			,
		//			ЗаказКлиента,
		//			НСтр("ru = 'Не удалось расчитать дату отгрузки номенклатуры по заказу клиенту'") + ОписаниеОшибки()); 	
		//	КонецПопытки;
		//		
		//КонецЕсли;
		
	КонецЕсли;

	Возврат ОбработкаСостояниеОбеспечения.Товары;
	
КонецФункции

&НаСервере
Функция ПолучитьПараметрыСостоянияОбеспечения(Параметры)

	ПараметрыСостоянияОбеспечения = Новый Структура;
	ПараметрыСостоянияОбеспечения.Вставить("Заказ", Параметры.Заказ);
	ПараметрыСостоянияОбеспечения.Вставить("Склад", Параметры.Склад);
	ПараметрыСостоянияОбеспечения.Вставить("АдресТовары", Параметры.АдресТовары);
	ПараметрыСостоянияОбеспечения.Вставить("НеОтгружатьЧастями", Параметры.НеОтгружатьЧастями);
	ПараметрыСостоянияОбеспечения.Вставить("РассчитатьБезЗаказа",  Параметры.РассчитатьБезЗаказа);
	ПараметрыСостоянияОбеспечения.Вставить("ЖелаемаяДатаОтгрузки", Параметры.ЖелаемаяДатаОтгрузки);
	ПараметрыСостоянияОбеспечения.Вставить("ОтборПоСостояниюНаличия", Перечисления.СостоянияНаличия.ПолностьюИлиЧастичноВНаличии);

	Возврат ПараметрыСостоянияОбеспечения;

КонецФункции // ПолучитьПараметрыСостоянияОбеспечения()
 

&НаСервере
Процедура  ЗагрузитьТаблицу()
	УстановитьПривилегированныйРежим(Истина);	
	
	
	ПараметрыОтбора = ПолучитьПараметрыОтбора();
	ОбеспечениеТовары = ОбновитьСостояниеОбеспечения(ДокументСсылка, ПараметрыОтбора);
	
	
	
	Запрос = Новый Запрос(ПолучитьТекстЗапроса());
	Запрос.УстановитьПараметр("Ссылка"		, ДокументСсылка);
	Запрос.УстановитьПараметр("Склад"		, ДокументСсылка.Склад);
	Запрос.УстановитьПараметр("ОбеспечениеТовары", ОбеспечениеТовары);
	ЕстьДвижения = ?(НЕ ДокументСсылка.Проведен 
					Или (ДокументСсылка.Проведен И ДокументСсылка.Статус=Перечисления.СтатусыЗаказовКлиентов.Согласован) 
					Или (ДокументСсылка.Проведен И ДокументСсылка.Статус=Перечисления.СтатусыЗаказовКлиентов.НеСогласован), 
					Ложь, 
					Истина); 
	Запрос.УстановитьПараметр("Проведен"	, ЕстьДвижения);
	
	РезультатЗапроса = Запрос.Выполнить();
	Объект.Товары.Загрузить(РезультатЗапроса.Выгрузить());
	
КонецПроцедуры	

&НаКлиентеНаСервереБезКонтекста
Процедура РассчитатьИтоговыеПоказателиЗаказа(Форма)
	
	// Заполнение итогов по таблице "Товары"
	
	КоллекцияТовары = Форма.Объект.Товары;

	Форма.СуммаЗаказано     = КоллекцияТовары.Итог("СуммаСНДСБезВозвратнойТары") - КоллекцияТовары.Итог("СуммаСНДСОтмененоБезВозвратнойТары");
	Форма.СуммаНДСЗаказано  = КоллекцияТовары.Итог("СуммаНДСБезВозвратнойТары") - КоллекцияТовары.Итог("СуммаНДСОтмененоБезВозвратнойТары");
	Форма.СуммаАвтоСкидки   = КоллекцияТовары.Итог("СуммаАвтоматическойСкидкиБезВозвратнойТары") - КоллекцияТовары.Итог("СуммаАвтоматическойСкидкиОтмененоБезВозвратнойТары");
	Форма.СуммаРучнойСкидки = КоллекцияТовары.Итог("СуммаРучнойСкидкиБезВозвратнойТары") - КоллекцияТовары.Итог("СуммаРучнойСкидкиОтмененоБезВозвратнойТары");
	Форма.СуммаСкидки       = Форма.СуммаАвтоСкидки + Форма.СуммаРучнойСкидки;
	Форма.СуммаОтменено     = КоллекцияТовары.Итог("СуммаСНДСОтмененоБезВозвратнойТары");
	
	Если КоллекцияТовары.Итог("СуммаСНДСОтмененоБезВозвратнойТары") = КоллекцияТовары.Итог("СуммаСНДСБезВозвратнойТары") Тогда
		Форма.ВсеСтрокиОтменены = Истина;
	Иначе
		Форма.ВсеСтрокиОтменены = Ложь;
	КонецЕсли;
	
	СуммаЗаказано = КоллекцияТовары.Итог("СуммаБезВозвратнойТары") - КоллекцияТовары.Итог("СуммаОтмененоБезВозвратнойТары");
	
	Если СуммаЗаказано > 0 Тогда
		Форма.ПроцентАвтоСкидки   = Форма.СуммаАвтоСкидки * 100 / (СуммаЗаказано + Форма.СуммаСкидки);
		Форма.ПроцентРучнойСкидки = Форма.СуммаРучнойСкидки * 100 / (СуммаЗаказано + Форма.СуммаСкидки);
		Форма.ПроцентСкидки       = Форма.ПроцентАвтоСкидки + Форма.ПроцентРучнойСкидки;
	ИначеЕсли Форма.СуммаСкидки > 0 Тогда
		Форма.ПроцентАвтоСкидки   = Форма.СуммаАвтоСкидки * 100 / Форма.СуммаСкидки;
		Форма.ПроцентРучнойСкидки = Форма.СуммаРучнойСкидки * 100 / Форма.СуммаСкидки;
		Форма.ПроцентСкидки       = 100;
	Иначе
		Форма.ПроцентАвтоСкидки   = 0;
		Форма.ПроцентРучнойСкидки = 0;
		Форма.ПроцентСкидки       = 0;
	КонецЕсли;
	
	// Заполнение итогов по этапам оплаты
	
	ПредыдущееЗначениеДаты = Дата(1,1,1);
	Форма.НомерСтрокиПолнойОплаты = 0;
	ПроцентПлатежейОбщий = 0;
	
	Форма.СуммаАвансаДоОбеспечения = 0;
	Форма.СуммаПредоплатыДоОтгрузки = 0;
	Форма.СуммаКредитаПослеОтгрузки = 0;
	Форма.ПроцентАвансаДоОбеспечения = 0;
	Форма.ПроцентПредоплатыДоОтгрузки = 0;
	Форма.ПроцентКредитаПослеОтгрузки = 0;
	
	СоответствиеВариантовОплаты = Новый Соответствие;
	СоответствиеВариантовОплаты.Вставить(ПредопределенноеЗначение("Перечисление.ВариантыОплатыКлиентом.АвансДоОбеспечения"),
		Новый Структура("Сумма, Проценты", "СуммаАвансаДоОбеспечения", "ПроцентАвансаДоОбеспечения"));
	СоответствиеВариантовОплаты.Вставить(ПредопределенноеЗначение("Перечисление.ВариантыОплатыКлиентом.ПредоплатаДоОтгрузки"),
		Новый Структура("Сумма, Проценты", "СуммаПредоплатыДоОтгрузки", "ПроцентПредоплатыДоОтгрузки"));
	СоответствиеВариантовОплаты.Вставить(ПредопределенноеЗначение("Перечисление.ВариантыОплатыКлиентом.КредитПослеОтгрузки"),
		Новый Структура("Сумма, Проценты", "СуммаКредитаПослеОтгрузки", "ПроцентКредитаПослеОтгрузки"));
	
	Для Каждого ТекСтрока Из Форма.Объект.ЭтапыГрафикаОплаты Цикл
		ПроцентПлатежейОбщий = ПроцентПлатежейОбщий + ТекСтрока.ПроцентПлатежа;
		ТекСтрока.ПроцентЗаполненНеВерно = (ПроцентПлатежейОбщий > 100);
		ТекСтрока.ДатаЗаполненаНеВерно = (ПредыдущееЗначениеДаты > ТекСтрока.ДатаПлатежа);
		ПредыдущееЗначениеДаты = ТекСтрока.ДатаПлатежа;
		Если ПроцентПлатежейОбщий = 100 Тогда
			Форма.НомерСтрокиПолнойОплаты = ТекСтрока.НомерСтроки;
		КонецЕсли;
		ИменаЭлементов = СоответствиеВариантовОплаты[ТекСтрока.ВариантОплаты];
		Если ИменаЭлементов <> Неопределено Тогда
			Форма[ИменаЭлементов.Сумма] = Форма[ИменаЭлементов.Сумма] + ТекСтрока.СуммаПлатежа;
			Форма[ИменаЭлементов.Проценты] = Форма[ИменаЭлементов.Проценты] + ТекСтрока.ПроцентПлатежа;
		КонецЕсли;
	КонецЦикла;
	
	// Выбор странцицы отображения НДС
	
	Если Форма.Объект.НалогообложениеНДС = ПредопределенноеЗначение("Перечисление.ТипыНалогообложенияНДС.ПродажаНеОблагаетсяНДС")
		ИЛИ Форма.Объект.НалогообложениеНДС = ПредопределенноеЗначение("Перечисление.ТипыНалогообложенияНДС.ПродажаОблагаетсяЕНВД") Тогда
		
		Форма.Элементы.ГруппаСтраницыНДС.ТекущаяСтраница   = Форма.Элементы.СтраницаБезНДС;
		Форма.Элементы.ГруппаСтраницыВсего.ТекущаяСтраница = Форма.Элементы.СтраницаВсегоБезНДС;
		
	Иначе
		
		Форма.Элементы.ГруппаСтраницыНДС.ТекущаяСтраница   = Форма.Элементы.СтраницаСНДС;
		Форма.Элементы.ГруппаСтраницыВсего.ТекущаяСтраница = Форма.Элементы.СтраницаВсегоСНДС;
		
	КонецЕсли;
	
КонецПроцедуры

&НаКлиентеНаСервереБезКонтекста
Процедура ЗаполнитьСтруктуруДействия(СтруктураДействий, ОбъектФормы)
	
	СтруктураПересчетаСуммы = ОбработкаТабличнойЧастиКлиентСервер.ПолучитьСтруктуруПересчетаСуммыНДСВСтрокеТЧ(ОбъектФормы);
	
	СтруктураДействий = Новый Структура;
	СтруктураДействий.Вставить("ПересчитатьКоличествоЕдиниц");
	
	СтруктураДействий.Вставить("ПересчитатьСуммуРучнойСкидки");
	СтруктураДействий.Вставить("ПересчитатьСумму");
	СтруктураДействий.Вставить("ПересчитатьСуммуСУчетомРучнойСкидки", Новый Структура("Очищать", Ложь));
	СтруктураДействий.Вставить("ПересчитатьСуммуСУчетомАвтоматическойСкидки", Новый Структура("Очищать", Ложь));
	СтруктураДействий.Вставить("ПересчитатьСуммуНДС", СтруктураПересчетаСуммы);
	СтруктураДействий.Вставить("ПересчитатьСуммуСНДС", СтруктураПересчетаСуммы);
	
	СтруктураДействий.Вставить("ЗаполнитьСодержание", 
								ОбработкаТабличнойЧастиКлиентСервер.ПолучитьСтруктуруЗаполненияСодержанияУслугиВСтрокеТЧ(ОбъектФормы, Ложь));
	СтруктураДействий.Вставить("ЗаполнитьДубликатыЗависимыхРеквизитов"		, ПолучитьСтруктуруЗависимыхРеквизитов());
	СтруктураДействий.Вставить("ЗаполнитьПризнакБезВозвратнойТары"			, ОбъектФормы.ВернутьМногооборотнуюТару);
	СтруктураДействий.Вставить("ЗаполнитьПризнакОтмененоБезВозвратнойТары"	, ОбъектФормы.ВернутьМногооборотнуюТару);
	
КонецПроцедуры

&НаКлиентеНаСервереБезКонтекста
Функция ПолучитьСтруктуруЗависимыхРеквизитов()
	
	Возврат Новый Структура(
		"БезВозвратнойТары,ОтмененоБезВозвратнойТары",
		"Сумма,СуммаНДС,СуммаСНДС,СуммаАвтоматическойСкидки,СуммаРучнойСкидки",
		"Сумма,СуммаНДС,СуммаСНДС,СуммаАвтоматическойСкидки,СуммаРучнойСкидки");
	
КонецФункции

&НаСервере
Функция ПолучитьТекстЗапроса()
	
	ТекстЗапроса =
		"ВЫБРАТЬ
		|	ОбеспечениеТовары.НомерСтроки КАК НомерСтроки,
		|	ОбеспечениеТовары.КодСтроки КАК КодСтроки,
		|	ОбеспечениеТовары.ВариантОбеспечения КАК ВариантОбеспечения,
		|	ОбеспечениеТовары.КоличествоУпаковок КАК КоличествоУпаковок
		|ПОМЕСТИТЬ ТаблицаОбеспечениеТовары
		|ИЗ
		|	&ОбеспечениеТовары КАК ОбеспечениеТовары
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	ТаблицаОбеспечениеТовары.НомерСтроки КАК НомерСтроки,
		|	ТаблицаОбеспечениеТовары.КодСтроки КАК КодСтроки,
		|	ТаблицаОбеспечениеТовары.ВариантОбеспечения КАК ВариантОбеспечения,
		|	ТаблицаОбеспечениеТовары.КоличествоУпаковок КАК КоличествоУпаковок
		|ПОМЕСТИТЬ ОбеспечениеТовары
		|ИЗ
		|	ТаблицаОбеспечениеТовары КАК ТаблицаОбеспечениеТовары
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	ЗаказКлиентаТовары.КлючСвязи КАК КлючСвязи,
		|	ЗаказКлиентаТовары.Номенклатура КАК Номенклатура,
		|	ЗаказКлиентаТовары.КоличествоУпаковок КАК КоличествоУпаковок,
		|	ЗаказКлиентаТовары.ВариантОбеспечения КАК ВариантОбеспечения,
		|	ЗаказКлиентаТовары.НомерСтроки КАК НомерСтроки,
		|	ЗаказКлиентаТовары.ДатаОтгрузки КАК ДатаОтгрузки,
		|	ЗаказКлиентаТовары.Характеристика КАК Характеристика,
		|	ЗаказКлиентаТовары.Упаковка КАК Упаковка,
		|	ЗаказКлиентаТовары.Количество КАК Количество,
		|	ЗаказКлиентаТовары.ВидЦены КАК ВидЦены,
		|	ЗаказКлиентаТовары.Цена КАК Цена,
		|	ЗаказКлиентаТовары.Сумма КАК Сумма,
		|	ЗаказКлиентаТовары.СтавкаНДС КАК СтавкаНДС,
		|	ЗаказКлиентаТовары.СуммаНДС КАК СуммаНДС,
		|	ЗаказКлиентаТовары.СуммаСНДС КАК СуммаСНДС,
		|	ЗаказКлиентаТовары.ПроцентРучнойСкидки КАК ПроцентРучнойСкидки,
		|	ЗаказКлиентаТовары.СуммаРучнойСкидки КАК СуммаРучнойСкидки,
		|	ЗаказКлиентаТовары.ПроцентАвтоматическойСкидки КАК ПроцентАвтоматическойСкидки,
		|	ЗаказКлиентаТовары.СуммаАвтоматическойСкидки КАК СуммаАвтоматическойСкидки,
		|	ЗаказКлиентаТовары.ПричинаОтмены КАК ПричинаОтмены,
		|	ЗаказКлиентаТовары.КодСтроки КАК КодСтроки,
		|	ЗаказКлиентаТовары.Отменено КАК Отменено,
		|	ЗаказКлиентаТовары.Склад КАК Склад,
		|	ЗаказКлиентаТовары.СрокПоставки КАК СрокПоставки,
		|	ЗаказКлиентаТовары.Содержание КАК Содержание,
		|	ЗаказКлиентаТовары.СтатусУказанияСерий КАК СтатусУказанияСерий,
		|	ЗаказКлиентаТовары.УказыватьСерии КАК УказыватьСерии
		|ПОМЕСТИТЬ КешТоварыОтменены
		|ИЗ
		|	Документ.ЗаказКлиента.Товары КАК ЗаказКлиентаТовары
		|ГДЕ
		|	ЗаказКлиентаТовары.Ссылка = &Ссылка
		|	И ЗаказКлиентаТовары.Отменено
		|
		|ИНДЕКСИРОВАТЬ ПО
		|	КлючСвязи
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	ЗаказКлиентаТовары.КлючСвязи КАК КлючСвязи,
		|	ЗаказКлиентаТовары.Номенклатура КАК Номенклатура,
		|	ЗаказКлиентаТовары.КоличествоУпаковок КАК КоличествоУпаковок,
		|	ЗаказКлиентаТовары.ВариантОбеспечения КАК ВариантОбеспечения,
		|	ЗаказКлиентаТовары.НомерСтроки КАК НомерСтроки,
		|	ЗаказКлиентаТовары.ДатаОтгрузки КАК ДатаОтгрузки,
		|	ЗаказКлиентаТовары.Характеристика КАК Характеристика,
		|	ЗаказКлиентаТовары.Упаковка КАК Упаковка,
		|	ЗаказКлиентаТовары.Количество КАК Количество,
		|	ЗаказКлиентаТовары.ВидЦены КАК ВидЦены,
		|	ЗаказКлиентаТовары.Цена КАК Цена,
		|	ЗаказКлиентаТовары.Сумма КАК Сумма,
		|	ЗаказКлиентаТовары.СтавкаНДС КАК СтавкаНДС,
		|	ЗаказКлиентаТовары.СуммаНДС КАК СуммаНДС,
		|	ЗаказКлиентаТовары.СуммаСНДС КАК СуммаСНДС,
		|	ЗаказКлиентаТовары.ПроцентРучнойСкидки КАК ПроцентРучнойСкидки,
		|	ЗаказКлиентаТовары.СуммаРучнойСкидки КАК СуммаРучнойСкидки,
		|	ЗаказКлиентаТовары.ПроцентАвтоматическойСкидки КАК ПроцентАвтоматическойСкидки,
		|	ЗаказКлиентаТовары.СуммаАвтоматическойСкидки КАК СуммаАвтоматическойСкидки,
		|	ЗаказКлиентаТовары.ПричинаОтмены КАК ПричинаОтмены,
		|	ЗаказКлиентаТовары.КодСтроки КАК КодСтроки,
		|	ЗаказКлиентаТовары.Отменено КАК Отменено,
		|	ЗаказКлиентаТовары.Склад КАК Склад,
		|	ЗаказКлиентаТовары.СрокПоставки КАК СрокПоставки,
		|	ЗаказКлиентаТовары.Содержание КАК Содержание,
		|	ЗаказКлиентаТовары.СтатусУказанияСерий КАК СтатусУказанияСерий,
		|	ЗаказКлиентаТовары.УказыватьСерии КАК УказыватьСерии
		|ПОМЕСТИТЬ КешТоварыНЕОтменены
		|ИЗ
		|	Документ.ЗаказКлиента.Товары КАК ЗаказКлиентаТовары
		|ГДЕ
		|	ЗаказКлиентаТовары.Ссылка = &Ссылка
		|	И НЕ ЗаказКлиентаТовары.Отменено
		|
		|ИНДЕКСИРОВАТЬ ПО
		|	КлючСвязи
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	КешТоварыНЕОтменены.КлючСвязи КАК КлючСвязи,
		|	КешТоварыНЕОтменены.Номенклатура КАК Номенклатура,
		|	КешТоварыНЕОтменены.ВариантОбеспечения КАК ВариантОбеспечения,
		|	КешТоварыНЕОтменены.НомерСтроки КАК НомерСтроки,
		|	КешТоварыНЕОтменены.ДатаОтгрузки КАК ДатаОтгрузки,
		|	КешТоварыНЕОтменены.Характеристика,
		|	КешТоварыНЕОтменены.Упаковка,
		|	КешТоварыНЕОтменены.КоличествоУпаковок - ЕСТЬNULL(ОбеспечениеТовары.КоличествоУпаковок, 0) КАК КоличествоУпаковок,
		|	КешТоварыНЕОтменены.Количество,
		|	КешТоварыНЕОтменены.ВидЦены,
		|	КешТоварыНЕОтменены.Цена,
		|	КешТоварыНЕОтменены.Сумма,
		|	КешТоварыНЕОтменены.СтавкаНДС,
		|	КешТоварыНЕОтменены.СуммаНДС,
		|	КешТоварыНЕОтменены.СуммаСНДС,
		|	КешТоварыНЕОтменены.ПроцентРучнойСкидки,
		|	КешТоварыНЕОтменены.СуммаРучнойСкидки,
		|	КешТоварыНЕОтменены.ПроцентАвтоматическойСкидки,
		|	КешТоварыНЕОтменены.СуммаАвтоматическойСкидки,
		|	КешТоварыНЕОтменены.ПричинаОтмены,
		|	КешТоварыНЕОтменены.КодСтроки,
		|	КешТоварыНЕОтменены.Отменено,
		|	КешТоварыНЕОтменены.Склад,
		|	КешТоварыНЕОтменены.СрокПоставки,
		|	КешТоварыНЕОтменены.Содержание,
		|	КешТоварыНЕОтменены.СтатусУказанияСерий,
		|	КешТоварыНЕОтменены.УказыватьСерии,
		|	ИСТИНА КАК Отгружен
		|ПОМЕСТИТЬ КешОтгруженыхТоваров
		|ИЗ
		|	КешТоварыНЕОтменены КАК КешТоварыНЕОтменены
		|		ЛЕВОЕ СОЕДИНЕНИЕ ОбеспечениеТовары КАК ОбеспечениеТовары
		|		ПО КешТоварыНЕОтменены.ВариантОбеспечения = ОбеспечениеТовары.ВариантОбеспечения
		|			И КешТоварыНЕОтменены.НомерСтроки = ОбеспечениеТовары.НомерСтроки
		|			И КешТоварыНЕОтменены.КодСтроки = ОбеспечениеТовары.КодСтроки
		|ГДЕ
		|	КешТоварыНЕОтменены.ВариантОбеспечения = ЗНАЧЕНИЕ(Перечисление.ВариантыОбеспечения.ПустаяСсылка)
		|	И КешТоварыНЕОтменены.КоличествоУпаковок - ЕСТЬNULL(ОбеспечениеТовары.КоличествоУпаковок, 0) > 0
		|	И НЕ КешТоварыНЕОтменены.Номенклатура.ТипНоменклатуры = ЗНАЧЕНИЕ(Перечисление.ТипыНоменклатуры.Услуга)
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	ЗаказКлиентаТовары.КлючСвязи КАК КлючСвязи,
		|	ЗаказКлиентаТовары.Номенклатура,
		|	ЗаказКлиентаТовары.КоличествоУпаковок,
		|	ЗаказКлиентаТовары.ВариантОбеспечения,
		|	ЗаказКлиентаТовары.НомерСтроки,
		|	ЗаказКлиентаТовары.ДатаОтгрузки,
		|	ЗаказКлиентаТовары.Характеристика,
		|	ЗаказКлиентаТовары.Упаковка,
		|	ЗаказКлиентаТовары.Количество,
		|	ЗаказКлиентаТовары.ВидЦены,
		|	ЗаказКлиентаТовары.Цена,
		|	ЗаказКлиентаТовары.Сумма,
		|	ЗаказКлиентаТовары.СтавкаНДС,
		|	ЗаказКлиентаТовары.СуммаНДС,
		|	ЗаказКлиентаТовары.СуммаСНДС,
		|	ЗаказКлиентаТовары.ПроцентРучнойСкидки,
		|	ЗаказКлиентаТовары.СуммаРучнойСкидки,
		|	ЗаказКлиентаТовары.ПроцентАвтоматическойСкидки,
		|	ЗаказКлиентаТовары.СуммаАвтоматическойСкидки,
		|	ЗаказКлиентаТовары.ПричинаОтмены,
		|	ЗаказКлиентаТовары.КодСтроки,
		|	ЗаказКлиентаТовары.Отменено,
		|	ЗаказКлиентаТовары.Склад,
		|	ЗаказКлиентаТовары.СрокПоставки,
		|	ЗаказКлиентаТовары.Содержание,
		|	ЗаказКлиентаТовары.СтатусУказанияСерий,
		|	ЗаказКлиентаТовары.УказыватьСерии,
		|	ВЫБОР
		|		КОГДА ЗаказКлиентаТовары.КоличествоУпаковок - ЕСТЬNULL(ОбеспечениеТовары.КоличествоУпаковок, 0) >= 0
		|			ТОГДА ИСТИНА
		|		ИНАЧЕ ЛОЖЬ
		|	КОНЕЦ КАК Отгружен
		|ПОМЕСТИТЬ КешТоварыПодЗаказ
		|ИЗ
		|	КешТоварыНЕОтменены КАК ЗаказКлиентаТовары
		|		ЛЕВОЕ СОЕДИНЕНИЕ ОбеспечениеТовары КАК ОбеспечениеТовары
		|		ПО ЗаказКлиентаТовары.ВариантОбеспечения = ОбеспечениеТовары.ВариантОбеспечения
		|			И ЗаказКлиентаТовары.НомерСтроки = ОбеспечениеТовары.НомерСтроки
		|			И ЗаказКлиентаТовары.КодСтроки = ОбеспечениеТовары.КодСтроки
		|ГДЕ
		|	НЕ ЗаказКлиентаТовары.Номенклатура.ТипНоменклатуры = ЗНАЧЕНИЕ(Перечисление.ТипыНоменклатуры.Услуга)
		|	И ЗаказКлиентаТовары.ВариантОбеспечения = ЗНАЧЕНИЕ(Перечисление.ВариантыОбеспечения.ПодЗаказ)
		|
		|ИНДЕКСИРОВАТЬ ПО
		|	КлючСвязи
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	ЗаказКлиентаУслуги.КлючСвязи КАК КлючСвязи,
		|	ЗаказКлиентаУслуги.Номенклатура,
		|	ЗаказКлиентаУслуги.КоличествоУпаковок,
		|	ЗНАЧЕНИЕ(Перечисление.ВариантыОбеспечения.ПустаяСсылка) КАК ВариантОбеспечения,
		|	ЗаказКлиентаУслуги.НомерСтроки,
		|	ЗаказКлиентаУслуги.ДатаОтгрузки,
		|	ЗаказКлиентаУслуги.Характеристика,
		|	ЗаказКлиентаУслуги.Упаковка,
		|	ЗаказКлиентаУслуги.Количество,
		|	ЗаказКлиентаУслуги.ВидЦены,
		|	ЗаказКлиентаУслуги.Цена,
		|	ЗаказКлиентаУслуги.Сумма,
		|	ЗаказКлиентаУслуги.СтавкаНДС,
		|	ЗаказКлиентаУслуги.СуммаНДС,
		|	ЗаказКлиентаУслуги.СуммаСНДС,
		|	ЗаказКлиентаУслуги.ПроцентРучнойСкидки,
		|	ЗаказКлиентаУслуги.СуммаРучнойСкидки,
		|	ЗаказКлиентаУслуги.ПроцентАвтоматическойСкидки,
		|	ЗаказКлиентаУслуги.СуммаАвтоматическойСкидки,
		|	ЗаказКлиентаУслуги.ПричинаОтмены,
		|	ЗаказКлиентаУслуги.КодСтроки,
		|	ЗаказКлиентаУслуги.Отменено,
		|	ЗаказКлиентаУслуги.Склад,
		|	ЗаказКлиентаУслуги.СрокПоставки,
		|	ЗаказКлиентаУслуги.Содержание,
		|	ЗаказКлиентаУслуги.СтатусУказанияСерий,
		|	ЗаказКлиентаУслуги.УказыватьСерии,
		|	ИСТИНА КАК Услуга,
		|	ВЫБОР
		|		КОГДА ЗаказКлиентаУслуги.КоличествоУпаковок - ЕСТЬNULL(ОбеспечениеТовары.КоличествоУпаковок, 0) >= 0
		|			ТОГДА ИСТИНА
		|		ИНАЧЕ ЛОЖЬ
		|	КОНЕЦ КАК Поле1
		|ПОМЕСТИТЬ КешУслуги
		|ИЗ
		|	КешТоварыНЕОтменены КАК ЗаказКлиентаУслуги
		|		ЛЕВОЕ СОЕДИНЕНИЕ ОбеспечениеТовары КАК ОбеспечениеТовары
		|		ПО ЗаказКлиентаУслуги.ВариантОбеспечения = ОбеспечениеТовары.ВариантОбеспечения
		|			И ЗаказКлиентаУслуги.НомерСтроки = ОбеспечениеТовары.НомерСтроки
		|			И ЗаказКлиентаУслуги.КодСтроки = ОбеспечениеТовары.КодСтроки
		|ГДЕ
		|	ЗаказКлиентаУслуги.Номенклатура.ТипНоменклатуры = ЗНАЧЕНИЕ(Перечисление.ТипыНоменклатуры.Услуга)
		|
		|ИНДЕКСИРОВАТЬ ПО
		|	КлючСвязи
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	ЗаказКлиентаТовары.КлючСвязи КАК КлючСвязи,
		|	ЗаказКлиентаТовары.Номенклатура,
		|	ЗаказКлиентаТовары.КоличествоУпаковок,
		|	ЗаказКлиентаТовары.ВариантОбеспечения,
		|	ЗаказКлиентаТовары.НомерСтроки,
		|	ЗаказКлиентаТовары.ДатаОтгрузки,
		|	ЗаказКлиентаТовары.Характеристика,
		|	ЗаказКлиентаТовары.Упаковка,
		|	ЗаказКлиентаТовары.Количество,
		|	ЗаказКлиентаТовары.ВидЦены,
		|	ЗаказКлиентаТовары.Цена,
		|	ЗаказКлиентаТовары.Сумма,
		|	ЗаказКлиентаТовары.СтавкаНДС,
		|	ЗаказКлиентаТовары.СуммаНДС,
		|	ЗаказКлиентаТовары.СуммаСНДС,
		|	ЗаказКлиентаТовары.ПроцентРучнойСкидки,
		|	ЗаказКлиентаТовары.СуммаРучнойСкидки,
		|	ЗаказКлиентаТовары.ПроцентАвтоматическойСкидки,
		|	ЗаказКлиентаТовары.СуммаАвтоматическойСкидки,
		|	ЗаказКлиентаТовары.ПричинаОтмены,
		|	ЗаказКлиентаТовары.КодСтроки,
		|	ЗаказКлиентаТовары.Отменено,
		|	ЗаказКлиентаТовары.Склад,
		|	ЗаказКлиентаТовары.СрокПоставки,
		|	ЗаказКлиентаТовары.Содержание,
		|	ЗаказКлиентаТовары.СтатусУказанияСерий,
		|	ЗаказКлиентаТовары.УказыватьСерии,
		|	ВЫБОР
		|		КОГДА ЗаказКлиентаТовары.КоличествоУпаковок - ЕСТЬNULL(ОбеспечениеТовары.КоличествоУпаковок, 0) >= 0
		|			ТОГДА ИСТИНА
		|		ИНАЧЕ ЛОЖЬ
		|	КОНЕЦ КАК Отгружено
		|ПОМЕСТИТЬ ТоварыСоСклада
		|ИЗ
		|	КешТоварыНЕОтменены КАК ЗаказКлиентаТовары
		|		ЛЕВОЕ СОЕДИНЕНИЕ ОбеспечениеТовары КАК ОбеспечениеТовары
		|		ПО ЗаказКлиентаТовары.ВариантОбеспечения = ОбеспечениеТовары.ВариантОбеспечения
		|			И ЗаказКлиентаТовары.КодСтроки = ОбеспечениеТовары.КодСтроки
		|			И ЗаказКлиентаТовары.НомерСтроки = ОбеспечениеТовары.НомерСтроки
		|ГДЕ
		|	НЕ ЗаказКлиентаТовары.Номенклатура.ТипНоменклатуры = ЗНАЧЕНИЕ(Перечисление.ТипыНоменклатуры.Услуга)
		|	И ЗаказКлиентаТовары.ВариантОбеспечения = ЗНАЧЕНИЕ(Перечисление.ВариантыОбеспечения.СоСклада)
		|
		|ИНДЕКСИРОВАТЬ ПО
		|	КлючСвязи
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	ЗаказКлиентаТовары.КлючСвязи КАК КлючСвязи,
		|	ЗаказКлиентаТовары.Номенклатура,
		|	ОбеспечениеТовары.КоличествоУпаковок,
		|	ЗаказКлиентаТовары.ВариантОбеспечения,
		|	ЗаказКлиентаТовары.НомерСтроки,
		|	ЗаказКлиентаТовары.ДатаОтгрузки,
		|	ЗаказКлиентаТовары.Характеристика,
		|	ЗаказКлиентаТовары.Упаковка,
		|	ЗаказКлиентаТовары.Количество,
		|	ЗаказКлиентаТовары.ВидЦены,
		|	ЗаказКлиентаТовары.Цена,
		|	ЗаказКлиентаТовары.Сумма,
		|	ЗаказКлиентаТовары.СтавкаНДС,
		|	ЗаказКлиентаТовары.СуммаНДС,
		|	ЗаказКлиентаТовары.СуммаСНДС,
		|	ЗаказКлиентаТовары.ПроцентРучнойСкидки,
		|	ЗаказКлиентаТовары.СуммаРучнойСкидки,
		|	ЗаказКлиентаТовары.ПроцентАвтоматическойСкидки,
		|	ЗаказКлиентаТовары.СуммаАвтоматическойСкидки,
		|	ЗаказКлиентаТовары.ПричинаОтмены,
		|	ЗаказКлиентаТовары.КодСтроки,
		|	ЗаказКлиентаТовары.Отменено,
		|	ЗаказКлиентаТовары.Склад,
		|	ЗаказКлиентаТовары.СрокПоставки,
		|	ЗаказКлиентаТовары.Содержание,
		|	ЗаказКлиентаТовары.СтатусУказанияСерий,
		|	ЗаказКлиентаТовары.УказыватьСерии
		|ПОМЕСТИТЬ КешТоварыАвто
		|ИЗ
		|	КешТоварыНЕОтменены КАК ЗаказКлиентаТовары
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ОбеспечениеТовары КАК ОбеспечениеТовары
		|		ПО ЗаказКлиентаТовары.НомерСтроки = ОбеспечениеТовары.НомерСтроки
		|			И ЗаказКлиентаТовары.КодСтроки = ОбеспечениеТовары.КодСтроки
		|			И ЗаказКлиентаТовары.ВариантОбеспечения = ОбеспечениеТовары.ВариантОбеспечения
		|			И (ЗаказКлиентаТовары.КоличествоУпаковок - ОбеспечениеТовары.КоличествоУпаковок >= 0)
		|ГДЕ
		|	НЕ ЗаказКлиентаТовары.Номенклатура.ТипНоменклатуры = ЗНАЧЕНИЕ(Перечисление.ТипыНоменклатуры.Услуга)
		|	И ЗаказКлиентаТовары.ВариантОбеспечения = ЗНАЧЕНИЕ(Перечисление.ВариантыОбеспечения.ПустаяСсылка)
		|
		|ИНДЕКСИРОВАТЬ ПО
		|	КлючСвязи
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	КешТовары.КлючСвязи,
		|	КешТовары.Номенклатура,
		|	КешТовары.КоличествоУпаковок,
		|	СУММА(КешТоварыКопия.КоличествоУпаковок) КАК КоличествоУпаковокНаростающие,
		|	КешТовары.ВариантОбеспечения,
		|	КешТовары.НомерСтроки,
		|	КешТовары.ДатаОтгрузки,
		|	КешТовары.Характеристика,
		|	КешТовары.Упаковка,
		|	КешТовары.Количество,
		|	КешТовары.ВидЦены,
		|	КешТовары.Цена,
		|	КешТовары.Сумма,
		|	КешТовары.СтавкаНДС,
		|	КешТовары.СуммаНДС,
		|	КешТовары.СуммаСНДС,
		|	КешТовары.ПроцентРучнойСкидки,
		|	КешТовары.СуммаРучнойСкидки,
		|	КешТовары.ПроцентАвтоматическойСкидки,
		|	КешТовары.СуммаАвтоматическойСкидки,
		|	КешТовары.ПричинаОтмены,
		|	КешТовары.КодСтроки,
		|	КешТовары.Отменено,
		|	КешТовары.Склад,
		|	КешТовары.СрокПоставки,
		|	КешТовары.Содержание,
		|	КешТовары.СтатусУказанияСерий,
		|	КешТовары.УказыватьСерии
		|ПОМЕСТИТЬ КешТоварыАвтоНаростающие
		|ИЗ
		|	КешТоварыАвто КАК КешТовары
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ КешТоварыАвто КАК КешТоварыКопия
		|		ПО КешТовары.КлючСвязи >= КешТоварыКопия.КлючСвязи
		|			И КешТовары.Номенклатура = КешТоварыКопия.Номенклатура
		|
		|СГРУППИРОВАТЬ ПО
		|	КешТовары.Номенклатура,
		|	КешТовары.КлючСвязи,
		|	КешТовары.КоличествоУпаковок,
		|	КешТовары.ВариантОбеспечения,
		|	КешТовары.НомерСтроки,
		|	КешТовары.ДатаОтгрузки,
		|	КешТовары.Характеристика,
		|	КешТовары.Упаковка,
		|	КешТовары.Количество,
		|	КешТовары.ВидЦены,
		|	КешТовары.Цена,
		|	КешТовары.Сумма,
		|	КешТовары.СтавкаНДС,
		|	КешТовары.СуммаНДС,
		|	КешТовары.СуммаСНДС,
		|	КешТовары.ПроцентРучнойСкидки,
		|	КешТовары.СуммаРучнойСкидки,
		|	КешТовары.ПроцентАвтоматическойСкидки,
		|	КешТовары.СуммаАвтоматическойСкидки,
		|	КешТовары.ПричинаОтмены,
		|	КешТовары.КодСтроки,
		|	КешТовары.Отменено,
		|	КешТовары.Склад,
		|	КешТовары.СрокПоставки,
		|	КешТовары.Содержание,
		|	КешТовары.СтатусУказанияСерий,
		|	КешТовары.УказыватьСерии
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	СвободныеОстаткиОстатки.Номенклатура,
		|	ВЫБОР
		|		КОГДА НЕ &Проведен
		|				И СвободныеОстаткиОстатки.ВНаличииОстаток - СвободныеОстаткиОстатки.ВРезервеОстаток >= 0
		|			ТОГДА СвободныеОстаткиОстатки.ВНаличииОстаток - СвободныеОстаткиОстатки.ВРезервеОстаток
		|		КОГДА &Проведен
		|				И СвободныеОстаткиОстатки.ВНаличииОстаток - (СвободныеОстаткиОстатки.ВРезервеОстаток - ВложенныйЗапрос.КоличествоУпаковок) >= 0
		|			ТОГДА СвободныеОстаткиОстатки.ВНаличииОстаток - (СвободныеОстаткиОстатки.ВРезервеОстаток - ВложенныйЗапрос.КоличествоУпаковок)
		|		ИНАЧЕ 0
		|	КОНЕЦ КАК ВНаличии
		|ПОМЕСТИТЬ КешТоварыАвто_НаСкладе
		|ИЗ
		|	РегистрНакопления.СвободныеОстатки.Остатки(
		|			,
		|			Номенклатура В
		|					(ВЫБРАТЬ
		|						КешТовары.Номенклатура
		|					ИЗ
		|						КешТоварыАвто КАК КешТовары)
		|				И Склад = &Склад) КАК СвободныеОстаткиОстатки
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ (ВЫБРАТЬ
		|			КешТовары.Номенклатура КАК Номенклатура,
		|			СУММА(КешТовары.КоличествоУпаковок) КАК КоличествоУпаковок
		|		ИЗ
		|			КешТоварыАвто КАК КешТовары
		|		
		|		СГРУППИРОВАТЬ ПО
		|			КешТовары.Номенклатура) КАК ВложенныйЗапрос
		|		ПО СвободныеОстаткиОстатки.Номенклатура = ВложенныйЗапрос.Номенклатура
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	КешТоварыНаростающие.КлючСвязи,
		|	КешТоварыНаростающие.Номенклатура,
		|	КешТоварыНаростающие.КоличествоУпаковок,
		|	КешТоварыНаростающие.КоличествоУпаковокНаростающие,
		|	ВЫБОР
		|		КОГДА ЕСТЬNULL(КешТоварыНаСкладе.ВНаличии, 0) - КешТоварыНаростающие.КоличествоУпаковокНаростающие >= 0
		|			ТОГДА КешТоварыНаростающие.КоличествоУпаковок
		|		КОГДА ЕСТЬNULL(КешТоварыНаСкладе.ВНаличии, 0) - КешТоварыНаростающие.КоличествоУпаковокНаростающие >= 0
		|				И КешТоварыНаростающие.КоличествоУпаковок - (ЕСТЬNULL(КешТоварыНаСкладе.ВНаличии, 0) - КешТоварыНаростающие.КоличествоУпаковокНаростающие) >= 0
		|			ТОГДА КешТоварыНаростающие.КоличествоУпаковок - (ЕСТЬNULL(КешТоварыНаСкладе.ВНаличии, 0) - КешТоварыНаростающие.КоличествоУпаковокНаростающие)
		|		КОГДА ЕСТЬNULL(КешТоварыНаСкладе.ВНаличии, 0) - КешТоварыНаростающие.КоличествоУпаковокНаростающие < 0
		|				И КешТоварыНаростающие.КоличествоУпаковок + (ЕСТЬNULL(КешТоварыНаСкладе.ВНаличии, 0) - КешТоварыНаростающие.КоличествоУпаковокНаростающие) >= 0
		|			ТОГДА КешТоварыНаростающие.КоличествоУпаковок + (ЕСТЬNULL(КешТоварыНаСкладе.ВНаличии, 0) - КешТоварыНаростающие.КоличествоУпаковокНаростающие)
		|		ИНАЧЕ 0
		|	КОНЕЦ КАК СоСклада,
		|	КешТоварыНаростающие.ВариантОбеспечения,
		|	КешТоварыНаростающие.НомерСтроки,
		|	КешТоварыНаростающие.ДатаОтгрузки,
		|	КешТоварыНаростающие.Характеристика,
		|	КешТоварыНаростающие.Упаковка,
		|	КешТоварыНаростающие.Количество,
		|	КешТоварыНаростающие.ВидЦены,
		|	КешТоварыНаростающие.Цена,
		|	КешТоварыНаростающие.Сумма,
		|	КешТоварыНаростающие.СтавкаНДС,
		|	КешТоварыНаростающие.СуммаНДС,
		|	КешТоварыНаростающие.СуммаСНДС,
		|	КешТоварыНаростающие.ПроцентРучнойСкидки,
		|	КешТоварыНаростающие.СуммаРучнойСкидки,
		|	КешТоварыНаростающие.ПроцентАвтоматическойСкидки,
		|	КешТоварыНаростающие.СуммаАвтоматическойСкидки,
		|	КешТоварыНаростающие.ПричинаОтмены,
		|	КешТоварыНаростающие.КодСтроки,
		|	КешТоварыНаростающие.Отменено,
		|	КешТоварыНаростающие.Склад,
		|	КешТоварыНаростающие.СрокПоставки,
		|	КешТоварыНаростающие.Содержание,
		|	КешТоварыНаростающие.СтатусУказанияСерий,
		|	КешТоварыНаростающие.УказыватьСерии
		|ПОМЕСТИТЬ ОсновнойКешАвто_СоСклада
		|ИЗ
		|	КешТоварыАвтоНаростающие КАК КешТоварыНаростающие
		|		ЛЕВОЕ СОЕДИНЕНИЕ КешТоварыАвто_НаСкладе КАК КешТоварыНаСкладе
		|		ПО КешТоварыНаростающие.Номенклатура = КешТоварыНаСкладе.Номенклатура
		|
		|СГРУППИРОВАТЬ ПО
		|	КешТоварыНаростающие.КлючСвязи,
		|	КешТоварыНаростающие.Номенклатура,
		|	КешТоварыНаростающие.КоличествоУпаковок,
		|	КешТоварыНаростающие.КоличествоУпаковокНаростающие,
		|	КешТоварыНаСкладе.ВНаличии,
		|	КешТоварыНаростающие.ВариантОбеспечения,
		|	КешТоварыНаростающие.НомерСтроки,
		|	КешТоварыНаростающие.ДатаОтгрузки,
		|	КешТоварыНаростающие.Характеристика,
		|	КешТоварыНаростающие.Упаковка,
		|	КешТоварыНаростающие.Количество,
		|	КешТоварыНаростающие.ВидЦены,
		|	КешТоварыНаростающие.Цена,
		|	КешТоварыНаростающие.Сумма,
		|	КешТоварыНаростающие.СтавкаНДС,
		|	КешТоварыНаростающие.СуммаНДС,
		|	КешТоварыНаростающие.СуммаСНДС,
		|	КешТоварыНаростающие.ПроцентРучнойСкидки,
		|	КешТоварыНаростающие.СуммаРучнойСкидки,
		|	КешТоварыНаростающие.ПроцентАвтоматическойСкидки,
		|	КешТоварыНаростающие.СуммаАвтоматическойСкидки,
		|	КешТоварыНаростающие.ПричинаОтмены,
		|	КешТоварыНаростающие.КодСтроки,
		|	КешТоварыНаростающие.Отменено,
		|	КешТоварыНаростающие.Склад,
		|	КешТоварыНаростающие.СрокПоставки,
		|	КешТоварыНаростающие.Содержание,
		|	КешТоварыНаростающие.СтатусУказанияСерий,
		|	КешТоварыНаростающие.УказыватьСерии
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	ОсновнойКешСоСклада.КлючСвязи,
		|	ОсновнойКешСоСклада.Номенклатура,
		|	ОсновнойКешСоСклада.КоличествоУпаковок - ОсновнойКешСоСклада.СоСклада КАК КоличествоУпаковок,
		|	ОсновнойКешСоСклада.КоличествоУпаковокНаростающие,
		|	ОсновнойКешСоСклада.СоСклада,
		|	ОсновнойКешСоСклада.ВариантОбеспечения,
		|	ОсновнойКешСоСклада.НомерСтроки,
		|	ОсновнойКешСоСклада.ДатаОтгрузки,
		|	ОсновнойКешСоСклада.Характеристика,
		|	ОсновнойКешСоСклада.Упаковка,
		|	ОсновнойКешСоСклада.Количество,
		|	ОсновнойКешСоСклада.ВидЦены,
		|	ОсновнойКешСоСклада.Цена,
		|	ОсновнойКешСоСклада.Сумма,
		|	ОсновнойКешСоСклада.СтавкаНДС,
		|	ОсновнойКешСоСклада.СуммаНДС,
		|	ОсновнойКешСоСклада.СуммаСНДС,
		|	ОсновнойКешСоСклада.ПроцентРучнойСкидки,
		|	ОсновнойКешСоСклада.СуммаРучнойСкидки,
		|	ОсновнойКешСоСклада.ПроцентАвтоматическойСкидки,
		|	ОсновнойКешСоСклада.СуммаАвтоматическойСкидки,
		|	ОсновнойКешСоСклада.ПричинаОтмены,
		|	ОсновнойКешСоСклада.КодСтроки,
		|	ОсновнойКешСоСклада.Отменено,
		|	ОсновнойКешСоСклада.Склад,
		|	ОсновнойКешСоСклада.СрокПоставки,
		|	ОсновнойКешСоСклада.Содержание,
		|	ОсновнойКешСоСклада.СтатусУказанияСерий,
		|	ОсновнойКешСоСклада.УказыватьСерии
		|ПОМЕСТИТЬ КешТоварыАвто_АвтоОбеспечение
		|ИЗ
		|	ОсновнойКешАвто_СоСклада КАК ОсновнойКешСоСклада
		|ГДЕ
		|	ОсновнойКешСоСклада.КоличествоУпаковок - ОсновнойКешСоСклада.СоСклада > 0
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	КТС_ТоварыКПоступлениюПодОбеспечениеОстатки.Номенклатура,
		|	КТС_ТоварыКПоступлениюПодОбеспечениеОстатки.КПоступлениюОстаток
		|ПОМЕСТИТЬ ОбособленныеПоступления
		|ИЗ
		|	РегистрНакопления.КТС_ТоварыКПоступлениюПодОбеспечение.Остатки(
		|			,
		|			Номенклатура В
		|					(ВЫБРАТЬ
		|						КешТоварыАвто.Номенклатура
		|					ИЗ
		|						КешТоварыАвто КАК КешТоварыАвто)
		|				И Склад = &Склад) КАК КТС_ТоварыКПоступлениюПодОбеспечениеОстатки
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	КТС_ТоварыКПоступлениюПодОбеспечениеОстатки.Номенклатура,
		|	КТС_ТоварыКПоступлениюПодОбеспечениеОстатки.КПоступлениюОстаток
		|ПОМЕСТИТЬ ПоступленияПодНашЗаказ
		|ИЗ
		|	РегистрНакопления.КТС_ТоварыКПоступлениюПодОбеспечение.Остатки(
		|			,
		|			Назначение.Заказ = &Ссылка
		|				И Номенклатура В
		|					(ВЫБРАТЬ
		|						КешТоварыАвто.Номенклатура
		|					ИЗ
		|						КешТоварыАвто КАК КешТоварыАвто)
		|				И Склад = &Склад) КАК КТС_ТоварыКПоступлениюПодОбеспечениеОстатки
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	ТоварыКПоступлениюОстатки.Номенклатура,
		|	ТоварыКПоступлениюОстатки.КПоступлениюОстаток - ЕСТЬNULL(ОбособленныеПоступления.КПоступлениюОстаток, 0) + ЕСТЬNULL(ПоступленияПодНашЗаказ.КПоступлениюОстаток, 0) КАК КПоступлениюОстаток
		|ПОМЕСТИТЬ КешТоварыАвто_КПоступлению
		|ИЗ
		|	РегистрНакопления.ТоварыКПоступлению.Остатки(
		|			,
		|			НЕ ДокументПоступления ССЫЛКА Документ.ЗаказПоставщику
		|				И Номенклатура В
		|					(ВЫБРАТЬ
		|						КешТовары.Номенклатура
		|					ИЗ
		|						КешТоварыАвто КАК КешТовары)
		|				И Склад = &Склад) КАК ТоварыКПоступлениюОстатки
		|		ЛЕВОЕ СОЕДИНЕНИЕ ОбособленныеПоступления КАК ОбособленныеПоступления
		|		ПО ТоварыКПоступлениюОстатки.Номенклатура = ОбособленныеПоступления.Номенклатура
		|		ЛЕВОЕ СОЕДИНЕНИЕ ПоступленияПодНашЗаказ КАК ПоступленияПодНашЗаказ
		|		ПО ТоварыКПоступлениюОстатки.Номенклатура = ПоступленияПодНашЗаказ.Номенклатура
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	КешТоварыАвтоОбеспечение.КлючСвязи,
		|	КешТоварыАвтоОбеспечение.Номенклатура,
		|	КешТоварыАвтоОбеспечение.КоличествоУпаковок,
		|	СУММА(КешТоварыАвтоОбеспечениеКопия.КоличествоУпаковок) КАК КоличествоУпаковокНаростающие,
		|	КешТоварыАвтоОбеспечение.СоСклада,
		|	КешТоварыАвтоОбеспечение.ВариантОбеспечения,
		|	КешТоварыАвтоОбеспечение.НомерСтроки,
		|	КешТоварыАвтоОбеспечение.ДатаОтгрузки,
		|	КешТоварыАвтоОбеспечение.Характеристика,
		|	КешТоварыАвтоОбеспечение.Упаковка,
		|	КешТоварыАвтоОбеспечение.Количество,
		|	КешТоварыАвтоОбеспечение.ВидЦены,
		|	КешТоварыАвтоОбеспечение.Цена,
		|	КешТоварыАвтоОбеспечение.Сумма,
		|	КешТоварыАвтоОбеспечение.СтавкаНДС,
		|	КешТоварыАвтоОбеспечение.СуммаНДС,
		|	КешТоварыАвтоОбеспечение.СуммаСНДС,
		|	КешТоварыАвтоОбеспечение.ПроцентРучнойСкидки,
		|	КешТоварыАвтоОбеспечение.СуммаРучнойСкидки,
		|	КешТоварыАвтоОбеспечение.ПроцентАвтоматическойСкидки,
		|	КешТоварыАвтоОбеспечение.СуммаАвтоматическойСкидки,
		|	КешТоварыАвтоОбеспечение.ПричинаОтмены,
		|	КешТоварыАвтоОбеспечение.КодСтроки,
		|	КешТоварыАвтоОбеспечение.Отменено,
		|	КешТоварыАвтоОбеспечение.Склад,
		|	КешТоварыАвтоОбеспечение.СрокПоставки,
		|	КешТоварыАвтоОбеспечение.Содержание,
		|	КешТоварыАвтоОбеспечение.СтатусУказанияСерий,
		|	КешТоварыАвтоОбеспечение.УказыватьСерии
		|ПОМЕСТИТЬ КешТоварыАвто_АвтоОбеспечениеНаростающие
		|ИЗ
		|	КешТоварыАвто_АвтоОбеспечение КАК КешТоварыАвтоОбеспечение
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ КешТоварыАвто_АвтоОбеспечение КАК КешТоварыАвтоОбеспечениеКопия
		|		ПО КешТоварыАвтоОбеспечение.КлючСвязи >= КешТоварыАвтоОбеспечениеКопия.КлючСвязи
		|			И КешТоварыАвтоОбеспечение.Номенклатура = КешТоварыАвтоОбеспечениеКопия.Номенклатура
		|
		|СГРУППИРОВАТЬ ПО
		|	КешТоварыАвтоОбеспечение.Номенклатура,
		|	КешТоварыАвтоОбеспечение.КлючСвязи,
		|	КешТоварыАвтоОбеспечение.КоличествоУпаковок,
		|	КешТоварыАвтоОбеспечение.СоСклада,
		|	КешТоварыАвтоОбеспечение.ВариантОбеспечения,
		|	КешТоварыАвтоОбеспечение.НомерСтроки,
		|	КешТоварыАвтоОбеспечение.ДатаОтгрузки,
		|	КешТоварыАвтоОбеспечение.Характеристика,
		|	КешТоварыАвтоОбеспечение.Упаковка,
		|	КешТоварыАвтоОбеспечение.Количество,
		|	КешТоварыАвтоОбеспечение.ВидЦены,
		|	КешТоварыАвтоОбеспечение.Цена,
		|	КешТоварыАвтоОбеспечение.Сумма,
		|	КешТоварыАвтоОбеспечение.СтавкаНДС,
		|	КешТоварыАвтоОбеспечение.СуммаНДС,
		|	КешТоварыАвтоОбеспечение.СуммаСНДС,
		|	КешТоварыАвтоОбеспечение.ПроцентРучнойСкидки,
		|	КешТоварыАвтоОбеспечение.СуммаРучнойСкидки,
		|	КешТоварыАвтоОбеспечение.ПроцентАвтоматическойСкидки,
		|	КешТоварыАвтоОбеспечение.СуммаАвтоматическойСкидки,
		|	КешТоварыАвтоОбеспечение.ПричинаОтмены,
		|	КешТоварыАвтоОбеспечение.КодСтроки,
		|	КешТоварыАвтоОбеспечение.Отменено,
		|	КешТоварыАвтоОбеспечение.Склад,
		|	КешТоварыАвтоОбеспечение.СрокПоставки,
		|	КешТоварыАвтоОбеспечение.Содержание,
		|	КешТоварыАвтоОбеспечение.СтатусУказанияСерий,
		|	КешТоварыАвтоОбеспечение.УказыватьСерии
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	КешТоварыАвтоОбеспечениеНаростающие.КлючСвязи,
		|	КешТоварыАвтоОбеспечениеНаростающие.Номенклатура,
		|	КешТоварыАвтоОбеспечениеНаростающие.КоличествоУпаковок,
		|	КешТоварыАвтоОбеспечениеНаростающие.КоличествоУпаковокНаростающие,
		|	ВЫБОР
		|		КОГДА ЕСТЬNULL(КешТоварыКПоступлению.КПоступлениюОстаток, 0) - КешТоварыАвтоОбеспечениеНаростающие.КоличествоУпаковокНаростающие >= 0
		|			ТОГДА КешТоварыАвтоОбеспечениеНаростающие.КоличествоУпаковок
		|		КОГДА ЕСТЬNULL(КешТоварыКПоступлению.КПоступлениюОстаток, 0) - КешТоварыАвтоОбеспечениеНаростающие.КоличествоУпаковокНаростающие >= 0
		|				И КешТоварыАвтоОбеспечениеНаростающие.КоличествоУпаковок - (ЕСТЬNULL(КешТоварыКПоступлению.КПоступлениюОстаток, 0) - КешТоварыАвтоОбеспечениеНаростающие.КоличествоУпаковокНаростающие) >= 0
		|			ТОГДА КешТоварыАвтоОбеспечениеНаростающие.КоличествоУпаковок - (ЕСТЬNULL(КешТоварыКПоступлению.КПоступлениюОстаток, 0) - КешТоварыАвтоОбеспечениеНаростающие.КоличествоУпаковокНаростающие)
		|		КОГДА ЕСТЬNULL(КешТоварыКПоступлению.КПоступлениюОстаток, 0) - КешТоварыАвтоОбеспечениеНаростающие.КоличествоУпаковокНаростающие < 0
		|				И КешТоварыАвтоОбеспечениеНаростающие.КоличествоУпаковок + (ЕСТЬNULL(КешТоварыКПоступлению.КПоступлениюОстаток, 0) - КешТоварыАвтоОбеспечениеНаростающие.КоличествоУпаковокНаростающие) >= 0
		|			ТОГДА КешТоварыАвтоОбеспечениеНаростающие.КоличествоУпаковок + (ЕСТЬNULL(КешТоварыКПоступлению.КПоступлениюОстаток, 0) - КешТоварыАвтоОбеспечениеНаростающие.КоличествоУпаковокНаростающие)
		|		ИНАЧЕ 0
		|	КОНЕЦ КАК Авто,
		|	КешТоварыАвтоОбеспечениеНаростающие.СоСклада,
		|	КешТоварыАвтоОбеспечениеНаростающие.ВариантОбеспечения,
		|	КешТоварыАвтоОбеспечениеНаростающие.НомерСтроки,
		|	КешТоварыАвтоОбеспечениеНаростающие.ДатаОтгрузки,
		|	КешТоварыАвтоОбеспечениеНаростающие.Характеристика,
		|	КешТоварыАвтоОбеспечениеНаростающие.Упаковка,
		|	КешТоварыАвтоОбеспечениеНаростающие.Количество,
		|	КешТоварыАвтоОбеспечениеНаростающие.ВидЦены,
		|	КешТоварыАвтоОбеспечениеНаростающие.Цена,
		|	КешТоварыАвтоОбеспечениеНаростающие.Сумма,
		|	КешТоварыАвтоОбеспечениеНаростающие.СтавкаНДС,
		|	КешТоварыАвтоОбеспечениеНаростающие.СуммаНДС,
		|	КешТоварыАвтоОбеспечениеНаростающие.СуммаСНДС,
		|	КешТоварыАвтоОбеспечениеНаростающие.ПроцентРучнойСкидки,
		|	КешТоварыАвтоОбеспечениеНаростающие.СуммаРучнойСкидки,
		|	КешТоварыАвтоОбеспечениеНаростающие.ПроцентАвтоматическойСкидки,
		|	КешТоварыАвтоОбеспечениеНаростающие.СуммаАвтоматическойСкидки,
		|	КешТоварыАвтоОбеспечениеНаростающие.ПричинаОтмены,
		|	КешТоварыАвтоОбеспечениеНаростающие.КодСтроки,
		|	КешТоварыАвтоОбеспечениеНаростающие.Отменено,
		|	КешТоварыАвтоОбеспечениеНаростающие.Склад,
		|	КешТоварыАвтоОбеспечениеНаростающие.СрокПоставки,
		|	КешТоварыАвтоОбеспечениеНаростающие.Содержание,
		|	КешТоварыАвтоОбеспечениеНаростающие.СтатусУказанияСерий,
		|	КешТоварыАвтоОбеспечениеНаростающие.УказыватьСерии
		|ПОМЕСТИТЬ ОсновнойКешАвто_Авто
		|ИЗ
		|	КешТоварыАвто_АвтоОбеспечениеНаростающие КАК КешТоварыАвтоОбеспечениеНаростающие
		|		ЛЕВОЕ СОЕДИНЕНИЕ КешТоварыАвто_КПоступлению КАК КешТоварыКПоступлению
		|		ПО КешТоварыАвтоОбеспечениеНаростающие.Номенклатура = КешТоварыКПоступлению.Номенклатура
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	Товары_СоСклада.КлючСвязи,
		|	Товары_СоСклада.Номенклатура,
		|	Товары_СоСклада.КоличествоУпаковок КАК КоличествоУпаковок,
		|	Товары_СоСклада.ВариантОбеспечения КАК ВариантОбеспечения,
		|	Товары_СоСклада.НомерСтроки,
		|	Товары_СоСклада.ДатаОтгрузки,
		|	Товары_СоСклада.Характеристика,
		|	Товары_СоСклада.Упаковка,
		|	Товары_СоСклада.Количество,
		|	Товары_СоСклада.ВидЦены,
		|	Товары_СоСклада.Цена,
		|	Товары_СоСклада.Сумма,
		|	Товары_СоСклада.СтавкаНДС,
		|	Товары_СоСклада.СуммаНДС,
		|	Товары_СоСклада.СуммаСНДС,
		|	Товары_СоСклада.ПроцентРучнойСкидки,
		|	Товары_СоСклада.СуммаРучнойСкидки,
		|	Товары_СоСклада.ПроцентАвтоматическойСкидки,
		|	Товары_СоСклада.СуммаАвтоматическойСкидки,
		|	Товары_СоСклада.ПричинаОтмены,
		|	Товары_СоСклада.КодСтроки,
		|	Товары_СоСклада.Отменено,
		|	Товары_СоСклада.Склад,
		|	Товары_СоСклада.СрокПоставки,
		|	Товары_СоСклада.Содержание,
		|	Товары_СоСклада.СтатусУказанияСерий,
		|	Товары_СоСклада.УказыватьСерии,
		|	Товары_СоСклада.Отгружено КАК Отгружен,
		|	NULL КАК Услуга
		|ИЗ
		|	ТоварыСоСклада КАК Товары_СоСклада
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	КешОтгруженыхТоваров.КлючСвязи,
		|	КешОтгруженыхТоваров.Номенклатура,
		|	КешОтгруженыхТоваров.КоличествоУпаковок,
		|	КешОтгруженыхТоваров.ВариантОбеспечения,
		|	КешОтгруженыхТоваров.НомерСтроки,
		|	КешОтгруженыхТоваров.ДатаОтгрузки,
		|	КешОтгруженыхТоваров.Характеристика,
		|	КешОтгруженыхТоваров.Упаковка,
		|	КешОтгруженыхТоваров.Количество,
		|	КешОтгруженыхТоваров.ВидЦены,
		|	КешОтгруженыхТоваров.Цена,
		|	КешОтгруженыхТоваров.Сумма,
		|	КешОтгруженыхТоваров.СтавкаНДС,
		|	КешОтгруженыхТоваров.СуммаНДС,
		|	КешОтгруженыхТоваров.СуммаСНДС,
		|	КешОтгруженыхТоваров.ПроцентРучнойСкидки,
		|	КешОтгруженыхТоваров.СуммаРучнойСкидки,
		|	КешОтгруженыхТоваров.ПроцентАвтоматическойСкидки,
		|	КешОтгруженыхТоваров.СуммаАвтоматическойСкидки,
		|	КешОтгруженыхТоваров.ПричинаОтмены,
		|	КешОтгруженыхТоваров.КодСтроки,
		|	КешОтгруженыхТоваров.Отменено,
		|	КешОтгруженыхТоваров.Склад,
		|	КешОтгруженыхТоваров.СрокПоставки,
		|	КешОтгруженыхТоваров.Содержание,
		|	КешОтгруженыхТоваров.СтатусУказанияСерий,
		|	КешОтгруженыхТоваров.УказыватьСерии,
		|	КешОтгруженыхТоваров.Отгружен,
		|	NULL
		|ИЗ
		|	КешОтгруженыхТоваров КАК КешОтгруженыхТоваров
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	ОсновнойКешАвто_СоСклада.КлючСвязи,
		|	ОсновнойКешАвто_СоСклада.Номенклатура,
		|	ОсновнойКешАвто_СоСклада.СоСклада,
		|	ЗНАЧЕНИЕ(Перечисление.ВариантыОбеспечения.СоСклада),
		|	ОсновнойКешАвто_СоСклада.НомерСтроки,
		|	ОсновнойКешАвто_СоСклада.ДатаОтгрузки,
		|	ОсновнойКешАвто_СоСклада.Характеристика,
		|	ОсновнойКешАвто_СоСклада.Упаковка,
		|	ОсновнойКешАвто_СоСклада.Количество,
		|	ОсновнойКешАвто_СоСклада.ВидЦены,
		|	ОсновнойКешАвто_СоСклада.Цена,
		|	ОсновнойКешАвто_СоСклада.Сумма,
		|	ОсновнойКешАвто_СоСклада.СтавкаНДС,
		|	ОсновнойКешАвто_СоСклада.СуммаНДС,
		|	ОсновнойКешАвто_СоСклада.СуммаСНДС,
		|	ОсновнойКешАвто_СоСклада.ПроцентРучнойСкидки,
		|	ОсновнойКешАвто_СоСклада.СуммаРучнойСкидки,
		|	ОсновнойКешАвто_СоСклада.ПроцентАвтоматическойСкидки,
		|	ОсновнойКешАвто_СоСклада.СуммаАвтоматическойСкидки,
		|	ОсновнойКешАвто_СоСклада.ПричинаОтмены,
		|	ОсновнойКешАвто_СоСклада.КодСтроки,
		|	ОсновнойКешАвто_СоСклада.Отменено,
		|	ОсновнойКешАвто_СоСклада.Склад,
		|	ОсновнойКешАвто_СоСклада.СрокПоставки,
		|	ОсновнойКешАвто_СоСклада.Содержание,
		|	ОсновнойКешАвто_СоСклада.СтатусУказанияСерий,
		|	ОсновнойКешАвто_СоСклада.УказыватьСерии,
		|	ЛОЖЬ,
		|	NULL
		|ИЗ
		|	ОсновнойКешАвто_СоСклада КАК ОсновнойКешАвто_СоСклада
		|ГДЕ
		|	ОсновнойКешАвто_СоСклада.СоСклада > 0
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	ОсновнойКешАвто_Авто.КлючСвязи,
		|	ОсновнойКешАвто_Авто.Номенклатура,
		|	ОсновнойКешАвто_Авто.Авто,
		|	ЗНАЧЕНИЕ(Перечисление.ВариантыОбеспечения.ПустаяСсылка),
		|	ОсновнойКешАвто_Авто.НомерСтроки,
		|	ОсновнойКешАвто_Авто.ДатаОтгрузки,
		|	ОсновнойКешАвто_Авто.Характеристика,
		|	ОсновнойКешАвто_Авто.Упаковка,
		|	ОсновнойКешАвто_Авто.Количество,
		|	ОсновнойКешАвто_Авто.ВидЦены,
		|	ОсновнойКешАвто_Авто.Цена,
		|	ОсновнойКешАвто_Авто.Сумма,
		|	ОсновнойКешАвто_Авто.СтавкаНДС,
		|	ОсновнойКешАвто_Авто.СуммаНДС,
		|	ОсновнойКешАвто_Авто.СуммаСНДС,
		|	ОсновнойКешАвто_Авто.ПроцентРучнойСкидки,
		|	ОсновнойКешАвто_Авто.СуммаРучнойСкидки,
		|	ОсновнойКешАвто_Авто.ПроцентАвтоматическойСкидки,
		|	ОсновнойКешАвто_Авто.СуммаАвтоматическойСкидки,
		|	ОсновнойКешАвто_Авто.ПричинаОтмены,
		|	ОсновнойКешАвто_Авто.КодСтроки,
		|	ОсновнойКешАвто_Авто.Отменено,
		|	ОсновнойКешАвто_Авто.Склад,
		|	ОсновнойКешАвто_Авто.СрокПоставки,
		|	ОсновнойКешАвто_Авто.Содержание,
		|	ОсновнойКешАвто_Авто.СтатусУказанияСерий,
		|	ОсновнойКешАвто_Авто.УказыватьСерии,
		|	ЛОЖЬ,
		|	NULL
		|ИЗ
		|	ОсновнойКешАвто_Авто КАК ОсновнойКешАвто_Авто
		|ГДЕ
		|	ОсновнойКешАвто_Авто.Авто > 0
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	ОсновнойКешАвто_ПодЗаказ.КлючСвязи,
		|	ОсновнойКешАвто_ПодЗаказ.Номенклатура,
		|	ОсновнойКешАвто_ПодЗаказ.КоличествоУпаковок - ОсновнойКешАвто_ПодЗаказ.Авто,
		|	ЗНАЧЕНИЕ(Перечисление.ВариантыОбеспечения.ПодЗаказ),
		|	ОсновнойКешАвто_ПодЗаказ.НомерСтроки,
		|	ОсновнойКешАвто_ПодЗаказ.ДатаОтгрузки,
		|	ОсновнойКешАвто_ПодЗаказ.Характеристика,
		|	ОсновнойКешАвто_ПодЗаказ.Упаковка,
		|	ОсновнойКешАвто_ПодЗаказ.Количество,
		|	ОсновнойКешАвто_ПодЗаказ.ВидЦены,
		|	ОсновнойКешАвто_ПодЗаказ.Цена,
		|	ОсновнойКешАвто_ПодЗаказ.Сумма,
		|	ОсновнойКешАвто_ПодЗаказ.СтавкаНДС,
		|	ОсновнойКешАвто_ПодЗаказ.СуммаНДС,
		|	ОсновнойКешАвто_ПодЗаказ.СуммаСНДС,
		|	ОсновнойКешАвто_ПодЗаказ.ПроцентРучнойСкидки,
		|	ОсновнойКешАвто_ПодЗаказ.СуммаРучнойСкидки,
		|	ОсновнойКешАвто_ПодЗаказ.ПроцентАвтоматическойСкидки,
		|	ОсновнойКешАвто_ПодЗаказ.СуммаАвтоматическойСкидки,
		|	ОсновнойКешАвто_ПодЗаказ.ПричинаОтмены,
		|	ОсновнойКешАвто_ПодЗаказ.КодСтроки,
		|	ОсновнойКешАвто_ПодЗаказ.Отменено,
		|	ОсновнойКешАвто_ПодЗаказ.Склад,
		|	ОсновнойКешАвто_ПодЗаказ.СрокПоставки,
		|	ОсновнойКешАвто_ПодЗаказ.Содержание,
		|	ОсновнойКешАвто_ПодЗаказ.СтатусУказанияСерий,
		|	ОсновнойКешАвто_ПодЗаказ.УказыватьСерии,
		|	ЛОЖЬ,
		|	NULL
		|ИЗ
		|	ОсновнойКешАвто_Авто КАК ОсновнойКешАвто_ПодЗаказ
		|ГДЕ
		|	ОсновнойКешАвто_ПодЗаказ.КоличествоУпаковок - ОсновнойКешАвто_ПодЗаказ.Авто > 0
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	КешУслуги.КлючСвязи,
		|	КешУслуги.Номенклатура,
		|	КешУслуги.КоличествоУпаковок,
		|	КешУслуги.ВариантОбеспечения,
		|	КешУслуги.НомерСтроки,
		|	КешУслуги.ДатаОтгрузки,
		|	КешУслуги.Характеристика,
		|	КешУслуги.Упаковка,
		|	КешУслуги.Количество,
		|	КешУслуги.ВидЦены,
		|	КешУслуги.Цена,
		|	КешУслуги.Сумма,
		|	КешУслуги.СтавкаНДС,
		|	КешУслуги.СуммаНДС,
		|	КешУслуги.СуммаСНДС,
		|	КешУслуги.ПроцентРучнойСкидки,
		|	КешУслуги.СуммаРучнойСкидки,
		|	КешУслуги.ПроцентАвтоматическойСкидки,
		|	КешУслуги.СуммаАвтоматическойСкидки,
		|	КешУслуги.ПричинаОтмены,
		|	КешУслуги.КодСтроки,
		|	КешУслуги.Отменено,
		|	КешУслуги.Склад,
		|	КешУслуги.СрокПоставки,
		|	КешУслуги.Содержание,
		|	КешУслуги.СтатусУказанияСерий,
		|	КешУслуги.УказыватьСерии,
		|	ЛОЖЬ,
		|	КешУслуги.Услуга
		|ИЗ
		|	КешУслуги КАК КешУслуги
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	Товары_Отменены.КлючСвязи,
		|	Товары_Отменены.Номенклатура,
		|	Товары_Отменены.КоличествоУпаковок,
		|	Товары_Отменены.ВариантОбеспечения,
		|	Товары_Отменены.НомерСтроки,
		|	Товары_Отменены.ДатаОтгрузки,
		|	Товары_Отменены.Характеристика,
		|	Товары_Отменены.Упаковка,
		|	Товары_Отменены.Количество,
		|	Товары_Отменены.ВидЦены,
		|	Товары_Отменены.Цена,
		|	Товары_Отменены.Сумма,
		|	Товары_Отменены.СтавкаНДС,
		|	Товары_Отменены.СуммаНДС,
		|	Товары_Отменены.СуммаСНДС,
		|	Товары_Отменены.ПроцентРучнойСкидки,
		|	Товары_Отменены.СуммаРучнойСкидки,
		|	Товары_Отменены.ПроцентАвтоматическойСкидки,
		|	Товары_Отменены.СуммаАвтоматическойСкидки,
		|	Товары_Отменены.ПричинаОтмены,
		|	Товары_Отменены.КодСтроки,
		|	Товары_Отменены.Отменено,
		|	Товары_Отменены.Склад,
		|	Товары_Отменены.СрокПоставки,
		|	Товары_Отменены.Содержание,
		|	Товары_Отменены.СтатусУказанияСерий,
		|	Товары_Отменены.УказыватьСерии,
		|	ЛОЖЬ,
		|	NULL
		|ИЗ
		|	КешТоварыОтменены КАК Товары_Отменены
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	КешТоварыПодЗаказ.КлючСвязи,
		|	КешТоварыПодЗаказ.Номенклатура,
		|	КешТоварыПодЗаказ.КоличествоУпаковок,
		|	КешТоварыПодЗаказ.ВариантОбеспечения,
		|	КешТоварыПодЗаказ.НомерСтроки,
		|	КешТоварыПодЗаказ.ДатаОтгрузки,
		|	КешТоварыПодЗаказ.Характеристика,
		|	КешТоварыПодЗаказ.Упаковка,
		|	КешТоварыПодЗаказ.Количество,
		|	КешТоварыПодЗаказ.ВидЦены,
		|	КешТоварыПодЗаказ.Цена,
		|	КешТоварыПодЗаказ.Сумма,
		|	КешТоварыПодЗаказ.СтавкаНДС,
		|	КешТоварыПодЗаказ.СуммаНДС,
		|	КешТоварыПодЗаказ.СуммаСНДС,
		|	КешТоварыПодЗаказ.ПроцентРучнойСкидки,
		|	КешТоварыПодЗаказ.СуммаРучнойСкидки,
		|	КешТоварыПодЗаказ.ПроцентАвтоматическойСкидки,
		|	КешТоварыПодЗаказ.СуммаАвтоматическойСкидки,
		|	КешТоварыПодЗаказ.ПричинаОтмены,
		|	КешТоварыПодЗаказ.КодСтроки,
		|	КешТоварыПодЗаказ.Отменено,
		|	КешТоварыПодЗаказ.Склад,
		|	КешТоварыПодЗаказ.СрокПоставки,
		|	КешТоварыПодЗаказ.Содержание,
		|	КешТоварыПодЗаказ.СтатусУказанияСерий,
		|	КешТоварыПодЗаказ.УказыватьСерии,
		|	КешТоварыПодЗаказ.Отгружен,
		|	NULL
		|ИЗ
		|	КешТоварыПодЗаказ КАК КешТоварыПодЗаказ
		|
		|УПОРЯДОЧИТЬ ПО
		|	КоличествоУпаковок";
	
	Возврат ТекстЗапроса;

КонецФункции

&НаКлиенте
Процедура Команда1(Команда)
	ЗагрузитьТаблицу();
КонецПроцедуры



	



