
#Область ОбработчикиСобытийФормы

&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	
	ОбновитьГенераторЧисел();
		
	Если Параметры.Свойство("Номенклатура") Тогда 
		Номенклатура = Параметры.Номенклатура;
	Иначе
		ВызватьИсключение НСтр("ru='Не найдена номенклатура, обратитесь в тех. поддержку!'");
	КонецЕсли;
	
	
	Если Параметры.Свойство("СерийныйНомер") Тогда
		
		Если ТипЗнч(Параметры.СерийныйНомер) = Тип("СправочникСсылка.СерийныеНомераНоменклатуры") Тогда
			СписокДанные.Добавить(СокрЛП(Параметры.СерийныйНомер.Код));
		КонецЕсли;
		
	Иначе
		
		Запрос = Новый Запрос;
		Запрос.Текст = 
			"ВЫБРАТЬ
			|	ШтрихкодыНоменклатуры.Штрихкод
			|ИЗ
			|	РегистрСведений.ШтрихкодыНоменклатуры КАК ШтрихкодыНоменклатуры
			|ГДЕ
			|	ШтрихкодыНоменклатуры.Номенклатура = &Номенклатура";	
		Запрос.УстановитьПараметр("Номенклатура", Номенклатура);	
		РезультатЗапроса = Запрос.Выполнить();
		Выборка = РезультатЗапроса.Выбрать();
		Пока Выборка.Следующий() Цикл
			СписокДанные.Добавить(СокрЛП(Выборка.Штрихкод));
		КонецЦикла;
		
	КонецЕсли;
	
	
	Если Параметры.Свойство("КодСтроки") Тогда 
		КодСтроки = Параметры.КодСтроки;
	Иначе
		ВызватьИсключение НСтр("ru='Не найден код строки, обратитесь в тех. поддержку!'");
	КонецЕсли;
	
	Если Параметры.Свойство("Ссылка") Тогда 
		Ссылка = Параметры.Ссылка;
	Иначе
		ВызватьИсключение НСтр("ru='Не обнаружено поле ссылка на заказ сервисного центра, обратитесь в тех. поддержку!'");
	КонецЕсли;
		
КонецПроцедуры

#КонецОбласти

#Область СлужебныеПроцедурыИФункции

&НаСервере
Процедура ОбновитьГенераторЧисел()
	
	ГСЧ		= Новый ГенераторСлучайныхЧисел;
	Число1	= ГСЧ.СлучайноеЧисло(1, 5);
	Число2	= ГСЧ.СлучайноеЧисло(1, 5);
	Число3	= ГСЧ.СлучайноеЧисло(1, 5);
	Элементы.Декорация1.Заголовок = Строка(Число1)+" + "+Строка(Число2)+" + "+Строка(Число3);
	Сумма = 0;
	
КонецПроцедуры

&НаКлиенте
Процедура СерийныйНомерШтрихКодОкончаниеВводаТекста(Элемент, Текст, ДанныеВыбора, Параметры, СтандартнаяОбработка)
	
	СерийныйНомерШтрихКод = Текст;
	Элементы.ГруппаПроверкаВведения.Видимость = Истина;	
	
КонецПроцедуры

&НаКлиенте
Процедура РезультатОкончаниеВводаТекста(Элемент, Текст, ДанныеВыбора, Параметры, СтандартнаяОбработка)
	
	Сумма = Число1+Число2+Число3;
	Если Сумма <> Число(Текст) Тогда 
		ОбщегоНазначенияКлиентСервер.СообщитьПользователю(НСтр("ru='Не верный результат!'"));
	Иначе 
		
		Если СписокДанные.НайтиПоЗначению(СерийныйНомерШтрихКод) <> Неопределено Тогда
			
			Оповестить("СборкаОтменаСтроки", Новый Структура("Ссылка, КодСтроки, СкладБрака", Ссылка, КодСтроки, СкладБрака));
			Закрыть();
			
		Иначе 	
			ОбщегоНазначенияКлиентСервер.СообщитьПользователю(НСтр("ru='Найденые данные по сер.номеру/штрихкоду и отмеченной строки не совпадают!'"));
		КонецЕсли;
	КонецЕсли;
	
	ОбновитьГенераторЧисел();
	
КонецПроцедуры

&НаКлиенте
Процедура СкладБракаПриИзменении(Элемент)
	
	Если СкладБрака.Пустая() = Ложь Тогда
		Элементы.СкладБрака.Доступность = Ложь;
		Элементы.СерийныйНомерШтрихКод.Видимость = Истина;	
	КонецЕсли;
	
КонецПроцедуры

#КонецОбласти

