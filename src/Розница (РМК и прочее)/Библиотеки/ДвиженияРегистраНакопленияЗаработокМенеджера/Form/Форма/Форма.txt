#Область ИнтерфейсАвтоматическихТестов



&НаКлиенте

Перем ЮнитТест;



&НаКлиенте

Функция ПолучитьСписокТестов(ЮнитТестирование) Экспорт

    

    ЮнитТест = ЮнитТестирование;

    

    СписокТестов = Новый Массив;

    Возврат СписокТестов;

    

КонецФункции



#КонецОбласти

#Область ОбработчикиСобытийФормы

&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
   УстановиПериод();
   УстановитьОтборПоДокументу();
КонецПроцедуры


#КонецОбласти

#Область ОбработчикиСобытийЭлементовФормы

&НаКлиенте
Процедура ПериодПриИзменении(Элемент)
    УстановиПериод();
КонецПроцедуры

&НаКлиенте
Процедура ДокументСсылкаПриИзменении(Элемент)
    УстановитьОтборПоДокументу();
КонецПроцедуры

&НаКлиенте
Процедура ДокументСсылкаОткрытие(Элемент, СтандартнаяОбработка)
     УстановитьОтборПоДокументу();
КонецПроцедуры

#КонецОбласти


#Область ОбработчикиСобытийКомандФормы

&НаКлиенте
Процедура ДобавитьЗаписать(Команда)
    
    Если ДокументСсылка =Неопределено Тогда
        Если Период.ДатаНачала=Дата(1,1,1) ИЛИ Период.ДатаОкончания=Дата(1,1,1) Тогда
            Ответ = Вопрос("Вы действительно хотите записать регистр по всем периоду?",РежимДиалогаВопрос.ДаНет);
            Если Ответ = КодВозвратаДиалога.Нет Тогда
                Возврат;
            КонецЕсли;
        КонецЕсли;
    КонецЕсли;

    СоздатьЗаписиВРегистреНаСервере();
    Элементы.СписокЗаписей.Обновить();
КонецПроцедуры


#КонецОбласти



#Область СлужебныеПроцедурыИФункции

&НаСервере
Процедура УстановиПериод()
   НачалоПериода = Период.ДатаНачала;
   КонецПериода  = ?(Период.ДатаОкончания=Дата(1,1,1), ТекущаяДата(),Период.ДатаОкончания);
   СписокЗаписей.Параметры.УстановитьЗначениеПараметра("НачалоПериода",НачалоПериода);
   СписокЗаписей.Параметры.УстановитьЗначениеПараметра("КонецПериода",КонецПериода);

КонецПроцедуры

Процедура УстановитьОтборПоДокументу()
    Если ДокументСсылка = Неопределено Тогда
        ОтборПоРегистратору = Ложь;
    Иначе
        ОтборПоРегистратору = НЕ ДокументСсылка.Пустая(); 
    КонецЕсли;         
      
   СписокЗаписей.Параметры.УстановитьЗначениеПараметра("ОтборПоРегистратору",ОтборПоРегистратору);
   СписокЗаписей.Параметры.УстановитьЗначениеПараметра("ДокументСсылка",ДокументСсылка);

КонецПроцедуры 

&НаСервере
Процедура СоздатьЗаписиВРегистреНаСервере()
    ПараметрыЗаписи = Новый Структура();
    ПараметрыЗаписи.Вставить("НачалоПериода",Период.ДатаНачала);
    ПараметрыЗаписи.Вставить("КонецПериода",?(Период.ДатаОкончания=Дата(1,1,1), ТекущаяДата(),Период.ДатаОкончания));
    ПараметрыЗаписи.Вставить("ДокументСсылка",ДокументСсылка);
    
    РеквизитФормыВЗначение("Объект").ВыполнитьДвиженияДокументов(ПараметрыЗаписи);
    
КонецПроцедуры



#КонецОбласти






