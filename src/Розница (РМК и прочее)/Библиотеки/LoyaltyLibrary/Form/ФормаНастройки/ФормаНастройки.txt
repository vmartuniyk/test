
////////////////////////////////////////////////////////////////////////////////
// ИНТЕРФЕЙС АВТОМАТИЧЕСКИХ ТЕСТОВ

&НаКлиенте
Перем ЮнитТест;

&НаКлиенте
Функция ПолучитьСписокТестов(ЮнитТестирование) Экспорт
	
	ЮнитТест = ЮнитТестирование;
	
	СписокТестов = Новый Массив;
	Возврат СписокТестов;
	
КонецФункции




&НаКлиенте
Процедура СтраницаНастройки(Команда)
	
	Элементы.ГруппаСтраницы.ТекущаяСтраница = Элементы.ГруппаНастройки;
	Элементы.СтраницаНастройки.Пометка 	= Истина;
	
	Элементы[ПредыдущаяКоманда].Шрифт 	= Новый Шрифт(, 8, Ложь, , , );
	Элементы.СтраницаНастройки.Шрифт 	= Новый Шрифт(, 8, Истина, , , );
	
	ПредыдущаяКоманда = "СтраницаНастройки";
	
КонецПроцедуры

&НаКлиенте
Процедура СтраницаОповещения(Команда)
	
	Элементы.ГруппаСтраницы.ТекущаяСтраница = Элементы.ГруппаОповещения;
	Элементы.СтраницаОповещения.Пометка 	= Истина;
	
	Элементы[ПредыдущаяКоманда].Шрифт 	= Новый Шрифт(, 8, Ложь, , , );
	Элементы.СтраницаОповещения.Шрифт 	= Новый Шрифт(, 8, Истина, , , );
	
	ПредыдущаяКоманда = "СтраницаОповещения";
	
КонецПроцедуры

&НаКлиенте
Процедура СтраницаОсновная(Команда)
	
	Элементы.ГруппаСтраницы.ТекущаяСтраница = Элементы.ГруппаОсновная;
	Элементы.СтраницаОсновная.Пометка 	= Истина;
	
	Элементы[ПредыдущаяКоманда].Шрифт 	= Новый Шрифт(, 8, Ложь, , , );
	Элементы.СтраницаОсновная.Шрифт 	= Новый Шрифт(, 8, Истина, , , );
	
	ПредыдущаяКоманда = "СтраницаОсновная";
	
КонецПроцедуры

&НаКлиенте
Процедура СтраницаСтавки(Команда)
	
	Элементы.ГруппаСтраницы.ТекущаяСтраница = Элементы.ГруппаСтавки;
	Элементы.СтраницаСтавки.Пометка 	= Истина;
	
	Элементы[ПредыдущаяКоманда].Шрифт 	= Новый Шрифт(, 8, Ложь, , , );
	Элементы.СтраницаСтавки.Шрифт 	= Новый Шрифт(, 8, Истина, , , );
	
	ПредыдущаяКоманда = "СтраницаСтавки";
	
КонецПроцедуры




&НаКлиенте
Процедура ДинамическаяСкидкаБонусыПередОкончаниемРедактирования(Элемент, НоваяСтрока, ОтменаРедактирования, Отказ)
	
	ДинамическаяСкидкаБонусы.Сортировать("НижняяГраница");
	Для Каждого ТекущаяСтрока Из ДинамическаяСкидкаБонусы Цикл
		ПолучитьПредставление(ДинамическаяСкидкаБонусы, ТекущаяСтрока, "ДинамическаяСкидкаБонусы");	
	КонецЦикла;
	
	ЗаписатьСтавки("ДинамическаяСкидкаБонусы");

КонецПроцедуры

&НаКлиенте
Процедура ДинамическаяСкидкаБонусыПослеУдаления(Элемент)
	
	Для Каждого ТекущаяСтрока Из ДинамическаяСкидкаБонусы Цикл
		ПолучитьПредставление(ДинамическаяСкидкаБонусы, ТекущаяСтрока, "ДинамическаяСкидкаБонусы");			
	КонецЦикла;
	
	ЗаписатьСтавки("ДинамическаяСкидкаБонусы");
	
КонецПроцедуры

&НаКлиенте
Процедура Лояльность_СтавкиПередОкончаниемРедактирования(Элемент, НоваяСтрока, ОтменаРедактирования, Отказ)
	
	СкидкаПоОборотуБонусы.Сортировать("НижняяГраница");
	Для Каждого ТекущаяСтрока Из СкидкаПоОборотуБонусы Цикл
		ПолучитьПредставление(СкидкаПоОборотуБонусы, ТекущаяСтрока, "СкидкаПоОборотуБонусы");	
	КонецЦикла;
	
	ЗаписатьСтавки("СкидкаПоОборотуБонусы");
	
КонецПроцедуры

&НаКлиенте
Процедура Лояльность_СтавкиПослеУдаления(Элемент)
	
	Для Каждого ТекущаяСтрока Из СкидкаПоОборотуБонусы Цикл
		ПолучитьПредставление(СкидкаПоОборотуБонусы, ТекущаяСтрока, "СкидкаПоОборотуБонусы");			
	КонецЦикла;
	
	ЗаписатьСтавки("СкидкаПоОборотуБонусы");
	
КонецПроцедуры
 


&НаКлиенте
Процедура ПолучитьПредставление(ТабличнаяЧасть, ТекущаяСтрока, ИмяТаблицы)
	
	МаксНижняяГраница = Неопределено;
	СледующаяСтрока = Неопределено;
	Для Каждого СтрокаТЧ Из ТабличнаяЧасть Цикл
		Если (МаксНижняяГраница = Неопределено Или МаксНижняяГраница >= СтрокаТЧ.НижняяГраница)
		   И ТекущаяСтрока.НижняяГраница <= СтрокаТЧ.НижняяГраница
		   И СтрокаТЧ <> ТекущаяСтрока Тогда
			СледующаяСтрока = СтрокаТЧ;
			МаксНижняяГраница = СтрокаТЧ.НижняяГраница;
		КонецЕсли;
	КонецЦикла;

	Если СледующаяСтрока = Неопределено Тогда
		ПредставлениеИнтервала = "От " + Строка(ТекущаяСтрока.НижняяГраница) + " " + ?(ИмяТаблицы = "ДинамическаяСкидкаБонусы", "%", "UAH");
	ИначеЕсли ТекущаяСтрока.НижняяГраница = СледующаяСтрока.НижняяГраница Тогда
		ПредставлениеИнтервала = "ОШИБКА: такая нижняя граница уже есть!";
	Иначе
		ПредставлениеИнтервала = "От " + Строка(ТекущаяСтрока.НижняяГраница) + " до " + Строка(СледующаяСтрока.НижняяГраница) + " " + ?(ИмяТаблицы = "ДинамическаяСкидкаБонусы", "%", "UAH");
	КонецЕсли;
	
	ТекущаяСтрока.ПредставлениеИнтервала = ПредставлениеИнтервала;
	
КонецПроцедуры




&НаКлиенте
Процедура ПриОткрытии(Отказ)
	
	Для Каждого ТекущаяСтрока Из СкидкаПоОборотуБонусы Цикл
		ПолучитьПредставление(СкидкаПоОборотуБонусы, ТекущаяСтрока, "СкидкаПоОборотуБонусы");	
	КонецЦикла;
	
	Для Каждого ТекущаяСтрока Из ДинамическаяСкидкаБонусы Цикл
		ПолучитьПредставление(ДинамическаяСкидкаБонусы, ТекущаяСтрока, "ДинамическаяСкидкаБонусы");	
	КонецЦикла;
	
КонецПроцедуры

&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	
	ЗагрузитьСтавки();
		
	Элементы.ГруппаСтраницы.ТекущаяСтраница = Элементы.ГруппаОсновная;
	Элементы.СтраницаОсновная.Пометка = Истина;
	ПредыдущаяКоманда = "СтраницаОсновная";
	Элементы.СтраницаОсновная.Шрифт = Новый Шрифт(, 8, Истина, , , );
	
КонецПроцедуры

&НаСервере
Процедура ЗаписатьСтавки(ИмяРегистра)
		
	НаборЗаписей = РегистрыСведений[ИмяРегистра].СоздатьНаборЗаписей();
	Таблица		 = ЭтаФорма[ИмяРегистра]; //СкидкаПоОборотуБонусы;

	Для Каждого СтрокаЗаписи Из Таблица  Цикл 		
		
		НоваяЗапись = НаборЗаписей.Добавить();
		
		НоваяЗапись.НижняяГраница	= СтрокаЗаписи.НижняяГраница;
		НоваяЗапись.Значение		= СтрокаЗаписи.Значение;
		Если ИмяРегистра = "СкидкаПоОборотуБонусы" Тогда НоваяЗапись.Уровень = СтрокаЗаписи.Уровень; КонецЕсли;
		
		МаксНижняяГраница = Неопределено;
		СледующаяСтрока = Неопределено;
		Для Каждого СтрокаТЧ Из Таблица Цикл
			Если (МаксНижняяГраница = Неопределено Или МаксНижняяГраница >= СтрокаТЧ.НижняяГраница)
	  		И СтрокаЗаписи.НижняяГраница <= СтрокаТЧ.НижняяГраница
	   		И СтрокаТЧ <> СтрокаЗаписи Тогда
			СледующаяСтрока = СтрокаТЧ;
			МаксНижняяГраница = СтрокаТЧ.НижняяГраница;
			КонецЕсли;
		КонецЦикла;
		
		Если СледующаяСтрока = Неопределено Тогда
			
		Иначе
			НоваяЗапись.ВерхняяГраница = СледующаяСтрока.НижняяГраница;
		КонецЕсли;
		
	КонецЦикла;
	НаборЗаписей.Записать();		
	
КонецПроцедуры

&НаСервере
Процедура ЗагрузитьСтавки()
	
	Запрос = Новый Запрос("
		|ВЫБРАТЬ РАЗРЕШЕННЫЕ
		|	*
		|ИЗ
		| 	РегистрСведений.СкидкаПоОборотуБонусы   
		|");
	СкидкаПоОборотуБонусы.Загрузить(Запрос.Выполнить().Выгрузить());
	СкидкаПоОборотуБонусы.Сортировать("НижняяГраница");
	
	Запрос = Новый Запрос("
		|ВЫБРАТЬ РАЗРЕШЕННЫЕ
		|	*
		|ИЗ
		| 	РегистрСведений.ДинамическаяСкидкаБонусы   
		|");
	ДинамическаяСкидкаБонусы.Загрузить(Запрос.Выполнить().Выгрузить());
	ДинамическаяСкидкаБонусы.Сортировать("НижняяГраница");
	
КонецПроцедуры
