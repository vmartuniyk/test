
////////////////////////////////////////////////////////////////////////////////
// ИНТЕРФЕЙС АВТОМАТИЧЕСКИХ ТЕСТОВ

&НаКлиенте
Перем ЮнитТест;

&НаКлиенте
Функция ПолучитьСписокТестов(ЮнитТестирование) Экспорт
	
	ЮнитТест = ЮнитТестирование;
	
	СписокТестов = Новый Массив;
	Возврат СписокТестов;
	
КонецФункции




&НаКлиенте
Процедура Отправить(Команда)
	
	Если ПустаяСтрока(Комментарий) Тогда
		Сообщение 		= Новый СообщениеПользователю;
		Сообщение.Текст = "Комментарий не заполнен!";
		Сообщение.Поле	= "Комментарий";
		Сообщение.Сообщить();
		Возврат;
	КонецЕсли;
	
	//ОтправитьПисьмоНаСервере();
	Закрыть = Истина;
	Закрыть();
	
КонецПроцедуры

&НаКлиенте
Процедура ПередЗакрытием(Отказ, СтандартнаяОбработка)
	
	Если НЕ Закрыть Тогда
		Отказ = Истина;
	КонецЕсли;
		
КонецПроцедуры


&НаСервере
Процедура ОтправитьПисьмоНаСервере()
		
	Тема = 	"Механизм лояльности: Зафиксирована продажа без регистрации!";
	Тело = 	"Организация: " 			+ Организация   						+ Символы.ПС +
			"Сумма: "                   + Сумма								 	+ Символы.ПС +
			"Пользователь: "			+ ПараметрыСеанса.ТекущийПользователь   + Символы.ПС + Символы.ПС +
			"Комментарий: "				+ Комментарий;
			
	Кому = РеквизитФормыВЗначение("Объект").ПолучитьМассивЭА(Перечисления.ТипыСобытияБонусы.ОперацияБольшеЛимита);		
	
	УчетнаяЗаписьЭП = ktcОбщийМодульПротоколов.ПолучитьУчетнуюЗаписьЭП();
	ПараметрыПисьма = ktcОбщийМодульПротоколов.СформироватьПараметрыПисьма(Тема, Тело, Кому);
	ktcОбщийМодульПротоколов.ОтправитьСообщениеПоSMTP(УчетнаяЗаписьЭП, ПараметрыПисьма);

	Закрыть	= Истина;
	
КонецПроцедуры

&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	
	Организация = Параметры.Организация;
	Сумма		= Параметры.Сумма;
	Закрыть		= Ложь;
	
КонецПроцедуры

