
#Область ОбработчикиСобытийФормы

&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	Перем temp;
	
	УстановитьПривилегированныйРежим(Истина);
	
	Настройки = ХранилищеНастроекДанныхФорм.Загрузить("ДополнительныеНастройкиОбработокЛояльностьОтправкаСМС", , , "ДополнительныеНастройкиОбработокЛояльностьОтправкаСМС");
	Если ТипЗнч(Настройки) = Тип("Структура") Тогда
		Настройки.Свойство("ДнейКулдауна", ДнейКулдауна);
		Настройки.Свойство("ДатаНачалаРассылки", ДатаНачалаРассылки);
		Настройки.Свойство("МинимальнаяСуммаБонусов", МинимальнаяСуммаБонусов);
		Настройки.Свойство("ТекстСМС", ТекстСМС);
	КонецЕсли;
	
КонецПроцедуры

&НаКлиенте
Процедура ПередЗакрытием(Отказ, СтандартнаяОбработка)
	Если Модифицированность Тогда
		РезультатОтвета = Вопрос("Данные были изменены. Сохранить изменения?", РежимДиалогаВопрос.ДаНетОтмена);
		Если РезультатОтвета = КодВозвратаДиалога.Да Тогда
			ЗаписатьНастройкиНаСервере();
		ИначеЕсли РезультатОтвета = КодВозвратаДиалога.Отмена Тогда
			Отказ = Истина;	
		КонецЕсли;
	КонецЕсли;
КонецПроцедуры

#КонецОбласти

#Область ОбработчикиСобытийЭлементовФормы

&НаКлиенте
Процедура ДатаНачалаРассылкиПриИзменении(Элемент)
	Модифицированность = Истина;
КонецПроцедуры

&НаКлиенте
Процедура ДнейКулдаунаПриИзменении(Элемент)
	Модифицированность = Истина;
КонецПроцедуры

&НаКлиенте
Процедура МинимальнаяСуммаБонусовПриИзменении(Элемент)
	Модифицированность = Истина;
КонецПроцедуры

&НаКлиенте
Процедура ТекстСМСПриИзменении(Элемент)
	Модифицированность = Истина;
КонецПроцедуры
	
#КонецОбласти 

#Область ОбработчикиКомандФормы

&НаКлиенте
Процедура Записать(Команда)
	Отказ = ЗаписатьНастройкиНаСервере();
	Если НЕ Отказ Тогда 
		Модифицированность = Ложь; 
	КонецЕсли;
КонецПроцедуры

&НаКлиенте
Процедура ЗаписатьИЗакрыть(Команда)
	Отказ = ЗаписатьНастройкиНаСервере();
	Если НЕ Отказ Тогда 
		Модифицированность = Ложь; 
		Закрыть(); 
	КонецЕсли;
КонецПроцедуры

&НаКлиенте
Процедура НастроитьАкции(Команда)
	ОткрытьФорму("РегистрСведений.Лояльность_Акции.ФормаСписка");
КонецПроцедуры

#КонецОбласти


#Область СлужебныеПроцедурыИФункции

&НаСервере
Функция ЗаписатьНастройкиНаСервере(Отказ = Ложь)
	
	УстановитьПривилегированныйРежим(Истина);
	
	Настройки = Новый Структура;	
	Настройки.Вставить("ДнейКулдауна", ДнейКулдауна);
	Настройки.Вставить("ДатаНачалаРассылки", ДатаНачалаРассылки);
	Настройки.Вставить("МинимальнаяСуммаБонусов", МинимальнаяСуммаБонусов);
	Настройки.Вставить("ТекстСМС", ТекстСМС);
		
	ХранилищеНастроекДанныхФорм.Сохранить("ДополнительныеНастройкиОбработокЛояльностьОтправкаСМС", , Настройки, "Настройки отправки смс по лояльности", "ДополнительныеНастройкиОбработокЛояльностьОтправкаСМС");
		
	Возврат Отказ; 
	
КонецФункции

#КонецОбласти 
