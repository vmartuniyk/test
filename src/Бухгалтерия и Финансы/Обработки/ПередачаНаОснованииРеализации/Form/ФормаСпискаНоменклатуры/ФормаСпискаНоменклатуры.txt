
&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	
	ДокументСсылка			= Параметры.ДокументСсылка;
	НаименованиеДокумента 	= ДокументСсылка.Метаданные().Имя;
	
	Запрос = Новый Запрос("ВЫБРАТЬ
						  |	Номенклатура КАК Номенклатура,
						  |	Количество КАК Количество,
						  |	"+?(ТипЗнч(ДокументСсылка)<>Тип("ДокументСсылка.СписаниеНедостачТоваров"), "КоличествоУпаковок КАК КоличествоУпаковок,", "Количество КАК КоличествоУпаковок,") + "
						  |	"+?(ТипЗнч(ДокументСсылка)<>Тип("ДокументСсылка.СписаниеНедостачТоваров"), "Упаковка КАК Упаковка,", "Значение(Справочник.УпаковкиНоменклатуры.ПустаяСсылка) КАК Упаковка,") + "
						  |	ЛОЖЬ КАК Флаг
						  |ИЗ
						  |	Документ."+НаименованиеДокумента+".Товары
						  |ГДЕ
						  |	Ссылка = &Ссылка");
						  
	Запрос.УстановитьПараметр("Ссылка", ДокументСсылка);
						  
	СписокНоменклатуры.Загрузить(Запрос.Выполнить().Выгрузить());
	
	Если СписокНоменклатуры.Количество() = 1 Тогда УстановитьСнятьФлажки(Истина); КонецЕсли; 
	
КонецПроцедуры

&НаКлиенте
Процедура ОтменаВыбора(Команда)
	Закрыть();
КонецПроцедуры


&НаКлиенте
Процедура ВыбратьНоменклатуру(Команда)
	Закрыть(ПолучитьМассивНоменклатуры());
КонецПроцедуры


// <Описание функции>
//
// Параметры
//  <Параметр1>  - <Тип.Вид> - <описание параметра>
//                 <продолжение описания параметра>
//  <Параметр2>  - <Тип.Вид> - <описание параметра>
//                 <продолжение описания параметра>
//
// Возвращаемое значение:
//   <Тип.Вид>   - <описание возвращаемого значения>
//
&НаСервере
Функция ПолучитьМассивНоменклатуры()

	Запрос = Новый Запрос("ВЫБРАТЬ
	                      |	СписокНоменклатуры.Флаг КАК Флаг,
	                      |	СписокНоменклатуры.Номенклатура КАК Номенклатура
	                      |ПОМЕСТИТЬ КешНоменклатура
	                      |ИЗ
	                      |	&СписокНоменклатуры КАК СписокНоменклатуры
	                      |;
	                      |
	                      |////////////////////////////////////////////////////////////////////////////////
	                      |ВЫБРАТЬ
	                      |	КешНоменклатура.Номенклатура КАК Номенклатура
	                      |ИЗ
	                      |	КешНоменклатура КАК КешНоменклатура
	                      |ГДЕ
	                      |	КешНоменклатура.Флаг");
						  
	Запрос.УстановитьПараметр("СписокНоменклатуры", СписокНоменклатуры.Выгрузить());
	
	Возврат Запрос.Выполнить().Выгрузить().ВыгрузитьКолонку("Номенклатура");

КонецФункции // ПолучитьМассивНоменклатуры()


&НаКлиенте
Процедура УстановитьФлажки(Команда)
	УстановитьСнятьФлажки(Истина);	
КонецПроцедуры


&НаКлиенте
Процедура СнятьФлажки(Команда)
	УстановитьСнятьФлажки(Ложь);
КонецПроцедуры

// <Описание процедуры>
//
// Параметры
//  <Параметр1>  - <Тип.Вид> - <описание параметра>
//                 <продолжение описания параметра>
//  <Параметр2>  - <Тип.Вид> - <описание параметра>
//                 <продолжение описания параметра>
//
&НаСервере
Процедура УстановитьСнятьФлажки(Флаг)

	Для каждого СтрокаТЧ Из СписокНоменклатуры Цикл
	
		СтрокаТЧ.Флаг = Флаг;
	
	КонецЦикла;

КонецПроцедуры // УстановитьСнятьФлажки()
 
 